"use strict";var app=angular.module("proximiApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ngMessages","firebase","ui.router","ui.bootstrap","FBAngular","ngTable","ui.select","ui.utils","leaflet-directive","textAngular","decipher.tags","ngStorage","localytics.directives","toastr","angular-momentjs","angular-flot","ez.datetime","easypiechart","lbServices","rzModule"]);app.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/app/dashboard"),$stateProvider.state("app",{"abstract":!0,url:"/app",templateUrl:"views/app.html"}).state("app.dashboard",{url:"/dashboard",controller:"DashboardCtrl",templateUrl:"views/pages/dashboard.html",authenticate:!0}).state("app.places",{url:"/places",controller:"PlacesCtrl",templateUrl:"views/pages/places.html",authenticate:!0}).state("app.floors",{url:"/floors",controller:"FloorsCtrl",templateUrl:"views/pages/floors.html",authenticate:!0}).state("app.departments",{url:"/departments",controller:"DepartmentsCtrl",templateUrl:"views/pages/departments.html",authenticate:!0}).state("app.geofences",{url:"/geofences",controller:"GeofencesCtrl",templateUrl:"views/pages/geofences.html",authenticate:!0}).state("app.inputs",{url:"/inputs",controller:"InputsCtrl",templateUrl:"views/pages/inputs.html",authenticate:!0}).state("app.import-inputs",{url:"/import-inputs",controller:"ImportInputsCtrl",templateUrl:"views/pages/import-inputs.html",authenticate:!0}).state("app.outputs",{url:"/outputs",controller:"OutputsCtrl",templateUrl:"views/pages/outputs.html",authenticate:!0}).state("app.actions",{url:"/actions",controller:"ActionsCtrl",templateUrl:"views/pages/actions.html",authenticate:!0}).state("app.debug",{url:"/debug",controller:"DebugCtrl",templateUrl:"views/pages/debug.html",authenticate:!0}).state("app.applications",{url:"/applications",controller:"ApplicationsCtrl",templateUrl:"views/pages/applications.html",authenticate:!0}).state("app.analytics",{url:"/analytics/:id",controller:"AnalyticsCtrl",templateUrl:"views/pages/analytics.html",authenticate:!0}).state("app.reports",{url:"/reports",controller:"ReportsCtrl",templateUrl:"views/pages/reports.html",authenticate:!0}).state("app.account",{url:"/account",controller:"AccountCtrl",templateUrl:"views/pages/account.html",authenticate:!0}).state("core",{"abstract":!0,url:"/core",template:"<div ui-view></div>",containerClass:"core"}).state("core.login",{url:"/login",controller:"LoginCtrl",templateUrl:"views/pages/login.html",containerClass:"core"}).state("core.signup",{url:"/signup",controller:"RegisterCtrl",templateUrl:"views/pages/register.html",containerClass:"core"}).state("core.forgotpass",{url:"/forgotpass",controller:"ForgotPassCtrl",templateUrl:"views/pages/forgotpass.html",containerClass:"core"}).state("core.user_update",{url:"/user_update",controller:"UpdateUserCtrl",templateUrl:"views/pages/user_update.html",containerClass:"core"})}]),app.constant("APIURL","https://api.proximi.fi").constant("FBURL","https://proximiio-event-bus.firebaseio.com/").constant("loginRedirectPath","core.login").constant("client_version","0.0.55").controller("MainCtrl",["$scope","$state","AuthService","$localStorage","toastr","toastrConfig","$http","client_version",function($scope,$state,AuthService,$localStorage,toastr,toastrConfig,$http,client_version){$scope.main={title:"Proximi",appName:"proximiioApp",settings:{headerFixed:!0,asideFixed:!0}},$scope.$storage=$localStorage,$scope.plansNotify={show:!0},$scope.starterWizard={show:!0},$scope.$storage.plansNotify||($scope.$storage.plansNotify=$scope.plansNotify),$scope.$storage.starterWizard||($scope.$storage.starterWizard=$scope.starterWizard),$scope.logout=function(){AuthService.logout().then(function(){$state.go("core.login",{},{reload:!0})})},$http.get("https://api.github.com/repos/proximiio/proximiio-web-portal/releases/latest").then(function(response){response.data.tag_name!==client_version&&toastr.info("The new version of the portal ("+response.data.tag_name+') is available at <a href="https://www.npmjs.com/package/proximiio" target="_blank" class="text-strong">npm repository</a>. Please update.',"Ahoy!",{toastClass:"toast toast-center",timeOut:0,extendedTimeOut:0,allowHtml:!0,closeButton:!0,tapToDismiss:!1})},function(response){console.log(response)}),$scope.getSnippet=function(target){AuthService.getCurrentUser().$promise.then(function(res){console.log(target,res);var content;content="curl -X GET \\ \n--header 'Content-Type: application/json' \\ \n--header 'Accept: application/json' \\ \n--header 'Authorization: Bearer "+Object.keys(res.tokens[0])+"' \\ \n'https://api.proximi.fi/core/"+target+"'",alertify.alert("<pre>"+content+"</pre>").set({transition:"zoom"}).set("title","Get CURL snippet!").set("onok",function(closeEvent){console.log("close")})})}}]),app.factory("httpRequestInterceptor",["client_version",function(client_version){return{request:function(config){var str=config.url;return str.indexOf("api.proximi.fi")>=0&&(config.headers.Client="proximiio-portal "+client_version),config}}}]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("httpRequestInterceptor"),$httpProvider.interceptors.push(["$q","$location","LoopBackAuth",function($q,$location,LoopBackAuth){return{responseError:function(rejection){return 401===rejection.status&&(LoopBackAuth.clearUser(),LoopBackAuth.clearStorage(),$location.nextAfterLogin=$location.path(),$location.path("/core/login")),$q.reject(rejection)}}}])}]).run(["$rootScope","$state","$stateParams","AuthService","$http","Plan","$location",function($rootScope,$state,$stateParams,AuthService,$http,Plan,$location){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.$on("$stateChangeStart",function(event,next){$zopim(function(){$zopim.livechat.sendVisitorPath({url:$location.$$protocol+"://"+$location.$$host+":"+$location.$$port+"/#/app"+next.url})}),AuthService.isAuthenticated()&&(Plan.getCurrent().$promise.then(function(res){$rootScope.currentPlan=res}),$rootScope.currentUser=AuthService.getCurrentUser()),$rootScope.currentUser&&$rootScope.currentUser.$promise.then(function(user){$zopim(function(){$zopim.livechat.set({name:user.name,email:user.email,notes:"Company: "+user.organization.name})})}),next.authenticate&&!$rootScope.currentUser&&($rootScope.currentUser=null,event.preventDefault(),$state.go("core.login",{},{reload:!0}))}),$rootScope.$on("$stateChangeSuccess",function(event,toState){$rootScope.currentUrl=toState.url,event.targetScope.$watch("$viewContentLoaded",function(){angular.element("html, body, #content").animate({scrollTop:0},200),setTimeout(function(){angular.element("#wrap").css("visibility","visible"),angular.element(".dropdown").hasClass("open")||angular.element(".dropdown").find(">ul").slideUp()},200)}),$rootScope.containerClass=toState.containerClass})}]),app.controller("NavCtrl",["$scope",function($scope){$scope.oneAtATime=!1,$scope.status={isFirstOpen:!0,isSecondOpen:!0,isThirdOpen:!0}}]),app.controller("HeaderCtrl",["$scope","Plan",function($scope,Plan){$scope.currentPlan=Plan.getCurrent(),$scope.currentPlan.$promise.then(function(res){res.subscriptions||($scope.currentPlan={subscriptions:{data:[{plan:{id:"free"}}]}})})}]),app.controller("DashboardCtrl",["$scope","$filter","ngTableParams","compressArray","$timeout","Place","Input","Floor","Department","Event","FBURL","$firebaseArray","$firebaseObject","Plan","toastr","Metrics",function($scope,$filter,ngTableParams,compressArray,$timeout,Place,Input,Floor,Department,Event,FBURL,$firebaseArray,$firebaseObject,Plan,toastr,Metrics){function getList(){Event.find({},function(list){$scope.events=$filter("filter")(list,{event:"!config-change"}),$scope.events=$filter("orderBy")($scope.events,"createdAt"),$scope.eventsData=$scope.events.slice(Math.max($scope.events.length-50,0)),initDonut(),tableLoad||initTable(),$scope.tableParams.reload()},function(errorResponse){console.log(errorResponse)})}function initDonut(){$scope.countEventsByPlace=[];for(var k in $scope.events){var d=$scope.events[k];d.data&&$scope.countEventsByPlace.push(d.data.place)}$scope.donutData=[],angular.forEach(compressArray($scope.countEventsByPlace),function(key){key.label&&$scope.donutData.push({label:key.label,value:key.data})})}function initTable(){tableLoad=!0,$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{createdAt:"desc"}},{total:$scope.eventsData.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.eventsData,params.orderBy()):$scope.eventsData;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}$scope.page={title:"Dashboard",subtitle:"Overview for all the places and events"},$scope.currentUser.$promise.then(function(){Metrics.add("openedDashboard",$scope.currentUser.organization_id)}),$scope.placesCount=Place.count(),$scope.inputsCount=Input.count(),$scope.floorsCount=Floor.count(),$scope.departmentsCount=Department.count();var organization,ref=new Firebase(FBURL);$scope.events=[];var tableLoad=!1;$scope.dwellTime=function(dwellTime){return dwellTime?moment.duration(dwellTime,"seconds").humanize():void 0},$scope.currentUser.$promise.then(function(){organization=$scope.currentUser.organization.id,ref.child("organizations").child(organization).child("last_event").on("value",function(dataSnapshot){getList()}),Plan.getCurrent().$promise.then(function(res){($scope.currentPlan.registered||$scope.currentPlan.registered===!1||"free"===$scope.currentPlan.subscriptions.data[0].plan.id)&&($scope.$storage.plansNotify.show||$scope.$storage.plansNotify.valid_until<parseInt(moment().format("x")))&&toastr.info('Need better data retention, more features or support? Check out the <a href="/#/app/account" class="text-strong">paid plans</a>.',"Ahoy!",{toastClass:"toast toast-center",timeOut:0,extendedTimeOut:0,allowHtml:!0,closeButton:!0,tapToDismiss:!1,onHidden:function(){$scope.plansNotify={show:!1,dismissed_at:parseInt(moment().format("x")),valid_until:parseInt(moment().add(7,"days").format("x"))},$scope.$storage.plansNotify=$scope.plansNotify}})})})}]),app.controller("LoginCtrl",["$scope","$state","AuthService","$location","toastr",function($scope,$state,AuthService,$location,toastr){AuthService.isAuthenticated()&&$state.go("app.dashboard",{},{reload:!0}),$scope.login=function(){AuthService.login($scope.credentials).then(function(res){AuthService.getCurrentUser().$promise.then(function(res){res.name&&res.email&&res.organization&&res.organization.name&&res.organization.country?$state.go("app.dashboard",{},{reload:!0}):$state.go("core.user_update",{},{reload:!0})})},function(res){console.log(res),toastr.error("Username or password wrong",res.statusText)})}}]).controller("RegisterCtrl",["$scope","$state","AuthService","$location","toastr","User","$resource",function($scope,$state,AuthService,$location,toastr,User,$resource){$scope.countries=$resource("scripts/jsons/countries.json").query(),AuthService.isAuthenticated()&&$state.go("app.dashboard",{},{reload:!0}),$scope.personalUse=!1,$scope.credentials={improve_product:!0},$scope.registering=!1,$scope.register=function(){$scope.registering=!0,$scope.personalUse&&($scope.credentials.company=$scope.credentials.first_name+" "+$scope.credentials.last_name),AuthService.register($scope.credentials).then(function(res){$state.go("app.dashboard",{},{reload:!0})},function(res){console.log(res),toastr.error(res.data.message,res.statusText),$scope.registering=!1})},$scope.backgrounds=["Freelance developer","Developer in a software development company","In-house developer","Researcher","I do marketing","I do sales","Other"],$scope.companyAvailable=!0,$scope.checkCompany=function(){User.checkCompany({name:$scope.credentials.company},function(res){res.available===!1?$scope.signupForm.company.$setValidity("company",!1):$scope.signupForm.company.$setValidity("company",!0),$scope.companyAvailable=res.available})}}]).controller("ForgotPassCtrl",["$scope","$state","AuthService","$location","toastr",function($scope,$state,AuthService,$location,toastr){AuthService.isAuthenticated()&&$state.go("app.dashboard",{},{reload:!0}),$scope.ok=function(){AuthService.resetPassword($scope.email).$promise.then(function(res){toastr.success("We have sent you a new password","Password reset!"),$state.go("core.login",{},{reload:!0})},function(res){console.log(res),toastr.error(res.data.message,res.statusText)})}}]),app.controller("OperationRequestCtrl",["$scope","toastr",function($scope,toastr){$scope.request=function(type){$scope.currentUser&&"orchestrator"===type&&alertify.confirm('Proximi.io Orchestrator is available during the beta for free. We will setup an instance for you in the IMB Bluemix Cloud after you\'ve sent us the request. After the beta we will enable the self service model and you can fire up your own instance of the Orchestrator from the portal (Driver plan required after beta, see <a href="http://proximi.io/pricing/" target="_blank">http://proximi.io/pricing</a>).<br/><br/>More details about the Proximi.io Orchestrator: <a href="http://proximi.io/external-actions-integrations/" target="_blank">http://proximi.io/external-actions-integrations</a>').set({transition:"zoom"}).set("title","Request Orchestrator access").set("labels",{ok:"Send Request!"}).set("onok",function(closeEvent){}).set("oncancel",function(closeEvent){console.log("Cancel")}),$scope.currentUser&&"reports"===type&&alertify.confirm('Proximi.io Reports is available during the beta for free. We will setup an instance for you in the IMB Bluemix Cloud after you\'ve sent us the request. After the beta we will enable the self service model and you can fire up your own instance of the Reports tool from the portal (Driver plan required after beta, see <a href="http://proximi.io/pricing/" target="_blank">http://proximi.io/pricing/</a>).').set({transition:"zoom"}).set("title","Request Reports access").set("labels",{ok:"Send Request!"}).set("onok",function(closeEvent){}).set("oncancel",function(closeEvent){console.log("Cancel")})}}]),app.controller("DemoBuilderCtrl",["$scope","toastr","$uibModal","$log","User","Place","Floor","Department","Input","Output","EventsService",function($scope,toastr,$uibModal,$log,User,Place,Floor,Department,Input,Output,EventsService){var auth=!1;User.isAuthenticated()&&($scope.user=User.getCurrent(),$scope.user&&(auth||(auth=!0))),$scope.builder={},$scope.builderModal=function(){var modalInstance=$uibModal.open({templateUrl:"views/pages/builder-modal.html",controller:"BuilderModalCtrl",scope:$scope});modalInstance.result.then(function(builder){builder.organization_id=$scope.user.organization.id;var place={organization_id:builder.organization_id,name:"Demo place",address:builder.address,location:{lat:builder.lat,lng:builder.lng},tags:["Demo place tag"]},floor={organization_id:builder.organization_id,name:"Demo floor",anchors:[{lat:builder.lat,lng:builder.lng},{lat:builder.lat,lng:builder.lng-.001},{lat:builder.lat-.001,lng:builder.lng-.001},{lat:builder.lat-.001,lng:builder.lng}]},department={organization_id:builder.organization_id,name:"Demo department",tags:["Demo place tag"]},input={organization_id:builder.organization_id,name:"Demo input",type:"GPS Geofence",data:{circle:{lat:builder.lat,lng:builder.lng},map:{lat:builder.lat,lng:builder.lng,zoom:18},radius:30}};({organization_id:builder.organization_id,name:"Demo output",type:"Push Messages",title:"Output title",content:"Output content"});Place.create(place,function(placeRef){floor.place_id=placeRef.id,Floor.create(floor,function(floorRef){department.place_id=placeRef.id,department.floor_id=floorRef.id,Department.create(department,function(departmentRef){input.department_id=departmentRef.id,Input.create(input,function(inputRef){toastr.success("Wizard created all required data for you","Wizard finished!")})})})})},function(data){data&&"disableBuilder"===data&&($scope.user.disableBuilder=!0),$log.info("Modal dismissed at: "+new Date)})},!$scope.user.disableBuilder}]).controller("BuilderModalCtrl",["$scope","$uibModalInstance","Geocoder",function($scope,$uibModalInstance,Geocoder){$scope.geoCodeAddress=function(){Geocoder.geocodeAddress($scope.builder.address).then(function(result){$scope.builder.lat=result.lat,$scope.builder.lng=result.lng})},$scope.ok=function(){$uibModalInstance.close($scope.builder)},$scope.cancel=function(data){$uibModalInstance.dismiss(data)}}]),app.controller("PlacesCtrl",["$scope","$uibModal","$log","$filter","ngTableParams","toastr","Place","Metrics",function($scope,$uibModal,$log,$filter,ngTableParams,toastr,Place,Metrics){function getList(){Place.find({},function(list){$scope.places=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Places",subtitle:"subtitle goes here"},$scope.currentUser.$promise.then(function(){Metrics.add("openedPlaces",$scope.currentUser.organization_id)}),$scope.places=[],getList(),$scope.openModal=function(place){$scope.editPlace=!1,place?($scope.place=place,$scope.editPlace=!0,$scope.place.tags||($scope.place.tags=[])):$scope.place={name:"",address:"",location:{lat:"",lng:"",zoom:10},tags:[]};var modalInstance=$uibModal.open({templateUrl:"placeControlModal.html",controller:"PlacesModalCtrl",resolve:{place:function(){return $scope.place},editPlace:function(){return $scope.editPlace}}});modalInstance.result.then(function(place){var runOperation=function(){$scope.place={name:"",address:"",location:{lat:"",lng:""},tags:[]}};Place.upsert(place,function(res){$scope.editPlace===!1?toastr.success("New place has been created","Place Created!"):toastr.success("Place changes has been saved","Place Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.showPlace=function(place){$scope.place=place,$uibModal.open({templateUrl:"placeViewModal.html",controller:"ShowPlaceModalCtrl",resolve:{place:function(){return $scope.place}}})},$scope.deletePlace=function(place){alertify.confirm("Are you sure you want to delete this place?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Place.deleteById({id:place.id},function(res){getList(),toastr.success("Place has been removed","Place Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("places",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.places.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.places,params.orderBy()):$scope.places;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("PlacesModalCtrl",["$scope","$uibModalInstance","place","editPlace","leafletData","Geocoder",function($scope,$uibModalInstance,place,editPlace,leafletData,Geocoder){$scope.place=place,$scope.editPlace=editPlace,$scope.geoCodeAddress=function(){Geocoder.geocodeAddress($scope.place.address).then(function(result){$scope.place.location.lat=result.lat,$scope.place.location.lng=result.lng})},$scope.ok=function(){$scope.addPlaceForm.$valid?$uibModalInstance.close($scope.place):angular.forEach($scope.addPlaceForm.$error.required,function(field){field.$setDirty()})},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]).controller("ShowPlaceModalCtrl",["$scope","$uibModalInstance","place",function($scope,$uibModalInstance,place){$scope.place=place,$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),app.controller("FloorsCtrl",["$scope","$uibModal","$log","$filter","ngTableParams","toastr","Place","Floor","Metrics",function($scope,$uibModal,$log,$filter,ngTableParams,toastr,Place,Floor,Metrics){function getList(){Floor.find({},function(list){$scope.floors=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Floors",subtitle:"subtitle goes here"},$scope.currentUser.$promise.then(function(){Metrics.add("openedFloors",$scope.currentUser.organization_id)}),$scope.places=Place.find(),$scope.floors=[],getList(),$scope.openModal=function(floor){$scope.editing=!1,floor?($scope.floor=floor,$scope.editing=!0):$scope.floor={name:null,place_id:null,floorplan_image_url:null,indooratlas_floor_id:null,indooratlas_floorplan_id:null};var modalInstance=$uibModal.open({templateUrl:"floorCrudModal.html",controller:"FloorsCrudModalCtrl",resolve:{floor:function(){return $scope.floor},places:function(){return $scope.places},editing:function(){return $scope.editing}}});modalInstance.result.then(function(floor){var runOperation=function(){$scope.floor={name:null,place_id:null,floorplan_image_url:null,indooratlas_floor_id:null,indooratlas_floorplan_id:null}};Floor.upsert(floor,function(res){$scope.editing===!1?toastr.success("New floor has been created","Floor Created!"):toastr.success("Floor changes has been saved","Floor Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.show=function(floor){$scope.floor=floor,$uibModal.open({templateUrl:"floorViewModal.html",controller:"ShowFloorModalCtrl",resolve:{floor:function(){return $scope.floor},places:function(){return $scope.places}}})},$scope["delete"]=function(floor){alertify.confirm("Are you sure you want to delete this floor?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Floor.deleteById({id:floor.id},function(res){console.log(res),getList(),toastr.success("Floor has been removed","Floor Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("floors",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.floors.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.floors,params.orderBy()):$scope.floors;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("FloorsCrudModalCtrl",["$scope","$uibModalInstance","floor","editing","leafletData","Geocoder","places","$filter",function($scope,$uibModalInstance,floor,editing,leafletData,Geocoder,places,$filter){$scope.floor=floor,$scope.editing=editing,$scope.places=places,$scope.placeSelect=function(){var floorPlace=$scope.floor.place_id;$scope.place=$filter("filter")(places,{id:floorPlace})[0],$scope.center={lat:$scope.place.location.lat,lng:$scope.place.location.lng,zoom:18}},$scope.center={lat:null,lng:null,zoom:null},angular.extend($scope,{defaults:{maxZoom:22}}),angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}},googleSatellite:{name:"Google Satellite",layerType:"SATELLITE",type:"google"},tangram:{name:"Tangram",type:"tangram",layerOptions:{scene:"scripts/vendor/tangram/scene.yaml",attribution:'<a href="https://mapzen.com/tangram" target="_blank">Tangram</a> | &copy; OSM contributors | <a href="https://mapzen.com/" target="_blank">Mapzen</a>'}}},overlays:{}}});var img,mapLoaded=!1,initializeFloorplan=function(map){$scope.floor.anchors?$scope.floor.anchors=floor.anchors:$scope.floor.anchors=[{lat:$scope.place.location.lat,lng:$scope.place.location.lng},{lat:$scope.place.location.lat,lng:$scope.place.location.lng+.001},{lat:$scope.place.location.lat-.001,lng:$scope.place.location.lng},{lat:$scope.place.location.lat-.001,lng:$scope.place.location.lng+.001}],$scope.floor.floorplan_image_url&&!img?img=new L.DistortableImageOverlay($scope.floor.floorplan_image_url,{corners:$scope.floor.anchors}).addTo(map):$scope.floor.floorplan_image_url||img||(img=new L.DistortableImageOverlay("https://proximi.io/platform_assets/img/no_floorplan_placeholder.png",{corners:$scope.floor.anchors}).addTo(map)),img&&(L.DomEvent.on(img._image,"load",img.editing.enable,img.editing),L.DomEvent.on(img._image,"load",function(){function onEdit(img){$scope.floor.anchors=img._corners}var img=this;img.on("edit",function(){onEdit(img)},img),L.DomEvent.on(img._image,"mouseup",function(){onEdit(img)},img),L.DomEvent.on(img._image,"touchend",function(){onEdit(img)},img)},img)),mapLoaded=!0};$scope.loadMap=function(){floor.anchors&&($scope.center={lat:floor.anchors[0].lat,lng:floor.anchors[0].lng,zoom:18}),leafletData.getMap().then(function(map){setTimeout(function(){map.invalidateSize(),initializeFloorplan(map)},500)})},$scope.makeActive=function(tab){$scope.addForm.$valid?$scope.active=tab:angular.forEach($scope.addForm.$error.required,function(field){field.$setDirty()})},$scope.ok=function(){$scope.addForm.$valid?$uibModalInstance.close($scope.floor):(angular.forEach($scope.addForm.$error.required,function(field){field.$setDirty()}),$scope.active=0)},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]).controller("ShowFloorModalCtrl",["$scope","$uibModalInstance","floor","places",function($scope,$uibModalInstance,floor,places){$scope.floor=floor,$scope.places=places,$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),app.controller("DepartmentsCtrl",["$scope","$uibModal","$log","$filter","ngTableParams","toastr","Place","Floor","Department","Metrics",function($scope,$uibModal,$log,$filter,ngTableParams,toastr,Place,Floor,Department,Metrics){function getList(){Department.find({},function(list){$scope.departments=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Departments",subtitle:"subtitle goes here"},$scope.currentUser.$promise.then(function(){Metrics.add("openedDepartments",$scope.currentUser.organization_id)}),$scope.places=Place.find(),$scope.floors=Floor.find(),$scope.departments=[],getList(),$scope.openModal=function(department){$scope.editDepartment=!1,department?($scope.department=department,$scope.editDepartment=!0,$scope.department.tags||($scope.department.tags=[])):$scope.department={place_id:"",name:"",tags:[]};var modalInstance=$uibModal.open({templateUrl:"departmentControlModal.html",controller:"DepartmentsModalCtrl",resolve:{department:function(){return $scope.department},departments:function(){return $scope.departments},places:function(){return $scope.places},floors:function(){return $scope.floors},editDepartment:function(){return $scope.editDepartment}}});modalInstance.result.then(function(department){var runOperation=function(departmentRef){$scope.department={place_id:"",name:"",tags:[]}};Department.upsert(department,function(res){$scope.editDepartment===!1?toastr.success("New department has been created","Department Created!"):toastr.success("Department changes has been saved","Department Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.showDepartment=function(department){$scope.department=department,$uibModal.open({templateUrl:"departmentViewModal.html",controller:"ShowDepartmentModalCtrl",resolve:{department:function(){return $scope.department},places:function(){return $scope.places},floors:function(){return $scope.floors}}})},$scope.deleteDepartment=function(department){alertify.confirm("Are you sure you want to delete this department?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Department.deleteById({id:department.id},function(res){console.log(res),getList(),toastr.success("Department has been removed","Department Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("departments",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.departments.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.departments,params.orderBy()):$scope.departments;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("DepartmentsModalCtrl",["$scope","$uibModalInstance","places","department","editDepartment","leafletData","floors","departments","$filter",function($scope,$uibModalInstance,places,department,editDepartment,leafletData,floors,departments,$filter){$scope.places=places,$scope.department=department,$scope.editDepartment=editDepartment,$scope.floors=floors,$scope.placeSelected=!1,$scope.placeSelect=function(){$scope.placeSelected=!0;var departmentPlace=$scope.department.place_id;$scope.floors=$filter("filter")(floors,{place_id:departmentPlace})},$scope.floorSelect=function(){var departmentFloor=$scope.department.floor_id;$scope.floor=$filter("filter")(floors,{id:departmentFloor})[0]},editDepartment&&($scope.placeSelect(),$scope.floorSelect()),$scope.ok=function(){$scope.addDepartmentForm.$valid?$uibModalInstance.close($scope.department):angular.forEach($scope.addDepartmentForm.$error.required,function(field){field.$setDirty()})},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]).controller("ShowDepartmentModalCtrl",["$scope","$uibModalInstance","department","places","floors",function($scope,$uibModalInstance,department,places,floors){$scope.department=department,$scope.places=places,$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),app.controller("InputsCtrl",["$scope","$uibModal","$log","$filter","ngTableParams","toastr","Input","Department","Place","Floor","Metrics",function($scope,$uibModal,$log,$filter,ngTableParams,toastr,Input,Department,Place,Floor,Metrics){function getList(){Input.find({},function(list){$scope.inputs=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Inputs",subtitle:"subtitle goes here"},$scope.currentUser.$promise.then(function(){Metrics.add("openedInputs",$scope.currentUser.organization_id)}),$scope.places=Place.find(),$scope.floors=Floor.find(),$scope.departments=Department.find(),$scope.inputs=[],getList(),$scope.openModal=function(input){$scope.editInput=!1,input?($scope.input=input,$scope.editInput=!0):$scope.input={name:"",type:"",data:{marker:{},major:"",minor:"",uuid:""}};var modalInstance=$uibModal.open({templateUrl:"inputControlModal.html",controller:"InputsModalCtrl",resolve:{input:function(){return $scope.input},editInput:function(){return $scope.editInput},departments:function(){return $scope.departments},places:function(){return $scope.places},floors:function(){return $scope.floors}}});modalInstance.result.then(function(input){var runOperation=function(){$scope.input={name:"",type:"",data:{marker:{},major:"",minor:"",uuid:""}}};if("iBeacon"===input.type){var iBeaconInput={id:input.id||null,name:input.name,type:input.type,department_id:input.department_id,data:{major:input.data.major,minor:input.data.minor,uuid:input.data.uuid,marker:{lat:input.data.marker.lat,lng:input.data.marker.lng}},triggerFloorChange:input.triggerFloorChange||null,floor_id:input.floor_id||null,triggerVenueChange:input.triggerVenueChange||null,place_id:input.place_id||null,createdAt:null,updatedAt:null};Input.upsert(iBeaconInput,function(res){console.log(res),$scope.editInput===!1?toastr.success("New input has been created","Input Created!"):toastr.success("Input changes has been saved","Input Updated!"),runOperation(),getList()},function(res){console.log(res)})}if("Eddystone Beacon"===input.type){var eddystoneInput={id:input.id||null,name:input.name,type:input.type,department_id:input.department_id,data:{namespaceid:input.data.namespaceid,instanceid:input.data.instanceid,marker:{lat:input.data.marker.lat,lng:input.data.marker.lng}},triggerFloorChange:input.triggerFloorChange||null,
floor_id:input.floor_id||null,triggerVenueChange:input.triggerVenueChange||null,place_id:input.place_id||null,createdAt:null,updatedAt:null};Input.upsert(eddystoneInput,function(res){$scope.editInput===!1?toastr.success("New input has been created","Input Created!"):toastr.success("Input changes has been saved","Input Updated!"),runOperation(),getList()},function(res){console.log(res)})}if("Custom"===input.type){var customInput={id:input.id||null,name:input.name,type:input.type,department_id:input.department_id,data:{marker:{lat:input.data.marker.lat,lng:input.data.marker.lng}},createdAt:null,updatedAt:null};Input.upsert(customInput,function(res){$scope.editInput===!1?toastr.success("New input has been created","Input Created!"):toastr.success("Input changes has been saved","Input Updated!"),runOperation(),getList()},function(res){console.log(res)})}},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.showInput=function(input){$scope.input=input,$uibModal.open({templateUrl:"inputViewModal.html",controller:"ShowInputModalCtrl",resolve:{input:function(){return $scope.input}}})},$scope.deleteInput=function(input){alertify.confirm("Are you sure you want to delete this input?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Input.deleteById({id:input.id},function(res){console.log(res),getList(),toastr.success("Input has been removed","Input Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("inputs",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.inputs.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.inputs,params.orderBy()):$scope.inputs;params.total($scope.inputs.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("InputsModalCtrl",["$scope","$uibModalInstance","input","editInput","leafletData","departments","places","floors","$filter",function($scope,$uibModalInstance,input,editInput,leafletData,departments,places,floors,$filter){$scope.input=input,$scope.editInput=editInput,$scope.departments=departments,$scope.floors=floors,$scope.places=places,$scope.inputTypes={iBeacon:"iBeacon",eddystone:"Eddystone Beacon",custom:"Custom"},$scope.departmentSelect=function(){var lat,lng,department_id=$scope.input.department_id;$scope.department=$filter("filter")(departments,{id:department_id})[0],$scope.place=$filter("filter")(places,{id:$scope.department.place_id})[0],input.department_id&&$scope.place?(lat=$scope.place.location.lat,lng=$scope.place.location.lng,input.data.marker.lat=lat,input.data.marker.lng=lng):(input.data.marker.lat=0,input.data.marker.lng=0)},editInput&&input.department_id&&($scope.department=$filter("filter")(departments,{id:input.department_id})[0]),angular.extend($scope,{defaults:{maxZoom:22}}),angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{subdomains:["a","b","c"],attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}},googleSatellite:{name:"Google Satellite",layerType:"SATELLITE",type:"google"},tangram:{name:"Tangram",type:"tangram",layerOptions:{scene:"scripts/vendor/tangram/scene.yaml",attribution:'<a href="https://mapzen.com/tangram" target="_blank">Tangram</a> | &copy; OSM contributors | <a href="https://mapzen.com/" target="_blank">Mapzen</a>'}}},overlays:{}}}),$scope.location={lat:0,lng:0,zoom:18};var mapLoaded=!1;$scope.loadMap=function(){mapLoaded||(mapLoaded=!0,$scope.location.lat=$scope.input.data.marker.lat,$scope.location.lng=$scope.input.data.marker.lng,$scope.place_id=$scope.department.place_id,$scope.floor_id=$scope.department.floor_id,$scope.floor=$filter("filter")(floors,{id:$scope.floor_id})[0],$scope.anchors=$scope.floor.anchors,$scope.url=$scope.floor.floorplan_image_url,leafletData.getMap().then(function(map){setTimeout(function(){$scope.layers.overlays[$scope.floor.name]={name:$scope.floor.name,type:"imageDistort",url:$scope.url,anchors:$scope.anchors,options:{corners:$scope.anchors},visible:!0},angular.extend($scope,{markers:{}}),("iBeacon"===input.type||"Eddystone Beacon"===input.type||"Custom"===input.type)&&($scope.markers={m1:{focus:!0,draggable:!0,lat:input.data.marker.lat,lng:input.data.marker.lng,icon:{type:"div",className:"beacon-map-marker",iconSize:200,iconAnchor:[100,123],html:'<div contenteditable="true">'+input.name+"</div>"}}},$scope.$on("leafletDirectiveMarker.dragend",function(event,args){input.data.marker.lat=args.model.lat,input.data.marker.lng=args.model.lng})),"Custom"===input.type&&($scope.markers.m1.icon.className="custom-map-marker"),map.invalidateSize()},500)}))},$scope.$watch("active",function(newVal,oldVal){mapLoaded=!1}),$scope.makeActive=function(tab){$scope.addInputForm.$valid?$scope.active=tab:angular.forEach($scope.addInputForm.$error.required,function(field){field.$setDirty()})},$scope.ok=function(){$scope.addInputForm.$valid?$uibModalInstance.close($scope.input):(angular.forEach($scope.addInputForm.$error.required,function(field){field.$setDirty()}),$scope.active=0,mapLoaded=!1)},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]).controller("ShowInputModalCtrl",["$scope","$uibModalInstance","input",function($scope,$uibModalInstance,input){$scope.input=input,$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),app.controller("ImportInputsCtrl",["$scope","$uibModal","$log","$http","$filter","ngTableParams","toastr","Input","Department","Place","Floor","Metrics",function($scope,$uibModal,$log,$http,$filter,ngTableParams,toastr,Input,Department,Place,Floor,Metrics){function initKontaktIOTable(){$scope.kontaktio.table=new ngTableParams({page:1,count:10,sorting:{uniqueId:"asc"}},{total:$scope.kontaktio.devices.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.kontaktio.devices,params.orderBy()):$scope.kontaktio.devices;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}function initEstimoteTable(){$scope.estimote.table=new ngTableParams({page:1,count:10,sorting:{uniqueId:"asc"}},{total:$scope.estimote.devices.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.estimote.devices,params.orderBy()):$scope.estimote.devices;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}function initSensoroTable(){$scope.sensoro.table=new ngTableParams({page:1,count:10,sorting:{uniqueId:"asc"}},{total:$scope.sensoro.devices.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.sensoro.devices,params.orderBy()):$scope.sensoro.devices;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}$scope.currentUser.$promise.then(function(){Metrics.add("openedImportInputs",$scope.currentUser.organization_id)}),$scope.page={title:"Import Inputs",subtitle:"subtitle goes here"},$scope.places=Place.find(),$scope.floors=Floor.find(),$scope.departments=Department.find(),$scope.inputs=Input.find(),$scope.kontaktio={connect:!1},$scope.estimote={connect:!1},$scope.sensoro={connect:!1},$scope.kontaktIOReq={method:"GET",url:"https://api.kontakt.io/device",headers:{"Api-Key":null,Accept:"application/vnd.com.kontakt+json; version=7"}},$scope.estimoteReq={method:"GET",url:"https://api.kontakt.io/device",headers:{"Api-Key":null,Accept:"application/vnd.com.kontakt+json; version=7"}};var getKontaktIO=function(){$scope.kontaktio.devices=[],$http($scope.kontaktIOReq).then(function(response){angular.forEach(response.data.devices,function(value,key){"CLOUD_BEACON"!==value.deviceType&&$scope.kontaktio.devices.push(value)}),$scope.kontaktio.connect=!0,initKontaktIOTable(),console.log($scope.kontaktio.devices)},function(response){console.log(response)})},getEstimote=function(){$scope.estimote.devices=[],$http($scope.estimoteReq).then(function(response){angular.forEach(response.data.devices,function(value,key){"CLOUD_BEACON"!==value.deviceType&&$scope.estimote.devices.push(value)}),$scope.estimote.connect=!0,initEstimoteTable(),console.log($scope.estimote.devices)},function(response){console.log(response)})},getSensoro=function(){$scope.sensoro.devices=[],angular.element.ajax({url:"https://cloud-api.sensoro.com/users/me/beacons",beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Basic "+btoa($scope.sensoro.email+":"+$scope.sensoro.password))},type:"GET",contentType:"application/json",success:function(data){angular.forEach(data,function(value,key){var x=value.UMM.split("|");value.uuid=x[0],value.major=parseInt("0x"+x[1]),value.minor=parseInt("0x"+x[2]),value.type="sensoro",$scope.sensoro.devices.push(value)}),$scope.sensoro.connect=!0,initSensoroTable(),$scope.$apply(),console.log($scope.sensoro.devices)},error:function(data){console.log(data)}})};$scope.connect=function(source){"kontaktIO"===source&&($scope.kontaktIOReq.headers["Api-Key"]=$scope.kontaktio.apiKey,getKontaktIO()),"estimote"===source&&($scope.estimoteReq.headers["Api-Key"]=$scope.estimote.apiKey,getEstimote()),"sensoro"===source&&getSensoro()},$scope.refresh=function(source){"kontaktIO"===source&&getKontaktIO(),"estimote"===source&&getEstimote(),"sensoro"===source&&getSensoro()},$scope.openModal=function(input){$scope.input=input;var modalInstance=$uibModal.open({templateUrl:"inputControlModal.html",controller:"ImportInputsModalCtrl",resolve:{input:function(){return $scope.input},departments:function(){return $scope.departments},places:function(){return $scope.places},floors:function(){return $scope.floors}}});modalInstance.result.then(function(input){console.log(input),input.organization_id=$scope.currentUser.organization.id,Input.create(input,function(res){console.log(res),toastr.success("New input has been created","Input Created!")},function(res){console.log(res)})},function(){$log.info("Modal dismissed at: "+new Date)})}}]).controller("ImportInputsModalCtrl",["$scope","$uibModalInstance","input","leafletData","departments","places","floors","$filter",function($scope,$uibModalInstance,input,leafletData,departments,places,floors,$filter){input.marker={},$scope.input={data:input},$scope.departments=departments,$scope.floors=floors,$scope.places=places,input.type&&"sensoro"===input.type?($scope.input.name=input.mac,$scope.input.data.marker.lat=input.lonlat[0],$scope.input.data.marker.lng=input.lonlat[1],$scope.input.type="iBeacon",$scope.input.data.uuid=input.uuid):$scope.input.name=input.uniqueId,input.profiles&&"EDDYSTONE"===input.profiles[0]&&($scope.input.type="Eddystone Beacon",$scope.input.data.namespaceid=input.namespace,$scope.input.data.instanceid=input.instanceId),input.profiles&&"IBEACON"===input.profiles[0]&&($scope.input.type="iBeacon",$scope.input.data.uuid=input.proximity),$scope.departmentSelect=function(){var lat,lng,department_id=$scope.input.department_id;$scope.department=$filter("filter")(departments,{id:department_id})[0],$scope.place=$filter("filter")(places,{id:$scope.department.place_id})[0],$scope.department.anchors?(lat=$scope.department.anchors[0].lat,lng=$scope.department.anchors[0].lng,$scope.input.data.marker.lat=lat,$scope.input.data.marker.lng=lng):(lat=$scope.place.location.lat,lng=$scope.place.location.lng,$scope.input.data.marker.lat=lat,$scope.input.data.marker.lng=lng)},$scope.location={lat:0,lng:0,zoom:18},angular.extend($scope,{defaults:{maxZoom:22}}),angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{subdomains:["a","b","c"],attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}},googleSatellite:{name:"Google Satellite",layerType:"SATELLITE",type:"google"},tangram:{name:"Tangram",type:"tangram",layerOptions:{scene:"scripts/vendor/tangram/scene.yaml",attribution:'<a href="https://mapzen.com/tangram" target="_blank">Tangram</a> | &copy; OSM contributors | <a href="https://mapzen.com/" target="_blank">Mapzen</a>'}}},overlays:{}}});var mapLoaded=!1;$scope.loadMap=function(){mapLoaded||(mapLoaded=!0,$scope.location.lat=$scope.input.data.marker.lat,$scope.location.lng=$scope.input.data.marker.lng,console.log($scope.input),$scope.polygon=$scope.department.anchors,$scope.place_id=$scope.department.place_id,$scope.floor_id=$scope.department.floor_id,$scope.floor=$filter("filter")(floors,{id:$scope.floor_id})[0],$scope.anchors=$scope.floor.anchors,$scope.url=$scope.floor.floorplan_image_url,leafletData.getMap().then(function(map){setTimeout(function(){$scope.layers.overlays[$scope.floor.name]={name:$scope.floor.name,type:"imageDistort",url:$scope.url,anchors:$scope.anchors,options:{corners:$scope.anchors},visible:!0},angular.extend($scope,{markers:{}}),("iBeacon"===$scope.input.type||"Eddystone Beacon"===$scope.input.type)&&($scope.markers={m1:{focus:!0,draggable:!0,lat:$scope.input.data.marker.lat,lng:$scope.input.data.marker.lng,icon:{type:"div",className:"beacon-map-marker",iconSize:200,iconAnchor:[100,123],html:'<div contenteditable="true">'+$scope.input.name+"</div>"}}},$scope.$on("leafletDirectiveMarker.dragend",function(event,args){$scope.input.data.marker.lat=args.model.lat,$scope.input.data.marker.lng=args.model.lng})),map.invalidateSize()},500)}))},$scope.$watch("active",function(newVal,oldVal){mapLoaded=!1}),$scope.makeActive=function(tab){$scope.addInputForm.$valid?$scope.active=tab:angular.forEach($scope.addInputForm.$error.required,function(field){field.$setDirty()})},$scope.ok=function(){$scope.addInputForm.$valid?$uibModalInstance.close($scope.input):(angular.forEach($scope.addInputForm.$error.required,function(field){field.$setDirty()}),$scope.active=0,mapLoaded=!1)},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),app.controller("OutputsCtrl",["$scope","$uibModal","$log","$filter","ngTableParams","toastr","Output","EventsService",function($scope,$uibModal,$log,$filter,ngTableParams,toastr,Output,EventsService){function getList(){Output.find({},function(list){$scope.outputs=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Outputs",subtitle:"subtitle goes here"},$scope.outputs=[],getList(),$scope.openModal=function(output){$scope.editOutput=!1,output?($scope.output=output,$scope.editOutput=!0):$scope.output={name:""};var modalInstance=$uibModal.open({templateUrl:"outputControlModal.html",controller:"OutputsModalCtrl",resolve:{output:function(){return $scope.output},editOutput:function(){return $scope.editOutput}}});modalInstance.result.then(function(output){var pairs=output[1];output=output[0];var runOperation=function(){$scope.output={name:""}};pairs&&pairs.length>0?(output.pairs={},angular.forEach(pairs,function(value,key){"number"===value.type?output.pairs[value.key]=parseFloat(value.value):output.pairs[value.key]=value.value})):delete output.pairs,Output.upsert(output,function(res){$scope.editOutput===!1?toastr.success("New output has been created","Output Created!"):toastr.success("Output changes has been saved","Output Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.showOutput=function(output){$scope.output=output,$uibModal.open({templateUrl:"outputViewModal.html",controller:"ShowOutputModalCtrl",resolve:{output:function(){return $scope.output}}})},$scope.deleteOutput=function(output){alertify.confirm("Are you sure you want to delete this output?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Output.deleteById({id:output.id},function(res){getList(),toastr.success("Output has been removed","Output Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("outputs",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.outputs.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.outputs,params.orderBy()):$scope.outputs;params.total($scope.outputs.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("OutputsModalCtrl",["$scope","$uibModalInstance","output","editOutput",function($scope,$uibModalInstance,output,editOutput){$scope.output=output,$scope.editOutput=editOutput,$scope.inputTypes={number:"Number",text:"String"},$scope.pairs=[],$scope.output.pairs&&angular.forEach($scope.output.pairs,function(value,key){isNaN(value)?$scope.pairs.push({key:key,value:value,type:"text"}):$scope.pairs.push({key:key,value:value,type:"number"})}),$scope.addPair=function(){$scope.pairs.push({key:null,value:null,type:"text"})},$scope.removePair=function(index){$scope.pairs.splice(index,1)},$scope.ok=function(){$uibModalInstance.close([$scope.output,$scope.pairs])},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]).controller("ShowOutputModalCtrl",["$scope","$uibModalInstance","output",function($scope,$uibModalInstance,output){$scope.output=output,$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),app.controller("ApiKeysCtrl",["$scope","$uibModal","$log","$filter","ngTableParams","$http","Application",function($scope,$uibModal,$log,$filter,ngTableParams,$http,Application){function getList(){Application.find({},function(list){$scope.applications=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Api Keys",subtitle:"subtitle goes here"},$scope.currentUser.$promise.then(function(){var tokenGenURL="https://proximiio-token-generator.herokuapp.com";$scope.authToken="Obtaining the auth-token, please wait...";var payload={organization:$scope.currentUser.organization_id,uid:"user.uid",token:"user.token"};$http.post(tokenGenURL,payload).success(function(data,status,headers,config){$scope.authToken=data}).error(function(data,status,headers,config){})}),$scope.applications=[],getList()}]),app.controller("GeofencesCtrl",["$scope","$uibModal","$log","$filter","ngTableParams","toastr","Place","Geofence","Department","Floor","Metrics","Input",function($scope,$uibModal,$log,$filter,ngTableParams,toastr,Place,Geofence,Department,Floor,Metrics,Input){function getList(){Geofence.find({},function(list){$scope.geofences=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Geofences",subtitle:"subtitle goes here"},$scope.currentUser.$promise.then(function(){Metrics.add("openedGeofences",$scope.currentUser.organization_id)}),$scope.places=Place.find(),$scope.departments=Department.find(),$scope.floors=Floor.find(),$scope.inputs=Input.find(),$scope.geofences=[],getList(),$scope.openModal=function(geofence){$scope.editing=!1,geofence?($scope.geofence=geofence,$scope.editing=!0):$scope.geofence={area:{}};var modalInstance=$uibModal.open({templateUrl:"geofenceControlModal.html",controller:"GeofenceModalCtrl",resolve:{geofence:function(){return $scope.geofence},places:function(){return $scope.places},departments:function(){return $scope.departments},floors:function(){return $scope.floors},inputs:function(){return $scope.inputs},editing:function(){return $scope.editing}}});modalInstance.result.then(function(geofence){var runOperation=function(){$scope.geofence={area:{}}};console.log("should upsert geofence: ",geofence),Geofence.upsert(geofence,function(res){$scope.editing===!1?toastr.success("New geofence has been created","Geofence Created!"):toastr.success("Geofence changes has been saved","Geofence Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.show=function(geofence){$scope.geofence=geofence,$uibModal.open({templateUrl:"geofenceViewModal.html",controller:"ShowGeofenceModalCtrl",resolve:{geofence:function(){return $scope.geofence},places:function(){return $scope.places},departments:function(){return $scope.departments}}})},$scope["delete"]=function(geofence){alertify.confirm("Are you sure you want to delete this ge?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Geofence.deleteById({id:geofence.id},function(res){console.log(res),getList(),toastr.success("Geofence has been removed","Geofence Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("geofences",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.geofences.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.geofences,params.orderBy()):$scope.geofences;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("GeofenceModalCtrl",["$scope","$uibModalInstance","geofence","editing","leafletData","Geocoder","places","departments","floors","$filter","inputs",function($scope,$uibModalInstance,geofence,editing,leafletData,Geocoder,places,departments,floors,$filter,inputs){$scope.geofence=geofence,$scope.editing=editing,$scope.places=places,$scope.departments=departments,$scope.floors=floors,console.log(inputs),$scope.geoCodeAddress=function(){Geocoder.geocodeAddress($scope.geofence.address).then(function(result){$scope.geofence.area.lat=result.lat,$scope.geofence.area.lng=result.lng})},geofence.place_id&&($scope.filteredDepartments=$filter("filter")($scope.departments,{place_id:geofence.place_id})),$scope.placeSelect=function(){var geofencePlace=$scope.geofence.place_id,place=$filter("filter")(places,{id:geofencePlace})[0];$scope.geofence.address=place.address,$scope.geofence.area.lat=place.location.lat,$scope.geofence.area.lng=place.location.lng,$scope.filteredDepartments=$filter("filter")($scope.departments,{place_id:place.id})},angular.extend($scope,{defaults:{maxZoom:22}}),angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}},googleSatellite:{name:"Google Satellite",layerType:"SATELLITE",type:"google"},tangram:{name:"Tangram",type:"tangram",layerOptions:{scene:"scripts/vendor/tangram/scene.yaml",attribution:'<a href="https://mapzen.com/tangram" target="_blank">Tangram</a> | &copy; OSM contributors | <a href="https://mapzen.com/" target="_blank">Mapzen</a>'}}},overlays:{beacons:{type:"group",name:"Beacons",visible:!0}}}}),$scope.location={lat:0,lng:0,zoom:18};var mapLoaded=!1;$scope.loadMap=function(){mapLoaded||(mapLoaded=!0,$scope.location.lat=$scope.geofence.area.lat,$scope.location.lng=$scope.geofence.area.lng,leafletData.getMap().then(function(map){map.editTools=new L.Editable(map),setTimeout(function(){var img;angular.forEach($scope.floors,function(value,key){value.floorplan_image_url?(value.anchors&&(img=new L.DistortableImageOverlay(value.floorplan_image_url,{corners:value.anchors})),map.addLayer(img)):console.log("nemam")}),angular.extend($scope,{markers:{}}),angular.forEach(inputs,function(input){$scope.markers[input.name]={layer:"beacons",lat:input.data.marker.lat,lng:input.data.marker.lng,icon:{type:"div",className:"beacon-map-marker",iconSize:200,iconAnchor:[100,123],html:'<div contenteditable="true">'+input.name+"</div>"}}});var circle=L.circle([$scope.geofence.area.lat,$scope.geofence.area.lng],$scope.geofence.radius).addTo(map);circle.enableEdit(),map.on("editable:editing",function(e){var layer=e.layer;$scope.geofence.area.lat=layer._latlng.lat,$scope.geofence.area.lng=layer._latlng.lng,$scope.geofence.radius=layer._mRadius}),map.invalidateSize()},500)}))},$scope.$watch("active",function(newVal,oldVal){mapLoaded=!1}),$scope.makeActive=function(tab){$scope.addForm.$valid?$scope.active=tab:angular.forEach($scope.addForm.$error.required,function(field){field.$setDirty()})},$scope.ok=function(){$scope.addForm.$valid?$uibModalInstance.close($scope.geofence):(angular.forEach($scope.addForm.$error.required,function(field){field.$setDirty()}),$scope.active=0,mapLoaded=!1)},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]).controller("ShowGeofenceModalCtrl",["$scope","$uibModalInstance","geofence",function($scope,$uibModalInstance,geofence){$scope.geofence=geofence,$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),app.controller("DebugCtrl",["$scope","$filter","ngTableParams","compressArray","$timeout","$firebaseArray","FBURL","Event","Metrics",function($scope,$filter,ngTableParams,compressArray,$timeout,$firebaseArray,FBURL,Event,Metrics){function getList(){Event.find({},function(list){$scope.events=$filter("filter")(list,{event:"config-change"}),initTable()},function(errorResponse){console.log(errorResponse)})}function initTable(){$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{createdAt:"desc"}},{total:$scope.events.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.events,params.orderBy()):$scope.events;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}$scope.page={title:"Debug",subtitle:"Debug all the events"},$scope.currentUser.$promise.then(function(){Metrics.add("openedDebug",$scope.currentUser.organization_id)});var organization,ref=new Firebase(FBURL);$scope.events=[],$scope.currentUser.$promise.then(function(){organization=$scope.currentUser.organization_id,ref.child("organizations").child(organization).child("last_event").on("value",function(dataSnapshot){getList()})})}]),app.controller("ApplicationsCtrl",["$scope","$uibModal","$log","$filter","ngTableParams","toastr","Application","AuthService","$rootScope","Metrics",function($scope,$uibModal,$log,$filter,ngTableParams,toastr,Application,AuthService,$rootScope,Metrics){function getList(){Application.find({},function(list){$scope.applications=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Applications",subtitle:"subtitle goes here"},$scope.currentUser.$promise.then(function(){Metrics.add("openedApplications",$scope.currentUser.organization_id)}),$scope.applications=[],getList(),$scope.openModal=function(application){$scope.editing=!1,application?($scope.application=application,$scope.editing=!0):$scope.application={name:"",type:"mobile",settings:{gpsgeofences:!1,ibeacons:!1,indooratlas:!1,steerpath:!1,eddystone:!1}};var modalInstance=$uibModal.open({templateUrl:"applicationModal.html",controller:"ApplicationsModalCtrl",resolve:{application:function(){return $scope.application},editing:function(){return $scope.editing}}});modalInstance.result.then(function(application){var runOperation=function(){$scope.application={name:"",type:"mobile",settings:{gpsgeofences:!1,ibeacons:!1,indooratlas:!1,steerpath:!1,eddystone:!1}}};Application.upsert(application,function(res){$scope.editing===!1?(toastr.success("New application has been created","Application Created!"),$rootScope.currentUser=AuthService.getCurrentUser()):toastr.success("Application changes has been saved","Application Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.show=function(application){$scope.application=application,$uibModal.open({templateUrl:"applicationViewModal.html",controller:"ShowApplicationModalCtrl",resolve:{application:function(){return $scope.application}}})},$scope["delete"]=function(application){alertify.confirm("Are you sure you want to delete this application?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Application.deleteById({id:application.id},function(res){console.log(res),getList(),toastr.success("Application has been removed","Application Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.getToken=function(application){var app=$filter("filter")($scope.currentUser.tokens,application,!0)[0],token="null";app&&(token=Object.keys(app)[0]),alertify.alert("<pre>"+token+"</pre>").set({transition:"zoom"}).set("title","Application Token!").set("onok",function(closeEvent){console.log("close")})},$scope.$watchCollection("applications",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.applications.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.applications,params.orderBy()):$scope.applications;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("ApplicationsModalCtrl",["$scope","$uibModalInstance","application","editing",function($scope,$uibModalInstance,application,editing){$scope.application=application,$scope.editing=editing,$scope.accuracies=[{id:1,name:"Cellular"},{id:2,name:"Wifi"},{id:3,name:"GPS"}],$scope.ok=function(){$scope.addForm.$valid?$uibModalInstance.close($scope.application):angular.forEach($scope.addForm.$error.required,function(field){field.$setDirty()})},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]).controller("ShowApplicationModalCtrl",["$scope","$uibModalInstance","application",function($scope,$uibModalInstance,application){$scope.application=application,$scope.accuracies=[{id:1,name:"Cellular"},{id:2,name:"Wifi"},{id:3,name:"GPS"}],$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),app.controller("AnalyticsCtrl",["$scope","$stateParams","leafletData","$filter","Visitor","Floor","Analytics","Metrics",function($scope,$stateParams,leafletData,$filter,Visitor,Floor,Analytics,Metrics){function getList(){$scope.analytics=Analytics.getVisitor({id:id,date_from:$filter("date")($scope.myDates.startDate,"yyyy-MM-dd"),date_to:$filter("date")($scope.myDates.endDate,"yyyy-MM-dd")},function(list){$scope.analytics=list,console.log(list),getDateRange(),tagsChart(),heatMap()},function(errorResponse){console.log(errorResponse)})}function getDateRange(){$scope.dateRange=[];for(var firstDate=parseInt(moment.utc($scope.myDates.startDate).startOf("day").format("x"))+864e5,lastDate=parseInt(moment.utc($scope.myDates.endDate).endOf("day").format("x"))-864e5,dayDuration=864e5,x=(lastDate-firstDate)/dayDuration,i=0;x>i;i++)$scope.dateRange.push($filter("date")(firstDate,"dd MMM yy")),firstDate=parseInt(firstDate)+dayDuration}function tagsChart(){$scope.donutData=[],angular.forEach($scope.analytics.visitor.tags,function(value,key){$scope.donutData.push({label:value.group[0],value:value.reduction})})}function heatMap(){$scope.heatmapPoints=[],angular.forEach($scope.analytics.visitor.positions,function(value,key){value&&value.lat&&value.lng&&$scope.heatmapPoints.push([value.lat,value.lng])}),$scope.heatmapPoints.length>0&&($scope.lastPosition=$scope.heatmapPoints.pop(),$scope.center={lat:parseFloat($scope.lastPosition[0]),lng:parseFloat($scope.lastPosition[1]),zoom:18}),leafletData.getMap().then(function(map){$scope.slider={maxValue:$scope.dateRange.length-1,minValue:0,options:{stepsArray:$scope.dateRange,showSelectionBar:!0,showTicks:!0,ticksTooltip:function(v){return $scope.dateRange[v]},onEnd:function(sliderId,modelValue,highValue){$scope.heatmapPoints=[],Analytics.getVisitor({id:id,date_from:moment($scope.dateRange[modelValue],"DD-MMM-YY").format("YYYY-MM-DD"),
date_to:moment($scope.dateRange[highValue],"DD-MMM-YY").add(1,"days").format("YYYY-MM-DD")},function(list){angular.forEach(list.visitor.positions,function(value,key){value&&value.lat&&value.lng&&$scope.heatmapPoints.push([value.lat,value.lng])}),$scope.layers.overlays.heat={name:"Heat Map",type:"heat",data:$scope.heatmapPoints,layerOptions:{radius:25,blur:30},visible:!0,doRefresh:!0}},function(errorResponse){console.log(errorResponse)})}}},angular.forEach($scope.floors,function(value,key){value.floorplan_image_url&&value.anchors&&($scope.layers.overlays[value.name]={name:value.name,type:"imageDistort",url:value.floorplan_image_url,anchors:value.anchors,options:{corners:value.anchors},visible:!0})}),$scope.layers.overlays.heat={name:"Heat Map",type:"heat",data:$scope.heatmapPoints,layerOptions:{radius:25,blur:30},visible:!0,doRefresh:!0}})}$scope.page={title:"Analytics",subtitle:"subtitle goes here"},$scope.currentUser.$promise.then(function(){Metrics.add("openedAnonymousAnalytics",$scope.currentUser.organization_id)}),$scope.myDates={startDate:moment().subtract(29,"days").startOf("day").format(),endDate:moment().add(1,"days").endOf("day").format()},$scope.config1={format:"Do MMM YYYY",shortcuts:[{name:"Today",from:moment().startOf("day"),to:moment().endOf("day")},{name:"Yesterday",from:moment().subtract(1,"days").startOf("day"),to:moment().subtract(1,"days").endOf("day")},{name:"Last 30 Days",from:moment().subtract(29,"days").startOf("day"),to:moment().endOf("day")},{name:"This Week",from:moment().startOf("week"),to:moment().endOf("week")},{name:"Last Week",from:moment().subtract(1,"week").startOf("week"),to:moment().subtract(1,"week").endOf("week")},{name:"This Month",from:moment().startOf("month"),to:moment().endOf("month")},{name:"Last Month",from:moment().subtract(1,"month").startOf("month"),to:moment().subtract(1,"month").endOf("month")}]};var id=$stateParams.id;$scope.floors=Floor.find(),$scope.analytics=[],getList(),$scope.$watch("myDates",function(newVal,oldVal){newVal!==oldVal&&getList()},!0),getDateRange(),$scope.center={lat:0,lng:0,zoom:22},angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{subdomains:["a","b","c"],attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}},googleSatellite:{name:"Google Satellite",layerType:"SATELLITE",type:"google"},tangram:{name:"Tangram",type:"tangram",layerOptions:{scene:"scripts/vendor/tangram/scene.yaml",attribution:'<a href="https://mapzen.com/tangram" target="_blank">Tangram</a> | &copy; OSM contributors | <a href="https://mapzen.com/" target="_blank">Mapzen</a>'}}},overlays:{}}}),Analytics.getVisitorPaths({id:id},function(list){$scope.paths=list}),$scope.dwellTime=function(dwellTime){return dwellTime?moment.duration(dwellTime,"seconds").humanize():void 0},$scope.getSnippet=function(target){var content;content="curl -X GET \\ \n--header 'Content-Type: application/json' \\ \n--header 'Accept: application/json' \\ \n--header 'Authorization: Bearer "+$scope.currentUser.data.token+"' \\ \n'https://api.proximi.fi/core/"+target+"/"+id+"'",alertify.alert("<pre>"+content+"</pre>").set({transition:"zoom"}).set("title","Get CURL snippet!").set("onok",function(closeEvent){console.log("close")})}}]),app.controller("ReportsCtrl",["$scope","$filter","ngTableParams","compressArray","$moment","leafletData","$timeout","toastr","Analytics","Floor","Metrics",function($scope,$filter,ngTableParams,compressArray,$moment,leafletData,$timeout,toastr,Analytics,Floor,Metrics){function getList(){Analytics.getOverview({date_from:$filter("date")($scope.myDates.startDate,"yyyy-MM-dd"),date_to:$filter("date")($scope.myDates.endDate,"yyyy-MM-dd"),place_id:$scope.filters.place,floor_id:$scope.filters.floor},function(list){$scope.analytics=list,console.log(list),loadChart(),heatMap()},function(errorResponse){console.log(errorResponse)})}function loadChart(){$scope.dataset=[],$scope.dateRange=[];var ticks=[],yAxisData=[],firstDate=parseInt(moment.utc($scope.myDates.startDate).startOf("day").format("x"))+864e5,lastDate=parseInt(moment.utc($scope.myDates.endDate).endOf("day").format("x"))-864e5,dayDuration=864e5,x=(lastDate-firstDate)/dayDuration;$scope.options={series:{shadowSize:0},legend:{backgroundOpacity:0,margin:-7,position:"ne",noColumns:2},xaxis:{tickLength:0,font:{color:"#fff"},position:"bottom",ticks:ticks},yaxis:{tickLength:0,tickDecimals:0,font:{color:"#fff"}},grid:{borderWidth:{top:0,right:0,bottom:1,left:1},borderColor:"rgba(255,255,255,.3)",margin:0,minBorderMargin:0,labelMargin:20,hoverable:!0,clickable:!0,mouseActiveRadius:6},tooltip:!0,tooltipOpts:{content:"%s: %y",defaultTheme:!1,shifts:{x:0,y:20}}};for(var i=0;x>i;i++)ticks.push([parseInt(firstDate),$filter("date")(firstDate,"dd MMM")]),$scope.dateRange.push($filter("date")(firstDate,"dd MMM yy")),yAxisData.push([parseInt(firstDate),0]),firstDate=parseInt(firstDate)+dayDuration;angular.forEach($scope.analytics.chart,function(chart,chart_key){0===$filter("filter")($scope.dataset,{label:chart.group[1]},!0).length&&$scope.dataset.push({data:angular.copy(yAxisData),label:chart.group[1],id:chart.group[2],points:{show:!0,radius:4},splines:{show:!0,tension:.45,lineWidth:4,fill:.1}});var timestamp=moment.utc([chart.group[0][0],chart.group[0][1]-1,chart.group[0][2]]).format("x"),dataset=$filter("filter")($scope.dataset,{id:chart.group[2]},!0)[0];$filter("filter")(dataset.data,parseInt(timestamp),!0)[0][1]=chart.reduction}),$scope.newVisitorsChart.percent=100-$scope.analytics.visitors.loyalty,$scope.returningVisitorsChart.percent=$scope.analytics.visitors.loyalty,$scope.loyaltyChart.percent=$scope.analytics.visitors.loyalty}function heatMap(){$scope.heatmapPoints=[],angular.forEach($scope.analytics.positions,function(value,key){value&&value.lat&&value.lng&&$scope.heatmapPoints.push([value.lat,value.lng])}),$scope.heatmapPoints.length>0&&($scope.lastPosition=$scope.heatmapPoints.pop(),$scope.center={lat:parseFloat($scope.lastPosition[0]),lng:parseFloat($scope.lastPosition[1]),zoom:18}),leafletData.getMap().then(function(map){$scope.slider={maxValue:$scope.dateRange.length-1,minValue:0,options:{stepsArray:$scope.dateRange,showSelectionBar:!0,showTicks:!0,ticksTooltip:function(v){return $scope.dateRange[v]},onEnd:function(sliderId,modelValue,highValue){$scope.heatmapPoints=[],Analytics.getOverview({date_from:moment($scope.dateRange[modelValue],"DD-MMM-YY").format("YYYY-MM-DD"),date_to:moment($scope.dateRange[highValue],"DD-MMM-YY").add(1,"days").format("YYYY-MM-DD"),place_id:$scope.filters.place},function(list){angular.forEach(list.positions,function(value,key){value&&value.lat&&value.lng&&$scope.heatmapPoints.push([value.lat,value.lng])}),$scope.layers.overlays.heat={name:"Heat Map",type:"heat",data:$scope.heatmapPoints,layerOptions:{radius:25,blur:30},visible:!0,doRefresh:!0}},function(errorResponse){console.log(errorResponse)})}}},angular.forEach($scope.floors,function(value,key){value.floorplan_image_url&&value.anchors&&($scope.layers.overlays[value.name]={name:value.name,type:"imageDistort",url:value.floorplan_image_url,anchors:value.anchors,options:{corners:value.anchors},visible:!0})}),$scope.layers.overlays.heat={name:"Heat Map",type:"heat",data:$scope.heatmapPoints,layerOptions:{radius:25,blur:30},visible:!0,doRefresh:!0}})}$scope.page={title:"Analytics & Reporting",subtitle:"subtitle goes here"},$scope.currentUser.$promise.then(function(){Metrics.add("openedAnalytics",$scope.currentUser.organization_id)}),$scope.myDates={startDate:moment().subtract(29,"days").startOf("day").format(),endDate:moment().add(1,"days").endOf("day").format()},$scope.config1={format:"Do MMM YYYY",shortcuts:[{name:"Today",from:moment().startOf("day"),to:moment().endOf("day")},{name:"Yesterday",from:moment().subtract(1,"days").startOf("day"),to:moment().subtract(1,"days").endOf("day")},{name:"Last 30 Days",from:moment().subtract(29,"days").startOf("day"),to:moment().endOf("day")},{name:"This Week",from:moment().startOf("week"),to:moment().endOf("week")},{name:"Last Week",from:moment().subtract(1,"week").startOf("week"),to:moment().subtract(1,"week").endOf("week")},{name:"This Month",from:moment().startOf("month"),to:moment().endOf("month")},{name:"Last Month",from:moment().subtract(1,"month").startOf("month"),to:moment().subtract(1,"month").endOf("month")}]},$scope.filters={place:null,isOpen:!1},$scope.filtered=!1,$scope.floors=Floor.find(),$scope.analytics=[],getList(),$scope.getTotalLocales=function(){for(var total=0,i=0;i<$scope.analytics.locales.length;i++){var locale=$scope.analytics.locales[i];total+=locale.reduction}return total},$scope.getTotalPlatforms=function(){for(var total=0,i=0;i<$scope.analytics.platforms.length;i++){var platform=$scope.analytics.platforms[i];total+=platform.reduction}return total},$scope.$watch("myDates",function(newVal,oldVal){newVal!==oldVal&&getList()},!0),$scope.placeFilter=function(){$scope.filtered?$scope.filters.place=$scope.dataset[0].id:(getList(),$scope.filtered=!0)},$scope.floorFilter=function(){getList()},$scope.resetFilters=function(){$scope.filters.isOpen=!1,$scope.filters.place=null,$scope.filtered=!1,getList()},$scope.visitsChart={options:{animate:{duration:3e3,enabled:!0},barColor:"#a2d200",scaleColor:!1,lineCap:"round",size:140,lineWidth:4}},$scope.visitorsChart={options:{animate:{duration:3e3,enabled:!0},barColor:"#418bca",scaleColor:!1,lineCap:"round",size:140,lineWidth:4}},$scope.newVisitorsChart={percent:0,options:{animate:{duration:3e3,enabled:!0},barColor:"#e05d6f",scaleColor:!1,lineCap:"round",size:140,lineWidth:4}},$scope.returningVisitorsChart={percent:0,options:{animate:{duration:3e3,enabled:!0},barColor:"#16a085",scaleColor:!1,lineCap:"round",size:140,lineWidth:4}},$scope.loyaltyChart={percent:0,options:{animate:{duration:3e3,enabled:!0},barColor:"#f0ad4e",scaleColor:!1,lineCap:"round",size:140,lineWidth:4}},$scope.center={lat:0,lng:0,zoom:22},angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{subdomains:["a","b","c"],attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}},googleSatellite:{name:"Google Satellite",layerType:"SATELLITE",type:"google"},tangram:{name:"Tangram",type:"tangram",layerOptions:{scene:"scripts/vendor/tangram/scene.yaml",attribution:'<a href="https://mapzen.com/tangram" target="_blank">Tangram</a> | &copy; OSM contributors | <a href="https://mapzen.com/" target="_blank">Mapzen</a>'}}},overlays:{}}}),Analytics.getPaths({},function(list){$scope.paths=list}),$scope.dwellTime=function(dwellTime){return dwellTime?moment.duration(dwellTime,"seconds").humanize():void 0},$scope.getSnippet=function(target){var content;content="curl -X GET \\ \n--header 'Content-Type: application/json' \\ \n--header 'Accept: application/json' \\ \n--header 'Authorization: Bearer "+$scope.currentUser.data.token+"' \\ \n'https://api.proximi.fi/core/"+target+"/?date_from="+$filter("date")($scope.myDates.startDate,"yyyy-MM-dd")+"&date_to="+$filter("date")($scope.myDates.endDate,"yyyy-MM-dd")+"'",alertify.alert("<pre>"+content+"</pre>").set({transition:"zoom"}).set("title","Get CURL snippet!").set("onok",function(closeEvent){console.log("close")})}}]),app.controller("AccountCtrl",["$scope","toastr","User","$uibModal","$log","Plan","AuthService","$resource","Metrics",function($scope,toastr,User,$uibModal,$log,Plan,AuthService,$resource,Metrics){function getList(){Plan.find({},function(list){$scope.plans=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"My Account",subtitle:"subtitle goes here"},$scope.currentUser.$promise.then(function(){Metrics.add("openedProfile",$scope.currentUser.organization_id)}),$scope.countries=$resource("scripts/jsons/countries.json").query(),getList(),$scope.user=$scope.currentUser,$scope.currentPlan=Plan.getCurrent(),$scope.currentPlan.$promise.then(function(res){res.subscriptions||($scope.currentPlan={subscriptions:{data:[{plan:{id:"free"}}]}})}),$scope.backgrounds=["Freelance developer","Developer in a software development company","In-house developer","Researcher","I do marketing","I do sales","Other"],$scope.password={},$scope.saveUser=function(){User.updateUser($scope.user,function(res){toastr.success("Your profile has been updated","Profile updated!")},function(res){toastr.error(res,"Ouch!"),console.log(res)})},$scope.orderModal=function(size){$scope.order={};var modalInstance=$uibModal.open({templateUrl:"orderModal.html",controller:"OrderModalCtrl",size:size,scope:$scope});modalInstance.result.then(function(){},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.passwordModal=function(size){var modalInstance=$uibModal.open({templateUrl:"passwordModal.html",controller:"PasswordModalCtrl",size:size,scope:$scope});modalInstance.result.then(function(){AuthService.changePassword($scope.password.new_pass).$promise.then(function(res){toastr.success("Your password has been changed","Password changed!")},function(res){console.log(res),toastr.error(res.data.message,res.statusText)})},function(){$log.info("Modal dismissed at: "+new Date)})}}]).controller("OrderModalCtrl",["$scope","$uibModalInstance","toastr","Plan","$rootScope",function($scope,$uibModalInstance,toastr,Plan,$rootScope){function stripeResponseHandler(status,response){console.log(response,$scope.order),response.error?($scope.order.postingStripe=!1,$scope.$apply(),toastr.error(response.error.message,"Order Error!")):($uibModalInstance.close(),$scope.currentPlan.registered||$scope.currentPlan.registered===!1?Plan.subscribe({token:response.id,plan_id:$scope.order.plan},function(res){$rootScope.currentPlan=Plan.getCurrent()},function(res){console.log(res)}):Plan.change({subscription_id:$scope.currentPlan.subscriptions.data[0].id,customer_id:$scope.currentPlan.subscriptions.data[0].customer,plan_id:$scope.order.plan},function(res){$rootScope.currentPlan=Plan.getCurrent()},function(res){console.log(res)}),toastr.success("Your order has been placed","Order Success!"))}Stripe.setPublishableKey("pk_live_VK4zobu08wiHPSdoCOHRmCqT"),$scope.order.postingStripe=!1,$scope.ok=function(){$scope.orderForm.$valid?$scope.order.postingStripe||($scope.order.postingStripe=!0,Stripe.card.createToken({number:$scope.order.card_number,exp_month:$scope.order.card_expiration_month,exp_year:$scope.order.card_expiration_year,cvc:$scope.order.card_cvc},stripeResponseHandler)):angular.forEach($scope.orderForm.$error.required,function(field){field.$setDirty(),$scope.order.postingStripe=!1})},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]).controller("PasswordModalCtrl",["$scope","$uibModalInstance",function($scope,$uibModalInstance){$scope.ok=function(){$scope.passwordForm.$valid?$uibModalInstance.close():angular.forEach($scope.passwordForm.$error.required,function(field){field.$setDirty()})},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),app.controller("GettingStartedCtrl",["$scope","toastr","$uibModal","$log","User",function($scope,toastr,$uibModal,$log,User){$scope.starterModal=function(){var modalInstance=$uibModal.open({templateUrl:"views/pages/starter-modal.html",controller:"StarterModalCtrl",scope:$scope});modalInstance.result.then(function(){},function(data){data&&"disableStarter"===data&&($scope.starterWizard={show:!1},$scope.$storage.starterWizard=$scope.starterWizard),$log.info("Modal dismissed at: "+new Date)})},$scope.$storage.starterWizard.show&&User.isAuthenticated()&&$scope.starterModal()}]).controller("StarterModalCtrl",["$scope","$uibModalInstance",function($scope,$uibModalInstance){$scope.ok=function(){$uibModalInstance.close()},$scope.cancel=function(data){$uibModalInstance.dismiss(data)}}]),app.controller("UpdateUserCtrl",["$scope","$state","AuthService","$location","toastr","User",function($scope,$state,AuthService,$location,toastr,User){$scope.personalUse=!1,$scope.user=$scope.currentUser,$scope.currentUser.$promise.then(function(res){res.organization.name?$scope.haveCompanyName=!0:$scope.haveCompanyName=!1}),$scope.backgrounds=["Freelance developer","Developer in a software development company","In-house developer","Researcher","I do marketing","I do sales","Other"],$scope.companyAvailable=!0,$scope.checkCompany=function(){User.checkCompany({name:$scope.user.organization.name},function(res){res.available===!1?$scope.updateForm.company.$setValidity("company",!1):$scope.updateForm.company.$setValidity("company",!0),$scope.companyAvailable=res.available})},$scope.saveUser=function(){$scope.personalUse&&!$scope.haveCompanyName&&($scope.user.organization.name=$scope.user.first_name+" "+$scope.user.last_name),User.updateUser($scope.user,function(res){toastr.success("Your profile has been updated","Profile updated!"),$state.go("app.dashboard",{},{reload:!0})},function(res){toastr.error(res,"Ouch!"),console.log(res)})}}]),app.controller("ActionsCtrl",["$scope","Metrics",function($scope,Metrics){$scope.currentUser.$promise.then(function(){Metrics.add("openedActions",$scope.currentUser.organization_id)})}]),app.factory("MorrisPost",["$firebaseArray","FBURL",function($firebaseArray,FBURL){var ref=new Firebase(FBURL),morrisPosts=$firebaseArray(ref.child("morrisPosts")),MorrisPost={all:morrisPosts,create:function(morrisPost){return morrisPosts.$add(morrisPost)},"delete":function(morrisPost){return morrisPosts.$remove(morrisPost)}};return MorrisPost}]),app.factory("Geocoder",["$localStorage","$q","$timeout","$rootScope",function($localStorage,$q,$timeout,$rootScope){var locations=$localStorage.locations?JSON.parse($localStorage.locations):{},queue=[],QUERY_PAUSE=250,executeNext=function(){var task=queue[0],geocoder=new google.maps.Geocoder;geocoder.geocode({address:task.address},function(result,status){if(status===google.maps.GeocoderStatus.OK){var parsedResult={lat:result[0].geometry.location.lat(),lng:result[0].geometry.location.lng(),formattedAddress:result[0].formatted_address};locations[task.address]=parsedResult,$localStorage.locations=JSON.stringify(locations),queue.shift(),task.d.resolve(parsedResult)}else status===google.maps.GeocoderStatus.ZERO_RESULTS?(queue.shift(),task.d.reject({type:"zero",message:"Zero results for geocoding address "+task.address})):status===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?task.executedAfterPause&&(queue.shift(),task.d.reject({type:"busy",message:"Geocoding server is busy can not process address "+task.address})):status===google.maps.GeocoderStatus.REQUEST_DENIED?(queue.shift(),task.d.reject({type:"denied",message:"Request denied for geocoding address "+task.address})):(queue.shift(),task.d.reject({type:"invalid",message:"Invalid request for geocoding: status="+status+", address="+task.address}));if(queue.length)if(status===google.maps.GeocoderStatus.OVER_QUERY_LIMIT){var nextTask=queue[0];nextTask.executedAfterPause=!0,$timeout(executeNext,QUERY_PAUSE)}else $timeout(executeNext,0);$rootScope.$$phase||$rootScope.$apply()})};return{geocodeAddress:function(address){var d=$q.defer();return _.has(locations,address)?d.resolve(locations[address]):(queue.push({address:address,d:d}),1===queue.length&&executeNext()),d.promise}}}]),app.factory("compressArray",function(){return function(original){for(var compressed=[],copy=original.slice(0),i=0;i<original.length;i++){for(var myCount=0,w=0;w<copy.length;w++)original[i]===copy[w]&&(myCount++,delete copy[w]);if(myCount>0){var a=new Object({});a.label=original[i],a.data=myCount,compressed.push(a)}}return compressed}}),app.filter("unixToTimeString",function(){return function(millseconds){var seconds=Math.floor(millseconds/1e3),days=Math.floor(seconds/86400),hours=Math.floor(seconds%86400/3600),minutes=Math.floor(seconds%86400%3600/60),timeString="";return days>0&&(timeString+=days>1?days+" days ":days+" day "),hours>0&&(timeString+=hours>1?hours+" hours ":hours+" hour "),minutes>=0&&(timeString+=minutes>1?minutes+" minutes ":minutes+" minute "),timeString}}),app.filter("object2Array",function(){return function(input){var i,out=[];for(i in input)out.push(input[i]);return out}}),function(window,angular,undefined){function getHost(url){var m=url.match(/^(?:https?:)?\/\/([^\/]+)/);return m?m[1]:null}var apiBase=window.location.protocol+"//api.proximi.fi",urlBase=apiBase+"/core",authHeader="authorization",urlBaseHost=getHost(urlBase)||location.host,module=angular.module("lbServices",["ngResource"]);module.factory("User",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(apiBase+"/core_auth",{},{prototype$__findById__accessTokens:{params:{fk:"@fk"},url:urlBase+"/Users/:id/accessTokens/:fk",method:"GET"},prototype$__destroyById__accessTokens:{params:{fk:"@fk"},url:urlBase+"/Users/:id/accessTokens/:fk",method:"DELETE"},prototype$__updateById__accessTokens:{params:{fk:"@fk"},url:urlBase+"/Users/:id/accessTokens/:fk",method:"PUT"},prototype$__get__accessTokens:{isArray:!0,url:urlBase+"/Users/:id/accessTokens",method:"GET"},prototype$__create__accessTokens:{url:urlBase+"/Users/:id/accessTokens",method:"POST"},prototype$__delete__accessTokens:{url:urlBase+"/Users/:id/accessTokens",method:"DELETE"},prototype$__count__accessTokens:{url:urlBase+"/Users/:id/accessTokens/count",method:"GET"},create:{url:urlBase+"/Users",method:"POST"},createMany:{isArray:!0,url:urlBase+"/Users",method:"POST"},upsert:{url:urlBase+"/Users",method:"PUT"},exists:{url:urlBase+"/Users/:id/exists",method:"GET"},findById:{url:apiBase+"/core_auth",method:"GET"},find:{isArray:!0,url:apiBase+"/core_auth",method:"GET"},findOne:{url:urlBase+"/Users/findOne",method:"GET"},updateAll:{url:urlBase+"/Users/update",method:"POST"},deleteById:{url:urlBase+"/Users/:id/delete",method:"DELETE"},count:{url:urlBase+"/Users/count",method:"GET"},prototype$updateAttributes:{url:apiBase+"/core_auth",method:"PUT"},createChangeStream:{url:urlBase+"/Users/change-stream",method:"POST"},login:{params:{},interceptor:{response:function(response){console.log("login response",response);var accessToken=response.data.token;return LoopBackAuth.setUser(accessToken,response.data.user),LoopBackAuth.save(),response.resource}},url:apiBase+"/core_auth/login",method:"POST"},register:{params:{},interceptor:{response:function(response){console.log("register response",response);var authorizationToken=response.data.token;return LoopBackAuth.setUser(authorizationToken,response.data.user),LoopBackAuth.save(),response.resource}},url:apiBase+"/core_auth/registration",method:"POST"},checkCompany:{params:{},url:apiBase+"/core_auth/check_company",method:"POST"},updateUser:{params:{},url:apiBase+"/core/auth/update",method:"POST"},logout:{interceptor:{response:function(response){return LoopBackAuth.clearUser(),LoopBackAuth.clearStorage(),response.resource}},url:apiBase+"/core_auth/logout",method:"POST"},confirm:{url:urlBase+"/Users/confirm",method:"GET"},resetPassword:{params:{email:"@email"},url:apiBase+"/core_auth/reset_password",method:"POST"},changePassword:{params:{password:"@password"},url:apiBase+"/core/auth/change_password",method:"POST"},getCurrent:{url:apiBase+"/core/current_user",method:"GET",params:{id:function(){var id=LoopBackAuth.currentUserId;return null==id&&(id="__anonymous__"),id}},interceptor:{response:function(response){return response.resource}},__isGetCurrentUser__:!0}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.getCachedCurrent=function(){var data=LoopBackAuth.currentUserData;return data?new R(data):null},R.isAuthenticated=function(){return null!=this.getCurrentId()},R.getCurrentId=function(){return LoopBackAuth.currentUserId},R.modelName="User",R}]),module.factory("Place",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/places/:id",{id:"@id"},{prototype$__findById__floors:{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"GET"},prototype$__destroyById__floors:{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"DELETE"},prototype$__updateById__floors:{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"PUT"},prototype$__findById__departments:{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"GET"},prototype$__destroyById__departments:{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"DELETE"},prototype$__updateById__departments:{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"PUT"},prototype$__get__organization:{url:urlBase+"/places/:id/organization",method:"GET"},prototype$__get__floors:{isArray:!0,url:urlBase+"/places/:id/floors",method:"GET"},prototype$__create__floors:{url:urlBase+"/places/:id/floors",method:"POST"},prototype$__delete__floors:{url:urlBase+"/places/:id/floors",method:"DELETE"},prototype$__count__floors:{url:urlBase+"/places/:id/floors/count",method:"GET"},prototype$__get__departments:{isArray:!0,url:urlBase+"/places/:id/departments",method:"GET"},prototype$__create__departments:{url:urlBase+"/places/:id/departments",method:"POST"},prototype$__delete__departments:{url:urlBase+"/places/:id/departments",method:"DELETE"},prototype$__count__departments:{url:urlBase+"/places/:id/departments/count",method:"GET"},create:{url:urlBase+"/places",method:"POST"},createMany:{isArray:!0,url:urlBase+"/places",method:"POST"},upsert:{url:urlBase+"/places",method:"PUT"},exists:{url:urlBase+"/places/:id/exists",method:"GET"},findById:{url:urlBase+"/places/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/places",method:"GET"},findOne:{url:urlBase+"/places/findOne",method:"GET"},updateAll:{url:urlBase+"/places/update",method:"POST"},deleteById:{url:urlBase+"/places/:id",method:"DELETE"},count:{url:urlBase+"/places/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/places/:id",method:"PUT"},createChangeStream:{url:urlBase+"/places/change-stream",method:"POST"},prototype$__findById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/places/:id/floors/:nk/departments/:fk",method:"GET"},prototype$__destroyById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/places/:id/floors/:nk/departments/:fk",method:"DELETE"},prototype$__updateById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/places/:id/floors/:nk/departments/:fk",method:"PUT"},prototype$__get__floors__organization:{params:{nk:"@nk"},url:urlBase+"/places/:id/floors/:nk/organization",method:"GET"},prototype$__get__floors__departments:{isArray:!0,params:{nk:"@nk"},url:urlBase+"/places/:id/floors/:nk/departments",method:"GET"},prototype$__create__floors__departments:{params:{nk:"@nk"},url:urlBase+"/places/:id/floors/:nk/departments",method:"POST"},prototype$__delete__floors__departments:{params:{nk:"@nk"},url:urlBase+"/places/:id/floors/:nk/departments",method:"DELETE"},prototype$__count__floors__departments:{url:urlBase+"/places/:id/floors/:nk/departments/count",method:"GET"},"::findById::organization::places":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"GET"},"::destroyById::organization::places":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"DELETE"},"::updateById::organization::places":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"PUT"},"::get::organization::places":{isArray:!0,url:urlBase+"/organizations/:id/places",method:"GET"},"::create::organization::places":{url:urlBase+"/organizations/:id/places",method:"POST"},"::createMany::organization::places":{isArray:!0,url:urlBase+"/organizations/:id/places",method:"POST"},"::delete::organization::places":{url:urlBase+"/organizations/:id/places",method:"DELETE"},"::count::organization::places":{url:urlBase+"/organizations/:id/places/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Place",R.floors=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::get::place::floors"];return action.apply(R,arguments)},R.floors.count=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::count::place::floors"];return action.apply(R,arguments)},R.floors.create=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::create::place::floors"];return action.apply(R,arguments)},R.floors.createMany=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::createMany::place::floors"];return action.apply(R,arguments)},R.floors.destroyAll=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::delete::place::floors"];return action.apply(R,arguments)},R.floors.destroyById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::destroyById::place::floors"];return action.apply(R,arguments)},R.floors.findById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::findById::place::floors"];return action.apply(R,arguments)},R.floors.updateById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::updateById::place::floors"];return action.apply(R,arguments)},R.departments=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::get::place::departments"];return action.apply(R,arguments)},R.departments.count=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::count::place::departments"];return action.apply(R,arguments)},R.departments.create=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::create::place::departments"];return action.apply(R,arguments)},R.departments.createMany=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::createMany::place::departments"];return action.apply(R,arguments)},R.departments.destroyAll=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::delete::place::departments"];return action.apply(R,arguments)},R.departments.destroyById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::destroyById::place::departments"];return action.apply(R,arguments)},R.departments.findById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::findById::place::departments"];return action.apply(R,arguments)},R.departments.updateById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::updateById::place::departments"];return action.apply(R,arguments)},R.organization=function(){var TargetResource=$injector.get("Organization"),action=TargetResource["::get::place::organization"];return action.apply(R,arguments)},R}]),module.factory("Geofence",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/geofences/:id",{id:"@id"},{create:{url:urlBase+"/geofences",method:"POST"},createMany:{isArray:!0,url:urlBase+"/geofences",method:"POST"},upsert:{url:urlBase+"/geofences",method:"PUT"},exists:{url:urlBase+"/geofences/:id/exists",method:"GET"},findById:{url:urlBase+"/geofences/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/geofences",method:"GET"},findOne:{url:urlBase+"/geofences/findOne",method:"GET"},updateAll:{url:urlBase+"/geofences/update",method:"POST"},deleteById:{url:urlBase+"/geofences/:id",method:"DELETE"},count:{url:urlBase+"/geofences/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/geofences/:id",method:"PUT"},createChangeStream:{url:urlBase+"/geofences/change-stream",method:"POST"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Geofence",R}]),module.factory("Floor",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/floors/:id",{id:"@id"},{prototype$__findById__departments:{
params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"GET"},prototype$__destroyById__departments:{params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"DELETE"},prototype$__updateById__departments:{params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"PUT"},prototype$__get__organization:{url:urlBase+"/floors/:id/organization",method:"GET"},prototype$__get__departments:{isArray:!0,url:urlBase+"/floors/:id/departments",method:"GET"},prototype$__create__departments:{url:urlBase+"/floors/:id/departments",method:"POST"},prototype$__delete__departments:{url:urlBase+"/floors/:id/departments",method:"DELETE"},prototype$__count__departments:{url:urlBase+"/floors/:id/departments/count",method:"GET"},create:{url:urlBase+"/floors",method:"POST"},createMany:{isArray:!0,url:urlBase+"/floors",method:"POST"},upsert:{url:urlBase+"/floors",method:"PUT"},exists:{url:urlBase+"/floors/:id/exists",method:"GET"},findById:{url:urlBase+"/floors/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/floors",method:"GET"},findOne:{url:urlBase+"/floors/findOne",method:"GET"},updateAll:{url:urlBase+"/floors/update",method:"POST"},deleteById:{url:urlBase+"/floors/:id",method:"DELETE"},count:{url:urlBase+"/floors/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/floors/:id",method:"PUT"},createChangeStream:{url:urlBase+"/floors/change-stream",method:"POST"},"::findById::place::floors":{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"GET"},"::destroyById::place::floors":{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"DELETE"},"::updateById::place::floors":{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"PUT"},"::get::place::floors":{isArray:!0,url:urlBase+"/places/:id/floors",method:"GET"},"::create::place::floors":{url:urlBase+"/places/:id/floors",method:"POST"},"::createMany::place::floors":{isArray:!0,url:urlBase+"/places/:id/floors",method:"POST"},"::delete::place::floors":{url:urlBase+"/places/:id/floors",method:"DELETE"},"::count::place::floors":{url:urlBase+"/places/:id/floors/count",method:"GET"},"::findById::organization::floors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"GET"},"::destroyById::organization::floors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"DELETE"},"::updateById::organization::floors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"PUT"},"::get::organization::floors":{isArray:!0,url:urlBase+"/organizations/:id/floors",method:"GET"},"::create::organization::floors":{url:urlBase+"/organizations/:id/floors",method:"POST"},"::createMany::organization::floors":{isArray:!0,url:urlBase+"/organizations/:id/floors",method:"POST"},"::delete::organization::floors":{url:urlBase+"/organizations/:id/floors",method:"DELETE"},"::count::organization::floors":{url:urlBase+"/organizations/:id/floors/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Floor",R.departments=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::get::floor::departments"];return action.apply(R,arguments)},R.departments.count=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::count::floor::departments"];return action.apply(R,arguments)},R.departments.create=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::create::floor::departments"];return action.apply(R,arguments)},R.departments.createMany=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::createMany::floor::departments"];return action.apply(R,arguments)},R.departments.destroyAll=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::delete::floor::departments"];return action.apply(R,arguments)},R.departments.destroyById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::destroyById::floor::departments"];return action.apply(R,arguments)},R.departments.findById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::findById::floor::departments"];return action.apply(R,arguments)},R.departments.updateById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::updateById::floor::departments"];return action.apply(R,arguments)},R.organization=function(){var TargetResource=$injector.get("Organization"),action=TargetResource["::get::floor::organization"];return action.apply(R,arguments)},R}]),module.factory("Department",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/departments/:id",{id:"@id"},{create:{url:urlBase+"/departments",method:"POST"},createMany:{isArray:!0,url:urlBase+"/departments",method:"POST"},upsert:{url:urlBase+"/departments",method:"PUT"},exists:{url:urlBase+"/departments/:id/exists",method:"GET"},findById:{url:urlBase+"/departments/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/departments",method:"GET"},findOne:{url:urlBase+"/departments/findOne",method:"GET"},updateAll:{url:urlBase+"/departments/update",method:"POST"},deleteById:{url:urlBase+"/departments/:id",method:"DELETE"},count:{url:urlBase+"/departments/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/departments/:id",method:"PUT"},createChangeStream:{url:urlBase+"/departments/change-stream",method:"POST"},"::findById::place::departments":{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"GET"},"::destroyById::place::departments":{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"DELETE"},"::updateById::place::departments":{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"PUT"},"::get::place::departments":{isArray:!0,url:urlBase+"/places/:id/departments",method:"GET"},"::create::place::departments":{url:urlBase+"/places/:id/departments",method:"POST"},"::createMany::place::departments":{isArray:!0,url:urlBase+"/places/:id/departments",method:"POST"},"::delete::place::departments":{url:urlBase+"/places/:id/departments",method:"DELETE"},"::count::place::departments":{url:urlBase+"/places/:id/departments/count",method:"GET"},"::findById::floor::departments":{params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"GET"},"::destroyById::floor::departments":{params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"DELETE"},"::updateById::floor::departments":{params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"PUT"},"::get::floor::departments":{isArray:!0,url:urlBase+"/floors/:id/departments",method:"GET"},"::create::floor::departments":{url:urlBase+"/floors/:id/departments",method:"POST"},"::createMany::floor::departments":{isArray:!0,url:urlBase+"/floors/:id/departments",method:"POST"},"::delete::floor::departments":{url:urlBase+"/floors/:id/departments",method:"DELETE"},"::count::floor::departments":{url:urlBase+"/floors/:id/departments/count",method:"GET"},"::findById::organization::departments":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"GET"},"::destroyById::organization::departments":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"DELETE"},"::updateById::organization::departments":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"PUT"},"::get::organization::departments":{isArray:!0,url:urlBase+"/organizations/:id/departments",method:"GET"},"::create::organization::departments":{url:urlBase+"/organizations/:id/departments",method:"POST"},"::createMany::organization::departments":{isArray:!0,url:urlBase+"/organizations/:id/departments",method:"POST"},"::delete::organization::departments":{url:urlBase+"/organizations/:id/departments",method:"DELETE"},"::count::organization::departments":{url:urlBase+"/organizations/:id/departments/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Department",R}]),module.factory("Input",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/inputs/:id",{id:"@id"},{create:{url:urlBase+"/inputs",method:"POST"},createMany:{isArray:!0,url:urlBase+"/inputs",method:"POST"},upsert:{url:urlBase+"/inputs",method:"PUT"},exists:{url:urlBase+"/inputs/:id/exists",method:"GET"},findById:{url:urlBase+"/inputs/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/inputs",method:"GET"},findOne:{url:urlBase+"/inputs/findOne",method:"GET"},updateAll:{url:urlBase+"/inputs/update",method:"POST"},deleteById:{url:urlBase+"/inputs/:id",method:"DELETE"},count:{url:urlBase+"/inputs/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/inputs/:id",method:"PUT"},createChangeStream:{url:urlBase+"/inputs/change-stream",method:"POST"},"::findById::organization::inputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"GET"},"::destroyById::organization::inputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"DELETE"},"::updateById::organization::inputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"PUT"},"::get::organization::inputs":{isArray:!0,url:urlBase+"/organizations/:id/inputs",method:"GET"},"::create::organization::inputs":{url:urlBase+"/organizations/:id/inputs",method:"POST"},"::createMany::organization::inputs":{isArray:!0,url:urlBase+"/organizations/:id/inputs",method:"POST"},"::delete::organization::inputs":{url:urlBase+"/organizations/:id/inputs",method:"DELETE"},"::count::organization::inputs":{url:urlBase+"/organizations/:id/inputs/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Input",R}]),module.factory("Output",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/outputs/:id",{id:"@id"},{create:{url:urlBase+"/outputs",method:"POST"},createMany:{isArray:!0,url:urlBase+"/outputs",method:"POST"},upsert:{url:urlBase+"/outputs",method:"PUT"},exists:{url:urlBase+"/outputs/:id/exists",method:"GET"},findById:{url:urlBase+"/outputs/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/outputs",method:"GET"},findOne:{url:urlBase+"/outputs/findOne",method:"GET"},updateAll:{url:urlBase+"/outputs/update",method:"POST"},deleteById:{url:urlBase+"/outputs/:id",method:"DELETE"},count:{url:urlBase+"/outputs/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/outputs/:id",method:"PUT"},createChangeStream:{url:urlBase+"/outputs/change-stream",method:"POST"},"::findById::organization::outputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"GET"},"::destroyById::organization::outputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"DELETE"},"::updateById::organization::outputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"PUT"},"::get::organization::outputs":{isArray:!0,url:urlBase+"/organizations/:id/outputs",method:"GET"},"::create::organization::outputs":{url:urlBase+"/organizations/:id/outputs",method:"POST"},"::createMany::organization::outputs":{isArray:!0,url:urlBase+"/organizations/:id/outputs",method:"POST"},"::delete::organization::outputs":{url:urlBase+"/organizations/:id/outputs",method:"DELETE"},"::count::organization::outputs":{url:urlBase+"/organizations/:id/outputs/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Output",R}]),module.factory("Application",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/applications/:id",{id:"@id"},{create:{url:urlBase+"/applications",method:"POST"},createMany:{isArray:!0,url:urlBase+"/applications",method:"POST"},upsert:{url:urlBase+"/applications",method:"PUT"},exists:{url:urlBase+"/applications/:id/exists",method:"GET"},findById:{url:urlBase+"/applications/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/applications",method:"GET"},findOne:{url:urlBase+"/applications/findOne",method:"GET"},updateAll:{url:urlBase+"/applications/update",method:"POST"},deleteById:{url:urlBase+"/applications/:id",method:"DELETE"},count:{url:urlBase+"/applications/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/applications/:id",method:"PUT"},createChangeStream:{url:urlBase+"/applications/change-stream",method:"POST"},"::findById::organization::applications":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/applications/:fk",method:"GET"},"::destroyById::organization::applications":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/applications/:fk",method:"DELETE"},"::updateById::organization::applications":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/applications/:fk",method:"PUT"},"::get::organization::applications":{isArray:!0,url:urlBase+"/organizations/:id/applications",method:"GET"},"::create::organization::applications":{url:urlBase+"/organizations/:id/applications",method:"POST"},"::createMany::organization::applications":{isArray:!0,url:urlBase+"/organizations/:id/applications",method:"POST"},"::delete::organization::applications":{url:urlBase+"/organizations/:id/applications",method:"DELETE"},"::count::organization::applications":{url:urlBase+"/organizations/:id/applications/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Application",R}]),module.factory("Event",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/events/:id",{id:"@id"},{create:{url:urlBase+"/events",method:"POST"},createMany:{isArray:!0,url:urlBase+"/events",method:"POST"},upsert:{url:urlBase+"/events",method:"PUT"},exists:{url:urlBase+"/events/:id/exists",method:"GET"},findById:{url:urlBase+"/events/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/events",method:"GET"},findOne:{url:urlBase+"/events/findOne",method:"GET"},updateAll:{url:urlBase+"/events/update",method:"POST"},deleteById:{url:urlBase+"/events/:id",method:"DELETE"},count:{url:urlBase+"/events/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/events/:id",method:"PUT"},createChangeStream:{url:urlBase+"/events/change-stream",method:"POST"},"::findById::organization::events":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/events/:fk",method:"GET"},"::destroyById::organization::events":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/events/:fk",method:"DELETE"},"::updateById::organization::events":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/events/:fk",method:"PUT"},"::get::organization::events":{isArray:!0,url:urlBase+"/organizations/:id/events",method:"GET"},"::create::organization::events":{url:urlBase+"/organizations/:id/events",method:"POST"},"::createMany::organization::events":{isArray:!0,url:urlBase+"/organizations/:id/events",method:"POST"},"::delete::organization::events":{url:urlBase+"/organizations/:id/events",method:"DELETE"},"::count::organization::events":{url:urlBase+"/organizations/:id/events/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Event",R}]),module.factory("Visitor",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/visitors/:id",{id:"@id"},{create:{url:urlBase+"/visitors",method:"POST"},createMany:{isArray:!0,url:urlBase+"/visitors",method:"POST"},upsert:{url:urlBase+"/visitors",method:"PUT"},exists:{url:urlBase+"/visitors/:id/exists",method:"GET"},findById:{url:urlBase+"/visitors/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/visitors",method:"GET"},findOne:{url:urlBase+"/visitors/findOne",method:"GET"},updateAll:{url:urlBase+"/visitors/update",method:"POST"},deleteById:{url:urlBase+"/visitors/:id",method:"DELETE"},count:{url:urlBase+"/visitors/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/visitors/:id",method:"PUT"},createChangeStream:{url:urlBase+"/visitors/change-stream",method:"POST"},"::findById::organization::visitors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/visitors/:fk",method:"GET"},"::destroyById::organization::visitors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/visitors/:fk",method:"DELETE"},"::updateById::organization::visitors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/visitors/:fk",method:"PUT"},"::get::organization::visitors":{isArray:!0,url:urlBase+"/organizations/:id/visitors",method:"GET"},"::create::organization::visitors":{url:urlBase+"/organizations/:id/visitors",method:"POST"},"::createMany::organization::visitors":{isArray:!0,url:urlBase+"/organizations/:id/visitors",method:"POST"},"::delete::organization::visitors":{url:urlBase+"/organizations/:id/visitors",method:"DELETE"},"::count::organization::visitors":{url:urlBase+"/organizations/:id/visitors/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Visitor",R}]),module.factory("Analytics",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(apiBase+"/analytics/overview",{id:"@id"},{getOverview:{url:apiBase+"/analytics/overview",method:"GET"},getVisitor:{url:apiBase+"/analytics/visitor/:id",method:"GET"},getPaths:{url:apiBase+"/analytics/pathfinder",method:"GET"},getVisitorPaths:{url:apiBase+"/analytics/visitor/:id/pathfinder",method:"GET"}});return R.modelName="Analytics",R}]),module.factory("Plan",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(apiBase+"/stripe/plans/list",{id:"@id"},{find:{isArray:!0,url:apiBase+"/stripe/plans/list",method:"GET"},subscribe:{url:apiBase+"/stripe/plans/subscribe",method:"POST"},change:{url:apiBase+"/stripe/plans/change",method:"POST"},getCurrent:{url:apiBase+"/stripe/plans/current",method:"GET"}});return R.modelName="Plan",R}]),module.factory("Organization",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/organizations/:id",{id:"@id"},{prototype$__findById__places:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"GET"},prototype$__destroyById__places:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"DELETE"},prototype$__updateById__places:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"PUT"},prototype$__findById__floors:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"GET"},prototype$__destroyById__floors:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"DELETE"},prototype$__updateById__floors:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"PUT"},prototype$__findById__departments:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"GET"},prototype$__destroyById__departments:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"DELETE"},prototype$__updateById__departments:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"PUT"},prototype$__findById__inputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"GET"},prototype$__destroyById__inputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"DELETE"},prototype$__updateById__inputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"PUT"},prototype$__findById__outputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"GET"},prototype$__destroyById__outputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"DELETE"},prototype$__updateById__outputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"PUT"},prototype$__get__places:{isArray:!0,url:urlBase+"/organizations/:id/places",method:"GET"},prototype$__create__places:{url:urlBase+"/organizations/:id/places",method:"POST"},prototype$__delete__places:{url:urlBase+"/organizations/:id/places",method:"DELETE"},prototype$__count__places:{url:urlBase+"/organizations/:id/places/count",method:"GET"},prototype$__get__floors:{isArray:!0,url:urlBase+"/organizations/:id/floors",method:"GET"},prototype$__create__floors:{url:urlBase+"/organizations/:id/floors",method:"POST"},prototype$__delete__floors:{url:urlBase+"/organizations/:id/floors",method:"DELETE"},prototype$__count__floors:{url:urlBase+"/organizations/:id/floors/count",method:"GET"},prototype$__get__departments:{isArray:!0,url:urlBase+"/organizations/:id/departments",method:"GET"},prototype$__create__departments:{url:urlBase+"/organizations/:id/departments",method:"POST"},prototype$__delete__departments:{url:urlBase+"/organizations/:id/departments",method:"DELETE"},prototype$__count__departments:{url:urlBase+"/organizations/:id/departments/count",method:"GET"},prototype$__get__inputs:{isArray:!0,url:urlBase+"/organizations/:id/inputs",method:"GET"},prototype$__create__inputs:{url:urlBase+"/organizations/:id/inputs",method:"POST"},prototype$__delete__inputs:{url:urlBase+"/organizations/:id/inputs",method:"DELETE"},prototype$__count__inputs:{url:urlBase+"/organizations/:id/inputs/count",method:"GET"},prototype$__get__outputs:{isArray:!0,url:urlBase+"/organizations/:id/outputs",method:"GET"},prototype$__create__outputs:{url:urlBase+"/organizations/:id/outputs",method:"POST"},prototype$__delete__outputs:{url:urlBase+"/organizations/:id/outputs",method:"DELETE"},prototype$__count__outputs:{url:urlBase+"/organizations/:id/outputs/count",method:"GET"},create:{url:urlBase+"/organizations",method:"POST"},createMany:{isArray:!0,url:urlBase+"/organizations",method:"POST"},upsert:{url:urlBase+"/organizations",method:"PUT"},exists:{url:urlBase+"/organizations/:id/exists",method:"GET"},findById:{url:urlBase+"/organizations/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/organizations",method:"GET"},findOne:{url:urlBase+"/organizations/findOne",method:"GET"},updateAll:{url:urlBase+"/organizations/update",method:"POST"},deleteById:{url:urlBase+"/organizations/:id",method:"DELETE"},count:{url:urlBase+"/organizations/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/organizations/:id",method:"PUT"},createChangeStream:{url:urlBase+"/organizations/change-stream",method:"POST"},prototype$__findById__places__floors:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/floors/:fk",method:"GET"},prototype$__destroyById__places__floors:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/floors/:fk",method:"DELETE"},prototype$__updateById__places__floors:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/floors/:fk",method:"PUT"},prototype$__findById__places__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/departments/:fk",method:"GET"},prototype$__destroyById__places__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/departments/:fk",method:"DELETE"},prototype$__updateById__places__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/departments/:fk",method:"PUT"},prototype$__get__places__organization:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/organization",method:"GET"},prototype$__get__places__floors:{isArray:!0,params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/floors",method:"GET"},prototype$__create__places__floors:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/floors",method:"POST"},prototype$__delete__places__floors:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/floors",method:"DELETE"},prototype$__count__places__floors:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/floors/count",method:"GET"},prototype$__get__places__departments:{isArray:!0,params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/departments",method:"GET"},prototype$__create__places__departments:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/departments",method:"POST"},prototype$__delete__places__departments:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/departments",method:"DELETE"},prototype$__count__places__departments:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/departments/count",method:"GET"},prototype$__findById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/floors/:nk/departments/:fk",method:"GET"},prototype$__destroyById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/floors/:nk/departments/:fk",method:"DELETE"},prototype$__updateById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/floors/:nk/departments/:fk",method:"PUT"},prototype$__get__floors__organization:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/floors/:nk/organization",method:"GET"},prototype$__get__floors__departments:{isArray:!0,params:{nk:"@nk"},url:urlBase+"/organizations/:id/floors/:nk/departments",method:"GET"},prototype$__create__floors__departments:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/floors/:nk/departments",method:"POST"},prototype$__delete__floors__departments:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/floors/:nk/departments",method:"DELETE"},prototype$__count__floors__departments:{url:urlBase+"/organizations/:id/floors/:nk/departments/count",method:"GET"},"::get::place::organization":{url:urlBase+"/places/:id/organization",method:"GET"},"::get::floor::organization":{url:urlBase+"/floors/:id/organization",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Organization",R.places=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::get::organization::places"];return action.apply(R,arguments)},R.places.count=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::count::organization::places"];return action.apply(R,arguments)},R.places.create=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::create::organization::places"];return action.apply(R,arguments)},R.places.createMany=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::createMany::organization::places"];return action.apply(R,arguments)},R.places.destroyAll=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::delete::organization::places"];return action.apply(R,arguments)},R.places.destroyById=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::destroyById::organization::places"];return action.apply(R,arguments)},R.places.findById=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::findById::organization::places"];return action.apply(R,arguments)},R.places.updateById=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::updateById::organization::places"];return action.apply(R,arguments)},R.floors=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::get::organization::floors"];return action.apply(R,arguments)},R.floors.count=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::count::organization::floors"];return action.apply(R,arguments)},R.floors.create=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::create::organization::floors"];return action.apply(R,arguments)},R.floors.createMany=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::createMany::organization::floors"];return action.apply(R,arguments)},R.floors.destroyAll=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::delete::organization::floors"];return action.apply(R,arguments)},R.floors.destroyById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::destroyById::organization::floors"];return action.apply(R,arguments)},R.floors.findById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::findById::organization::floors"];return action.apply(R,arguments)},R.floors.updateById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::updateById::organization::floors"];return action.apply(R,arguments)},R.departments=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::get::organization::departments"];return action.apply(R,arguments)},R.departments.count=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::count::organization::departments"];return action.apply(R,arguments)},R.departments.create=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::create::organization::departments"];return action.apply(R,arguments)},R.departments.createMany=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::createMany::organization::departments"];return action.apply(R,arguments)},R.departments.destroyAll=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::delete::organization::departments"];return action.apply(R,arguments)},R.departments.destroyById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::destroyById::organization::departments"];return action.apply(R,arguments)},R.departments.findById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::findById::organization::departments"];return action.apply(R,arguments)},R.departments.updateById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::updateById::organization::departments"];return action.apply(R,arguments)},R.inputs=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::get::organization::inputs"];return action.apply(R,arguments)},R.inputs.count=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::count::organization::inputs"];return action.apply(R,arguments)},R.inputs.create=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::create::organization::inputs"];return action.apply(R,arguments)},R.inputs.createMany=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::createMany::organization::inputs"];return action.apply(R,arguments)},R.inputs.destroyAll=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::delete::organization::inputs"];return action.apply(R,arguments)},R.inputs.destroyById=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::destroyById::organization::inputs"];return action.apply(R,arguments)},R.inputs.findById=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::findById::organization::inputs"];return action.apply(R,arguments)},R.inputs.updateById=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::updateById::organization::inputs"];return action.apply(R,arguments)},R.outputs=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::get::organization::outputs"];return action.apply(R,arguments)},R.outputs.count=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::count::organization::outputs"];return action.apply(R,arguments)},R.outputs.create=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::create::organization::outputs"];return action.apply(R,arguments)},R.outputs.createMany=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::createMany::organization::outputs"];return action.apply(R,arguments)},R.outputs.destroyAll=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::delete::organization::outputs"];return action.apply(R,arguments)},R.outputs.destroyById=function(){
var TargetResource=$injector.get("Output"),action=TargetResource["::destroyById::organization::outputs"];return action.apply(R,arguments)},R.outputs.findById=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::findById::organization::outputs"];return action.apply(R,arguments)},R.outputs.updateById=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::updateById::organization::outputs"];return action.apply(R,arguments)},R}]),module.factory("LoopBackAuth",function(){function LoopBackAuth(){var self=this;props.forEach(function(name){self[name]=load(name)}),this.currentUserData=null}function save(storage,name,value){var key=propsPrefix+name;null==value&&(value=""),storage[key]=value}function load(name){var key=propsPrefix+name;return localStorage[key]||sessionStorage[key]||null}var props=["authorizationToken","apiKey","currentUserId","rememberMe"],propsPrefix="$LoopBack$";return LoopBackAuth.prototype.save=function(){var self=this,storage=this.rememberMe?localStorage:sessionStorage;props.forEach(function(name){save(storage,name,self[name])})},LoopBackAuth.prototype.setUser=function(authorizationToken,userData){this.authorizationToken=authorizationToken,this.currentUserId=userData.id,this.currentUserData=userData,this.currentUser=userData},LoopBackAuth.prototype.clearUser=function(){this.authorizationToken=null,this.apiKey=null,this.currentUserId=null,this.currentUserData=null},LoopBackAuth.prototype.clearStorage=function(){props.forEach(function(name){save(sessionStorage,name,null),save(localStorage,name,null)})},new LoopBackAuth}).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("LoopBackAuthRequestInterceptor")}]).factory("LoopBackAuthRequestInterceptor",["$q","LoopBackAuth",function($q,LoopBackAuth){return{request:function(config){var host=getHost(config.url);if(host&&host!==urlBaseHost)return config;if(LoopBackAuth.authorizationToken)config.headers.Authorization="Bearer "+LoopBackAuth.authorizationToken;else if(config.__isGetCurrentUser__){var res={body:{error:{status:401}},status:401,config:config,headers:function(){return undefined}};return $q.reject(res)}return config||$q.when(config)}}}]).provider("LoopBackResource",function(){this.setAuthHeader=function(header){authHeader=header},this.setUrlBase=function(url){urlBase=url,urlBaseHost=getHost(urlBase)||location.host},this.getUrlBase=function(){return urlBase},this.$get=["$resource",function($resource){return function(url,params,actions){var resource=$resource(url,params,actions);return resource.prototype.$save=function(success,error){var result=resource.upsert.call(this,{},this,success,error);return result.$promise||result},resource}}]})}(window,window.angular),app.factory("AuthService",["User","$q","$rootScope","$http",function(User,$q,$rootScope,$http){function login(credentials){return User.login({email:credentials.email,password:credentials.password}).$promise.then(function(res){return res.user.organization=res.organization,$http.post("/instance",res).then(function(res){},function(res){})})}function logout(){return User.logout().$promise.then(function(){$rootScope.currentUser=null})}function register(credentials){return User.register({first_name:credentials.first_name,last_name:credentials.last_name,email:credentials.email,company:credentials.company,country:credentials.country,background:credentials.background,password:credentials.pass,contact_us:credentials.contact_us,improve_product:credentials.improve_product}).$promise.then(function(res){return console.log("register response",res),$http.post("/instance",res).then(function(res){},function(res){})})}function isAuthenticated(){return User.isAuthenticated()}function getCurrentUser(){return User.getCurrent()}function resetPassword(email){return User.resetPassword({email:email})}function changePassword(password){return User.changePassword({password:password})}return{login:login,logout:logout,register:register,isAuthenticated:isAuthenticated,getCurrentUser:getCurrentUser,resetPassword:resetPassword,changePassword:changePassword}}]),app.factory("EventsService",["FBURL","Event",function(FBURL,Event){function create(organization,type,target,operation){return Event.create({data:{type:type,target:target,operation:operation},event:"config-changed",organization_id:organization},function(res){console.log(res)},function(res){console.log(res)})}new Firebase(FBURL);return{create:create}}]),app.filter("showKey",function(){return function(input){var out,i;for(i in input)out=Object.keys(input[i])[0];return out}}),app.filter("parseInt",function(){return function(input){var out;return out=parseInt(input)}}),app.factory("Metrics",["FBURL","$firebaseObject",function(FBURL,$firebaseObject){function add(type,organization){var ref=new Firebase(FBURL).child("organizations").child(organization).child("metrics"),obj=$firebaseObject(ref);obj.$loaded().then(function(){"openedDashboard"===type&&(obj.lastLogin=moment().format("x"),obj.didLogin=!0),obj[type]?obj[type]+=1:obj[type]=1,obj.$save()})}return{add:add}}]),app.directive("navCollapse",function(){return{restrict:"A",link:function($scope,$el){var $dropdowns=$el.find("ul").parent("li"),$a=$dropdowns.children("a"),$notDropdowns=$el.children("li").not($dropdowns),$notDropdownsLinks=$notDropdowns.children("a"),app=angular.element("#proximiioApp"),sidebar=angular.element("#sidebar"),controls=angular.element("#controls");$dropdowns.addClass("dropdown");var $submenus=$dropdowns.find("ul >.dropdown");$submenus.addClass("submenu"),$a.append('<i class="fa fa-plus"></i>'),$a.on("click",function(event){if(app.hasClass("sidebar-sm")||app.hasClass("sidebar-xs")||app.hasClass("hz-menu"))return!1;var $this=angular.element(this),$parent=$this.parent("li"),$openSubmenu=angular.element(".submenu.open");$parent.hasClass("submenu")||$dropdowns.not($parent).removeClass("open").find("ul").slideUp(),$openSubmenu.not($this.parents(".submenu")).removeClass("open").find("ul").slideUp(),$parent.toggleClass("open").find(">ul").stop().slideToggle(),event.preventDefault()}),$dropdowns.on("mouseenter",function(){sidebar.addClass("dropdown-open"),controls.addClass("dropdown-open")}),$dropdowns.on("mouseleave",function(){sidebar.removeClass("dropdown-open"),controls.removeClass("dropdown-open")}),$notDropdownsLinks.on("click",function(){$dropdowns.removeClass("open").find("ul").slideUp()});var $activeDropdown=angular.element(".dropdown>ul>.active").parent();$activeDropdown.css("display","block")}}}),app.directive("ripple",function(){return{restrict:"A",link:function(scope,element){var parent,ink,d,x,y;angular.element(element).find(">li>a").click(function(e){parent=angular.element(this).parent(),0===parent.find(".ink").length&&parent.prepend('<span class="ink"></span>'),ink=parent.find(".ink"),ink.removeClass("animate"),ink.height()||ink.width()||(d=Math.max(parent.outerWidth(),parent.outerHeight()),ink.css({height:d,width:d})),x=e.pageX-parent.offset().left-ink.width()/2,y=e.pageY-parent.offset().top-ink.height()/2,ink.css({top:y+"px",left:x+"px"}).addClass("animate"),setTimeout(function(){angular.element(".ink").remove()},600)})}}}),app.directive("collapseSidebar",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,element){var app=angular.element("#proximiioApp"),$window=angular.element(window),width=$window.width(),removeRipple=function(){angular.element("#sidebar").find(".ink").remove()},collapse=function(){width=$window.width(),992>width?app.addClass("sidebar-xs"):app.removeClass("sidebar-xs")};collapse(),$window.resize(function(){if(width!==$window.width()){var t;clearTimeout(t),t=setTimeout(collapse,300),removeRipple()}}),element.on("click",function(e){app.hasClass("sidebar-xs")?app.removeClass("sidebar-xs"):app.addClass("sidebar-xs"),removeRipple(),e.preventDefault()})}}}]),app.directive("tileControlClose",function(){return{restrict:"A",link:function(scope,element){var tile=element.parents(".tile");element.on("click",function(){tile.addClass("closed").fadeOut()})}}}),app.directive("tileControlFullscreen",function(){return{restrict:"A",link:function(scope,element){var dropdown=element.parents(".dropdown");element.on("click",function(){dropdown.trigger("click")})}}}),app.directive("tileControlRefresh",function(){return{restrict:"A",link:function(scope,element){var tile=element.parents(".tile"),dropdown=element.parents(".dropdown");element.on("click",function(){tile.addClass("refreshing"),dropdown.trigger("click")})}}}),app.directive("tileControlToggle",function(){return{restrict:"A",link:function(scope,element){var tile=element.parents(".tile");element.on("click",function(){tile.toggleClass("collapsed"),tile.children().not(".tile-header").slideToggle(150)})}}}),app.directive("morrisLineChart",function(){return{restrict:"A",scope:{lineData:"=",lineXkey:"@",lineYkeys:"@",lineLabels:"@",lineColors:"@"},link:function(scope,elem,attrs){var colors,morris;colors=void 0===scope.lineColors||""===scope.lineColors?null:JSON.parse(scope.lineColors),scope.$watch("lineData",function(){scope.lineData&&(morris?morris.setData(scope.lineData):morris=new Morris.Line({element:elem,data:scope.lineData,xkey:scope.lineXkey,ykeys:JSON.parse(scope.lineYkeys),labels:JSON.parse(scope.lineLabels),lineColors:colors||["#0b62a4","#7a92a3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],resize:!0}))})}}}).directive("morrisAreaChart",function(){return{restrict:"A",scope:{lineData:"=",lineXkey:"@",lineYkeys:"@",lineLabels:"@",lineColors:"@",lineWidth:"@",fillOpacity:"@",showGrid:"@"},link:function(scope,elem,attrs){var colors,morris;colors=void 0===scope.lineColors||""===scope.lineColors?null:JSON.parse(scope.lineColors),scope.$watch("lineData",function(){scope.lineData&&(morris?morris.setData(scope.lineData):morris=new Morris.Area({element:elem,data:scope.lineData,xkey:scope.lineXkey,ykeys:JSON.parse(scope.lineYkeys),labels:JSON.parse(scope.lineLabels),lineColors:colors||["#0b62a4","#7a92a3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],lineWidth:scope.lineWidth||"0",fillOpacity:scope.fillOpacity||"0.8",grid:scope.showGrid||!1,resize:!0}))})}}}).directive("morrisBarChart",["DonutSegment",function(DonutSegment){return{restrict:"A",scope:{barData:"=",barXkey:"@",barYkeys:"@",barLabels:"@",barColors:"@"},link:function(scope,elem,attrs){var colors,morris;colors=void 0===scope.barColors||""===scope.barColors?null:JSON.parse(scope.barColors),scope.$watch("barData",function(){scope.barData&&(morris?morris.setData(scope.barData):morris=new Morris.Bar({element:elem,data:scope.barData,xkey:scope.barXkey,ykeys:JSON.parse(scope.barYkeys),labels:JSON.parse(scope.barLabels),barColors:colors||["#0b62a4","#7a92a3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],xLabelMargin:2,resize:!0}))})}}}]).directive("morrisDonutChart",function(){return{restrict:"A",scope:{donutData:"=",donutColors:"@"},link:function(scope,elem,attrs){var colors;colors=void 0===scope.donutColors||""===scope.donutColors?null:JSON.parse(scope.donutColors),scope.$watchCollection("donutData",function(){scope.donutData&&(scope.objDonut?scope.objDonut.setData(scope.donutData):scope.objDonut=new Morris.Donut({element:elem,data:scope.donutData,colors:colors||["#0B62A4","#3980B5","#679DC6","#95BBD7","#B0CCE1","#095791","#095085","#083E67","#052C48","#042135"],resize:!0}))})}}}),app.directive("slimscroll",function(){return{restrict:"A",link:function($scope,$el,$attr){var option={},refresh=function(){$attr.slimscroll?option=$scope.$eval($attr.slimscroll):$attr.slimscrollOption&&(option=$scope.$eval($attr.slimscrollOption)),$el.slimscroll({destroy:!0}),$el.slimscroll(option)};refresh();var collapseBtn=angular.element(".sidebar-collapse"),$window=angular.element(window),sidebar=angular.element("#sidebar"),checkScrollbar=function(){refresh(),angular.element("#sidebar .slimScrollBar").is(":visible")?sidebar.removeClass("scroll-inactive"):sidebar.addClass("scroll-inactive")};collapseBtn.on("click",function(){checkScrollbar()}),$window.resize(function(){checkScrollbar()}),$attr.slimscroll&&!option.noWatch&&$scope.$watchCollection($attr.slimscroll,refresh),$attr.slimscrollWatch&&$scope.$watchCollection($attr.slimscrollWatch,refresh),$attr.slimssrollListenTo&&$scope.on($attr.slimscrollListenTo,refresh)}}}),app.directive("postRender",["$timeout",function($timeout){var def={restrict:"A",terminal:!0,transclude:!0,link:function(scope,element,attrs){scope.redraw=function(){jsPlumb.repaintEverything()},$timeout(scope.redraw,0)}};return def}]).directive("plumbItem",["$timeout",function($timeout){return{replace:!0,controller:"PlumbCtrl",link:function(scope,element,attrs){console.log("Add plumbing for the 'item' element"),jsPlumb.draggable(element,{containment:"parent"});var connectorPaintStyle={lineWidth:4,strokeStyle:"#61B7CF",joinstyle:"round",outlineColor:"white",outlineWidth:2},connectorHoverStyle={lineWidth:4,strokeStyle:"#216477",outlineWidth:2,outlineColor:"white"},endpointHoverStyle={fillStyle:"#216477",strokeStyle:"#216477"},sourceEndpoint={endpoint:"Dot",paintStyle:{strokeStyle:"#7AB02C",fillStyle:"transparent",radius:8,lineWidth:2},isSource:!0,connector:["Flowchart",{stub:[40,60],gap:10,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:connectorPaintStyle,hoverPaintStyle:endpointHoverStyle,connectorHoverStyle:connectorHoverStyle,dragOptions:{},overlays:[["Label",{location:[.5,1.5],label:"Drag",cssClass:"endpointSourceLabel"}]]},targetEndpoint={endpoint:"Dot",paintStyle:{strokeStyle:"#7AB02C",fillStyle:"#7AB02C",radius:8,lineWidth:2},hoverPaintStyle:endpointHoverStyle,maxConnections:-1,dropOptions:{hoverClass:"hover",activeClass:"active"},isTarget:!0,overlays:[["Label",{location:[.5,-.5],label:"Drop",cssClass:"endpointTargetLabel"}]]};scope.redraw=function(){element.hasClass("output")?(jsPlumb.addEndpoint(element,{anchor:"Right",uuid:null},sourceEndpoint),jsPlumb.addEndpoint(element,{anchor:"Left",uuid:null},targetEndpoint)):element.hasClass("endpoint")?jsPlumb.addEndpoint(element,{anchor:"Left",uuid:null},targetEndpoint):jsPlumb.addEndpoint(element,{anchor:"Right",uuid:null},sourceEndpoint),jsPlumb.repaintEverything()},$timeout(scope.redraw,0),element.bind("dblclick",function(e){jsPlumb.detachAllConnections($(this)),$(this).remove(),e.stopPropagation(),scope.$parent.removeState(attrs.identifier),scope.$parent.$digest()})}}}]).directive("plumbMenuItem",function(){return{replace:!0,controller:"PlumbCtrl",link:function(scope,element,attrs){console.log("Add plumbing for the 'menu-item' element"),jsPlumb.draggable(element,{containment:element.parent().parent()})}}}).directive("plumbDrag",function(){return{replace:!0,link:function(scope,element,attrs){console.log("Add plumbing for the 'connect' element");var common={anchor:["bottom",{shape:"triangle"}],connector:"Straight",endpoint:["Dot",{radius:8}],paintStyle:{fillStyle:"#a2d200"},hoverPaintStyle:{fillStyle:"#86ae00"},connectorStyle:{strokeStyle:"#a2d200",lineWidth:2},connectorHoverStyle:{lineWidth:2}};jsPlumb.makeSource(element,{parent:$(element).parent()},common)}}}).directive("plumbDrop",function(){return{replace:!0,link:function(scope,element,attrs){console.log("Add plumbing for the 'connect' element");var common={connector:"Straight",endpoint:"Dot",paintStyle:{fillStyle:"white",outlineColor:"blue",outlineWidth:1},hoverPaintStyle:{fillStyle:"lightblue"},connectorStyle:{strokeStyle:"blue",lineWidth:1},connectorHoverStyle:{lineWidth:2}};jsPlumb.makeTarget(element,{parent:$(element).parent()},common)}}}).directive("droppable",["$compile",function($compile){return{restrict:"A",link:function(scope,element,attrs){console.log("Make this element droppable"),element.droppable({drop:function(event,ui){var dragIndex=angular.element(ui.draggable).data("identifier"),dragEl=angular.element(ui.draggable),dropEl=angular.element(this);if(dragEl.hasClass("menu-item")&&dropEl.hasClass("drop-container")){console.log("Drag event on "+dragIndex);var x=event.pageX-scope.module_css.width/2,y=event.pageY-scope.module_css.height/2;scope.addModuleToSchema(dragIndex,x,y)}scope.$apply()}})}}}]).directive("draggable",function(){return{restrict:"A",link:function(scope,element,attrs){console.log("Let draggable item snap back to previous position"),element.draggable({revert:!0})}}}),app.directive("countTo",["$timeout",function($timeout){return{replace:!1,scope:!0,link:function(scope,element,attrs){var num,refreshInterval,duration,steps,step,countTo,increment,precision,format,e=element[0],calculate=function(){refreshInterval=30,step=0,scope.timoutId=null,precision=parseInt(attrs.precision)||0,countTo=parseFloat(attrs.countTo)||0,scope.value=parseFloat(attrs.value,10)||0,duration=1e3*parseFloat(attrs.duration)||0,steps=duration/refreshInterval,increment=(countTo-scope.value)/steps,num=scope.value,format="comma"===attrs.format?function(number){return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}:function(number){return number}},tick=function(){scope.timoutId=$timeout(function(){num+=increment,step++,step>=steps?($timeout.cancel(scope.timoutId),num=countTo,e.textContent=format(countTo.toFixed(precision))):(e.textContent=format(num.toFixed(precision)),tick())},refreshInterval)},start=function(){scope.timoutId&&$timeout.cancel(scope.timoutId),calculate(),tick()};return attrs.$observe("countTo",function(val){val&&start()}),attrs.$observe("value",function(val){start()}),!0}}}]),app.directive("stripeCheckout",[function(){return{replace:!1,scope:!0,link:function(scope,element,attrs){}}}]),app.directive("daterangepicker",["$compile","$parse",function($compile,$parse){return{restrict:"AC",require:"?ngModel",link:function($scope,$element,$attributes,ngModel){var format,formatted,options;return format=function(date){return date.format(options.format)},formatted=function(dates){return[format(dates.startDate),format(dates.endDate)].join(options.separator)},options={},options.format=$attributes.format||"MMM D, YYYY",options.separator=$attributes.separator||" - ",options.opens=$attributes.opens||"left",options.minDate=$attributes.minDate&&moment($attributes.minDate),options.maxDate=$attributes.maxDate&&moment($attributes.maxDate),options.dateLimit=$attributes.limit&&moment.duration.apply(this,$attributes.limit.split(" ").map(function(elem,index){return 0===index&&parseInt(elem,10)||elem})),options.ranges=$attributes.ranges&&$parse($attributes.ranges)($scope),ngModel.$formatters.unshift(function(modelValue){return modelValue?modelValue:""}),ngModel.$parsers.unshift(function(viewValue){return viewValue}),ngModel.$render=function(){return ngModel.$viewValue&&ngModel.$viewValue.startDate?$element.find("span").html(formatted(ngModel.$viewValue)):void 0},$scope.$watch($attributes.ngModel,function(modelValue){$element.data("daterangepicker").startDate=modelValue.startDate,$element.data("daterangepicker").endDate=modelValue.endDate,$element.data("daterangepicker").minDate=modelValue.minDate,$element.data("daterangepicker").maxDate=modelValue.maxDate,$element.data("daterangepicker").updateView(),$element.data("daterangepicker").updateCalendars(),angular.element($element).each(function(){var value=angular.element(this).val(),size=value.length;size=2*size,angular.element(this).css("width",3*size+60)})}),$element.daterangepicker(options,function(start,end){return $scope.$apply(function(){return ngModel.$setViewValue({startDate:start,endDate:end}),ngModel.$render()})})}}}]),app.directive("popoverHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"popover-html-unsafe-popup.html"}}).directive("popoverHtmlUnsafe",["$tooltip",function($tooltip){return $tooltip("popoverHtmlUnsafe","popover","click")}]),app.directive("capitalize",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){var capitalize=function(inputValue){void 0===inputValue&&(inputValue="");var capitalized=inputValue.toUpperCase();return capitalized!==inputValue&&(modelCtrl.$setViewValue(capitalized),modelCtrl.$render()),capitalized};modelCtrl.$parsers.push(capitalize),capitalize(scope[attrs.ngModel])}}}),function(angular){angular.module("leaflet-directive",["nemLogging"]).directive("leaflet",["$q","leafletData","leafletMapDefaults","leafletHelpers","leafletEvents",function($q,leafletData,leafletMapDefaults,leafletHelpers,leafletEvents){return{restrict:"EA",replace:!0,scope:{center:"=",lfCenter:"=",defaults:"=",maxbounds:"=",bounds:"=",anchors:"=",markers:"=",legend:"=",geojson:"=",paths:"=",tiles:"=",layers:"=",controls:"=",decorations:"=",eventBroadcast:"=",markersWatchOptions:"=",geojsonWatchOptions:"="},transclude:!0,template:'<div class="angular-leaflet-map"><div ng-transclude></div></div>',controller:["$scope",function($scope){this._leafletMap=$q.defer(),this.getMap=function(){return this._leafletMap.promise},this.getLeafletScope=function(){return $scope}}],link:function(scope,element,attrs,ctrl){function updateWidth(){isNaN(attrs.width)?element.css("width",attrs.width):element.css("width",attrs.width+"px")}function updateHeight(){isNaN(attrs.height)?element.css("height",attrs.height):element.css("height",attrs.height+"px")}var isDefined=leafletHelpers.isDefined,defaults=leafletMapDefaults.setDefaults(scope.defaults,attrs.id),mapEvents=leafletEvents.getAvailableMapEvents(),addEvents=leafletEvents.addEvents;scope.mapId=attrs.id,leafletData.setDirectiveControls({},attrs.id),isDefined(attrs.width)&&(updateWidth(),scope.$watch(function(){return element[0].getAttribute("width")},function(){updateWidth(),map.invalidateSize()})),isDefined(attrs.height)&&(updateHeight(),scope.$watch(function(){return element[0].getAttribute("height")},function(){updateHeight(),map.invalidateSize()}));var map=new L.Map(element[0],leafletMapDefaults.getMapCreationDefaults(attrs.id));if(ctrl._leafletMap.resolve(map),isDefined(attrs.center)||isDefined(attrs.lfCenter)||map.setView([defaults.center.lat,defaults.center.lng],defaults.center.zoom),!isDefined(attrs.tiles)&&!isDefined(attrs.layers)){var tileLayerObj=L.tileLayer(defaults.tileLayer,defaults.tileLayerOptions);tileLayerObj.addTo(map),leafletData.setTiles(tileLayerObj,attrs.id)}if(isDefined(map.zoomControl)&&isDefined(defaults.zoomControlPosition)&&map.zoomControl.setPosition(defaults.zoomControlPosition),isDefined(map.zoomControl)&&defaults.zoomControl===!1&&map.zoomControl.removeFrom(map),isDefined(map.zoomsliderControl)&&isDefined(defaults.zoomsliderControl)&&defaults.zoomsliderControl===!1&&map.zoomsliderControl.removeFrom(map),!isDefined(attrs.eventBroadcast)){var logic="broadcast";addEvents(map,mapEvents,"eventName",scope,logic)}map.whenReady(function(){leafletData.setMap(map,attrs.id)}),scope.$on("$destroy",function(){leafletMapDefaults.reset(),map.remove(),leafletData.unresolveMap(attrs.id)}),scope.$on("invalidateSize",function(){map.invalidateSize()})}}}]),angular.module("leaflet-directive").factory("leafletBoundsHelpers",["leafletLogger","leafletHelpers",function(leafletLogger,leafletHelpers){function _isValidBounds(bounds){return angular.isDefined(bounds)&&angular.isDefined(bounds.southWest)&&angular.isDefined(bounds.northEast)&&angular.isNumber(bounds.southWest.lat)&&angular.isNumber(bounds.southWest.lng)&&angular.isNumber(bounds.northEast.lat)&&angular.isNumber(bounds.northEast.lng)}var isArray=leafletHelpers.isArray,isNumber=leafletHelpers.isNumber,isFunction=leafletHelpers.isFunction,isDefined=leafletHelpers.isDefined,$log=leafletLogger;return{createLeafletBounds:function(bounds){return _isValidBounds(bounds)?L.latLngBounds([bounds.southWest.lat,bounds.southWest.lng],[bounds.northEast.lat,bounds.northEast.lng]):void 0},isValidBounds:_isValidBounds,createBoundsFromArray:function(boundsArray){return isArray(boundsArray)&&2===boundsArray.length&&isArray(boundsArray[0])&&isArray(boundsArray[1])&&2===boundsArray[0].length&&2===boundsArray[1].length&&isNumber(boundsArray[0][0])&&isNumber(boundsArray[0][1])&&isNumber(boundsArray[1][0])&&isNumber(boundsArray[1][1])?{northEast:{lat:boundsArray[0][0],lng:boundsArray[0][1]},southWest:{lat:boundsArray[1][0],lng:boundsArray[1][1]}}:void $log.error("[AngularJS - Leaflet] The bounds array is not valid.")},createBoundsFromLeaflet:function(lfBounds){if(!(isDefined(lfBounds)&&isFunction(lfBounds.getNorthEast)&&isFunction(lfBounds.getSouthWest)))return void $log.error("[AngularJS - Leaflet] The leaflet bounds is not valid object.");var northEast=lfBounds.getNorthEast(),southWest=lfBounds.getSouthWest();return{northEast:{lat:northEast.lat,lng:northEast.lng},southWest:{lat:southWest.lat,lng:southWest.lng}}}}}]),angular.module("leaflet-directive").factory("leafletControlHelpers",["$rootScope","leafletLogger","leafletHelpers","leafletLayerHelpers","leafletMapDefaults",function($rootScope,leafletLogger,leafletHelpers,leafletLayerHelpers,leafletMapDefaults){var isDefined=leafletHelpers.isDefined,isObject=leafletHelpers.isObject,createLayer=leafletLayerHelpers.createLayer,_controls={},errorHeader=leafletHelpers.errorHeader+" [Controls] ",$log=leafletLogger,_controlLayersMustBeVisible=function(baselayers,overlays,mapId){var defaults=leafletMapDefaults.getDefaults(mapId);if(!defaults.controls.layers.visible)return!1;var atLeastOneControlItemMustBeShown=!1;return isObject(baselayers)&&Object.keys(baselayers).forEach(function(key){var layer=baselayers[key];isDefined(layer.layerOptions)&&layer.layerOptions.showOnSelector===!1||(atLeastOneControlItemMustBeShown=!0)}),isObject(overlays)&&Object.keys(overlays).forEach(function(key){var layer=overlays[key];isDefined(layer.layerParams)&&layer.layerParams.showOnSelector===!1||(atLeastOneControlItemMustBeShown=!0)}),atLeastOneControlItemMustBeShown},_createLayersControl=function(mapId){var defaults=leafletMapDefaults.getDefaults(mapId),controlOptions={collapsed:defaults.controls.layers.collapsed,position:defaults.controls.layers.position,autoZIndex:!1};angular.extend(controlOptions,defaults.controls.layers.options);var control;return control=defaults.controls.layers&&isDefined(defaults.controls.layers.control)?defaults.controls.layers.control.apply(this,[[],[],controlOptions]):new L.control.layers([],[],controlOptions)},controlTypes={draw:{isPluginLoaded:function(){return angular.isDefined(L.Control.Draw)?!0:($log.error(errorHeader+" Draw plugin is not loaded."),!1)},checkValidParams:function(){return!0},createControl:function(params){return new L.Control.Draw(params)}},scale:{isPluginLoaded:function(){return!0},checkValidParams:function(){return!0},createControl:function(params){return new L.control.scale(params)}},fullscreen:{isPluginLoaded:function(){return angular.isDefined(L.Control.Fullscreen)?!0:($log.error(errorHeader+" Fullscreen plugin is not loaded."),!1)},checkValidParams:function(){return!0},createControl:function(params){return new L.Control.Fullscreen(params)}},search:{isPluginLoaded:function(){return angular.isDefined(L.Control.Search)?!0:($log.error(errorHeader+" Search plugin is not loaded."),!1)},checkValidParams:function(){return!0},createControl:function(params){return new L.Control.Search(params)}},custom:{},minimap:{isPluginLoaded:function(){return angular.isDefined(L.Control.MiniMap)?!0:($log.error(errorHeader+" Minimap plugin is not loaded."),!1)},checkValidParams:function(params){return isDefined(params.layer)?!0:($log.warn(errorHeader+' minimap "layer" option should be defined.'),!1)},createControl:function(params){var layer=createLayer(params.layer);return isDefined(layer)?new L.Control.MiniMap(layer,params):void $log.warn(errorHeader+' minimap control "layer" could not be created.')}}};return{layersControlMustBeVisible:_controlLayersMustBeVisible,isValidControlType:function(type){return-1!==Object.keys(controlTypes).indexOf(type)},createControl:function(type,params){return controlTypes[type].checkValidParams(params)?controlTypes[type].createControl(params):void 0},updateLayersControl:function(map,mapId,loaded,baselayers,overlays,leafletLayers){var i,_layersControl=_controls[mapId],mustBeLoaded=_controlLayersMustBeVisible(baselayers,overlays,mapId);if(isDefined(_layersControl)&&loaded){for(i in leafletLayers.baselayers)_layersControl.removeLayer(leafletLayers.baselayers[i]);for(i in leafletLayers.overlays)_layersControl.removeLayer(leafletLayers.overlays[i]);map.removeControl(_layersControl),delete _controls[mapId]}if(mustBeLoaded){_layersControl=_createLayersControl(mapId),_controls[mapId]=_layersControl;for(i in baselayers){var hideOnSelector=isDefined(baselayers[i].layerOptions)&&baselayers[i].layerOptions.showOnSelector===!1;!hideOnSelector&&isDefined(leafletLayers.baselayers[i])&&_layersControl.addBaseLayer(leafletLayers.baselayers[i],baselayers[i].name)}for(i in overlays){var hideOverlayOnSelector=isDefined(overlays[i].layerParams)&&overlays[i].layerParams.showOnSelector===!1;!hideOverlayOnSelector&&isDefined(leafletLayers.overlays[i])&&_layersControl.addOverlay(leafletLayers.overlays[i],overlays[i].name)}map.addControl(_layersControl)}return mustBeLoaded}}}]),angular.module("leaflet-directive").service("leafletData",["leafletLogger","$q","leafletHelpers",function(leafletLogger,$q,leafletHelpers){var getDefer=leafletHelpers.getDefer,getUnresolvedDefer=leafletHelpers.getUnresolvedDefer,setResolvedDefer=leafletHelpers.setResolvedDefer,_private={},self=this,upperFirst=function(string){return string.charAt(0).toUpperCase()+string.slice(1)},_privateItems=["map","tiles","layers","paths","markers","geoJSON","UTFGrid","decorations","directiveControls"];_privateItems.forEach(function(itemName){_private[itemName]={}}),this.unresolveMap=function(scopeId){var id=leafletHelpers.obtainEffectiveMapId(_private.map,scopeId);_privateItems.forEach(function(itemName){_private[itemName][id]=void 0})},_privateItems.forEach(function(itemName){var name=upperFirst(itemName);self["set"+name]=function(lObject,scopeId){var defer=getUnresolvedDefer(_private[itemName],scopeId);defer.resolve(lObject),setResolvedDefer(_private[itemName],scopeId)},self["get"+name]=function(scopeId){var defer=getDefer(_private[itemName],scopeId);return defer.promise}})}]),angular.module("leaflet-directive").service("leafletDirectiveControlsHelpers",["leafletLogger","leafletData","leafletHelpers",function(leafletLogger,leafletData,leafletHelpers){var _isDefined=leafletHelpers.isDefined,_isString=leafletHelpers.isString,_isObject=leafletHelpers.isObject,_mainErrorHeader=leafletHelpers.errorHeader,$log=leafletLogger,_errorHeader=_mainErrorHeader+"[leafletDirectiveControlsHelpers",_extend=function(id,thingToAddName,createFn,cleanFn){var _fnHeader=_errorHeader+".extend] ",extender={};if(!_isDefined(thingToAddName))return void $log.error(_fnHeader+"thingToAddName cannot be undefined");if(_isString(thingToAddName)&&_isDefined(createFn)&&_isDefined(cleanFn))extender[thingToAddName]={create:createFn,clean:cleanFn};else{if(!_isObject(thingToAddName)||_isDefined(createFn)||_isDefined(cleanFn))return void $log.error(_fnHeader+"incorrect arguments");extender=thingToAddName}leafletData.getDirectiveControls().then(function(controls){angular.extend(controls,extender),leafletData.setDirectiveControls(controls,id)})};return{extend:_extend}}]),angular.module("leaflet-directive").factory("leafletEvents",["leafletMapEvents","leafletMarkerEvents","leafletPathEvents","leafletIterators",function(leafletMapEvents,leafletMarkerEvents,leafletPathEvents,leafletIterators){var instance=angular.extend({},leafletMapEvents,{bindMarkerEvents:leafletMarkerEvents.bindEvents,getAvailableMarkerEvents:leafletMarkerEvents.getAvailableEvents},leafletPathEvents),genDispatchMapEvent=instance.genDispatchMapEvent;return instance.addEvents=function(map,mapEvents,contextName,scope,logic){leafletIterators.each(mapEvents,function(eventName){var context={};context[contextName]=eventName,map.on(eventName,genDispatchMapEvent(scope,eventName,logic),context)})},instance}]),angular.module("leaflet-directive").service("leafletGeoJsonHelpers",["leafletHelpers","leafletIterators",function(leafletHelpers,leafletIterators){var lHlp=leafletHelpers,lIt=leafletIterators,Point=function(lat,lng){
return this.lat=lat,this.lng=lng,this},_getLat=function(value){return Array.isArray(value)&&2===value.length?value[1]:lHlp.isDefined(value.type)&&"Point"===value.type?+value.coordinates[1]:+value.lat},_getLng=function(value){return Array.isArray(value)&&2===value.length?value[0]:lHlp.isDefined(value.type)&&"Point"===value.type?+value.coordinates[0]:+value.lng},_validateCoords=function(coords){if(lHlp.isUndefined(coords))return!1;if(lHlp.isArray(coords)){if(2===coords.length&&lHlp.isNumber(coords[0])&&lHlp.isNumber(coords[1]))return!0}else if(lHlp.isDefined(coords.type)&&"Point"===coords.type&&lHlp.isArray(coords.coordinates)&&2===coords.coordinates.length&&lHlp.isNumber(coords.coordinates[0])&&lHlp.isNumber(coords.coordinates[1]))return!0;var ret=lIt.all(["lat","lng"],function(pos){return lHlp.isDefined(coords[pos])&&lHlp.isNumber(coords[pos])});return ret},_getCoords=function(value){if(value&&_validateCoords(value)){var p=null;if(Array.isArray(value)&&2===value.length)p=new Point(value[1],value[0]);else{if(!lHlp.isDefined(value.type)||"Point"!==value.type)return value;p=new Point(value.coordinates[1],value.coordinates[0])}return angular.extend(value,p)}};return{getLat:_getLat,getLng:_getLng,validateCoords:_validateCoords,getCoords:_getCoords}}]),angular.module("leaflet-directive").service("leafletHelpers",["$q","$log",function($q,$log){function _obtainEffectiveMapId(d,mapId){var id,i;if(angular.isDefined(mapId))id=mapId;else if(0===Object.keys(d).length)id="main";else if(Object.keys(d).length>=1)for(i in d)d.hasOwnProperty(i)&&(id=i);else $log.error(_errorHeader+"- You have more than 1 map on the DOM, you must provide the map ID to the leafletData.getXXX call");return id}function _getUnresolvedDefer(d,mapId){var defer,id=_obtainEffectiveMapId(d,mapId);return angular.isDefined(d[id])&&d[id].resolvedDefer!==!0?defer=d[id].defer:(defer=$q.defer(),d[id]={defer:defer,resolvedDefer:!1}),defer}var _errorHeader="[AngularJS - Leaflet] ",_copy=angular.copy,_clone=_copy,_getObjectValue=function(object,pathStr){var obj;if(object&&angular.isObject(object))return null!==pathStr&&angular.isString(pathStr)?(obj=object,pathStr.split(".").forEach(function(value){obj&&(obj=obj[value])}),obj):pathStr},_getObjectArrayPath=function(pathStr){return pathStr.split(".").reduce(function(previous,current){return previous+'["'+current+'"]'})},_getObjectDotPath=function(arrayOfStrings){return arrayOfStrings.reduce(function(previous,current){return previous+"."+current})},_isDefined=function(value){return angular.isDefined(value)&&null!==value},_isUndefined=function(value){return!_isDefined(value)},SPECIAL_CHARS_REGEXP=/([\:\-\_]+(.))/g,MOZ_HACK_REGEXP=/^moz([A-Z])/,PREFIX_REGEXP=/^((?:x|data)[\:\-_])/i,camelCase=function(name){return name.replace(SPECIAL_CHARS_REGEXP,function(_,separator,letter,offset){return offset?letter.toUpperCase():letter}).replace(MOZ_HACK_REGEXP,"Moz$1")},directiveNormalize=function(name){return camelCase(name.replace(PREFIX_REGEXP,""))};return{camelCase:camelCase,directiveNormalize:directiveNormalize,copy:_copy,clone:_clone,errorHeader:_errorHeader,getObjectValue:_getObjectValue,getObjectArrayPath:_getObjectArrayPath,getObjectDotPath:_getObjectDotPath,defaultTo:function(val,_default){return _isDefined(val)?val:_default},isTruthy:function(val){return"true"===val||val===!0},isEmpty:function(value){return 0===Object.keys(value).length},isUndefinedOrEmpty:function(value){return angular.isUndefined(value)||null===value||0===Object.keys(value).length},isDefined:_isDefined,isUndefined:_isUndefined,isNumber:angular.isNumber,isString:angular.isString,isArray:angular.isArray,isObject:angular.isObject,isFunction:angular.isFunction,equals:angular.equals,isValidCenter:function(center){return angular.isDefined(center)&&angular.isNumber(center.lat)&&angular.isNumber(center.lng)&&angular.isNumber(center.zoom)},isValidPoint:function(point){return angular.isDefined(point)?angular.isArray(point)?2===point.length&&angular.isNumber(point[0])&&angular.isNumber(point[1]):angular.isNumber(point.lat)&&angular.isNumber(point.lng):!1},isSameCenterOnMap:function(centerModel,map){var mapCenter=map.getCenter(),zoom=map.getZoom();return centerModel.lat&&centerModel.lng&&mapCenter.lat.toFixed(4)===centerModel.lat.toFixed(4)&&mapCenter.lng.toFixed(4)===centerModel.lng.toFixed(4)&&zoom===centerModel.zoom?!0:!1},safeApply:function($scope,fn){var phase=$scope.$root.$$phase;"$apply"===phase||"$digest"===phase?$scope.$eval(fn):$scope.$evalAsync(fn)},obtainEffectiveMapId:_obtainEffectiveMapId,getDefer:function(d,mapId){var defer,id=_obtainEffectiveMapId(d,mapId);return defer=angular.isDefined(d[id])&&d[id].resolvedDefer!==!1?d[id].defer:_getUnresolvedDefer(d,mapId)},getUnresolvedDefer:_getUnresolvedDefer,setResolvedDefer:function(d,mapId){var id=_obtainEffectiveMapId(d,mapId);d[id].resolvedDefer=!0},rangeIsSupported:function(){var testrange=document.createElement("input");return testrange.setAttribute("type","range"),"range"===testrange.type},FullScreenControlPlugin:{isLoaded:function(){return angular.isDefined(L.Control.Fullscreen)}},MiniMapControlPlugin:{isLoaded:function(){return angular.isDefined(L.Control.MiniMap)}},AwesomeMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.AwesomeMarkers)&&angular.isDefined(L.AwesomeMarkers.Icon)},is:function(icon){return this.isLoaded()?icon instanceof L.AwesomeMarkers.Icon:!1},equal:function(iconA,iconB){return this.isLoaded()&&this.is(iconA)?angular.equals(iconA,iconB):!1}},DomMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.DomMarkers)&&angular.isDefined(L.DomMarkers.Icon)?!0:!1},is:function(icon){return this.isLoaded()?icon instanceof L.DomMarkers.Icon:!1},equal:function(iconA,iconB){return this.isLoaded()&&this.is(iconA)?angular.equals(iconA,iconB):!1}},PolylineDecoratorPlugin:{isLoaded:function(){return angular.isDefined(L.PolylineDecorator)?!0:!1},is:function(decoration){return this.isLoaded()?decoration instanceof L.PolylineDecorator:!1},equal:function(decorationA,decorationB){return this.isLoaded()&&this.is(decorationA)?angular.equals(decorationA,decorationB):!1}},MakiMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.MakiMarkers)&&angular.isDefined(L.MakiMarkers.Icon)?!0:!1},is:function(icon){return this.isLoaded()?icon instanceof L.MakiMarkers.Icon:!1},equal:function(iconA,iconB){return this.isLoaded()&&this.is(iconA)?angular.equals(iconA,iconB):!1}},ExtraMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.ExtraMarkers)&&angular.isDefined(L.ExtraMarkers.Icon)?!0:!1},is:function(icon){return this.isLoaded()?icon instanceof L.ExtraMarkers.Icon:!1},equal:function(iconA,iconB){return this.isLoaded()&&this.is(iconA)?angular.equals(iconA,iconB):!1}},LabelPlugin:{isLoaded:function(){return angular.isDefined(L.Label)},is:function(layer){return this.isLoaded()?layer instanceof L.MarkerClusterGroup:!1}},MarkerClusterPlugin:{isLoaded:function(){return angular.isDefined(L.MarkerClusterGroup)},is:function(layer){return this.isLoaded()?layer instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Google)},is:function(layer){return this.isLoaded()?layer instanceof L.Google:!1}},ChinaLayerPlugin:{isLoaded:function(){return angular.isDefined(L.tileLayer.chinaProvider)}},HeatLayerPlugin:{isLoaded:function(){return angular.isDefined(L.heatLayer)}},WebGLHeatMapLayerPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.WebGLHeatMap)}},BingLayerPlugin:{isLoaded:function(){return angular.isDefined(L.BingLayer)},is:function(layer){return this.isLoaded()?layer instanceof L.BingLayer:!1}},WFSLayerPlugin:{isLoaded:function(){return void 0!==L.GeoJSON.WFS},is:function(layer){return this.isLoaded()?layer instanceof L.GeoJSON.WFS:!1}},AGSBaseLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.basemapLayer},is:function(layer){return this.isLoaded()?layer instanceof L.esri.basemapLayer:!1}},AGSLayerPlugin:{isLoaded:function(){return void 0!==lvector&&void 0!==lvector.AGS},is:function(layer){return this.isLoaded()?layer instanceof lvector.AGS:!1}},AGSFeatureLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.featureLayer},is:function(layer){return this.isLoaded()?layer instanceof L.esri.featureLayer:!1}},AGSTiledMapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.tiledMapLayer},is:function(layer){return this.isLoaded()?layer instanceof L.esri.tiledMapLayer:!1}},AGSDynamicMapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.dynamicMapLayer},is:function(layer){return this.isLoaded()?layer instanceof L.esri.dynamicMapLayer:!1}},AGSImageMapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.imageMapLayer},is:function(layer){return this.isLoaded()?layer instanceof L.esri.imageMapLayer:!1}},AGSClusteredLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.clusteredFeatureLayer},is:function(layer){return this.isLoaded()?layer instanceof L.esri.clusteredFeatureLayer:!1}},AGSHeatmapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.heatmapFeatureLayer},is:function(layer){return this.isLoaded()?layer instanceof L.esri.heatmapFeatureLayer:!1}},YandexLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Yandex)},is:function(layer){return this.isLoaded()?layer instanceof L.Yandex:!1}},GeoJSONPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.GeoJSON)},is:function(layer){return this.isLoaded()?layer instanceof L.TileLayer.GeoJSON:!1}},UTFGridPlugin:{isLoaded:function(){return angular.isDefined(L.UtfGrid)},is:function(layer){return this.isLoaded()?layer instanceof L.UtfGrid:($log.error("[AngularJS - Leaflet] No UtfGrid plugin found."),!1)}},CartoDB:{isLoaded:function(){return cartodb},is:function(){return!0}},Leaflet:{DivIcon:{is:function(icon){return icon instanceof L.DivIcon},equal:function(iconA,iconB){return this.is(iconA)?angular.equals(iconA,iconB):!1}},Icon:{is:function(icon){return icon instanceof L.Icon},equal:function(iconA,iconB){return this.is(iconA)?angular.equals(iconA,iconB):!1}}},watchOptions:{doWatch:!0,isDeep:!0,individual:{doWatch:!0,isDeep:!0}}}}]),angular.module("leaflet-directive").service("leafletIterators",["leafletLogger","leafletHelpers",function(leafletLogger,leafletHelpers){var _extendOwn,lHlp=leafletHelpers,errorHeader=leafletHelpers.errorHeader+"leafletIterators: ",_keys=Object.keys,_isFunction=lHlp.isFunction,_isObject=lHlp.isObject,$log=leafletLogger,MAX_ARRAY_INDEX=Math.pow(2,53)-1,_isArrayLike=function(collection){var length=null!==collection&&collection.length;return lHlp.isNumber(length)&&length>=0&&MAX_ARRAY_INDEX>=length},_identity=function(value){return value},_property=function(key){return function(obj){return null===obj?void 0:obj[key]}},optimizeCb=function(func,context,argCount){if(void 0===context)return func;switch(null===argCount?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}},createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(2>length||null===obj)return obj;for(var index=1;length>index;index++)for(var source=arguments[index],keys=keysFunc(source),l=keys.length,i=0;l>i;i++){var key=keys[i];undefinedOnly&&void 0!==obj[key]||(obj[key]=source[key])}return obj}},_assign=null;_extendOwn=_assign=createAssigner(_keys);var _matcher,_isMatch=function(object,attrs){var keys=_keys(attrs),length=keys.length;if(null===object)return!length;for(var obj=Object(object),i=0;length>i;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return!1}return!0},_matches=null;_matcher=_matches=function(attrs){return attrs=_extendOwn({},attrs),function(obj){return _isMatch(obj,attrs)}};var _every,cb=function(value,context,argCount){return null===value?_identity:_isFunction(value)?optimizeCb(value,context,argCount):_isObject(value)?_matcher(value):_property(value)},_all=null;_every=_all=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!_isArrayLike(obj)&&_keys(obj),length=(keys||obj).length,index=0;length>index;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return!1}return!0};var _hasErrors=function(collection,cb,ignoreCollection,cbName){return ignoreCollection||lHlp.isDefined(collection)&&lHlp.isDefined(cb)?lHlp.isFunction(cb)?!1:(cbName=lHlp.defaultTo(cb,"cb"),$log.error(errorHeader+cbName+" is not a function"),!0):!0},_iterate=function(collection,externalCb,internalCb){if(!_hasErrors(void 0,internalCb,!0,"internalCb")&&!_hasErrors(collection,externalCb))for(var key in collection)collection.hasOwnProperty(key)&&internalCb(collection[key],key)},_each=function(collection,cb){_iterate(collection,cb,function(val,key){cb(val,key)})};return{each:_each,forEach:_each,every:_every,all:_all}}]),angular.module("leaflet-directive").factory("leafletLayerHelpers",["$rootScope","$q","leafletLogger","leafletHelpers","leafletIterators",function($rootScope,$q,leafletLogger,leafletHelpers,leafletIterators){function isValidLayerType(layerDefinition){return isString(layerDefinition.type)?-1===Object.keys(layerTypes).indexOf(layerDefinition.type)?($log.error("[AngularJS - Leaflet] A layer must have a valid type: "+Object.keys(layerTypes)),!1):layerTypes[layerDefinition.type].mustHaveUrl&&!isString(layerDefinition.url)?($log.error("[AngularJS - Leaflet] A base layer must have an url"),!1):layerTypes[layerDefinition.type].mustHaveData&&!isDefined(layerDefinition.data)?($log.error('[AngularJS - Leaflet] The base layer must have a "data" array attribute'),!1):layerTypes[layerDefinition.type].mustHaveLayer&&!isDefined(layerDefinition.layer)?($log.error("[AngularJS - Leaflet] The type of layer "+layerDefinition.type+" must have an layer defined"),!1):layerTypes[layerDefinition.type].mustHaveBounds&&!isDefined(layerDefinition.bounds)?($log.error("[AngularJS - Leaflet] The type of layer "+layerDefinition.type+" must have bounds defined"),!1):layerTypes[layerDefinition.type].mustHaveKey&&!isDefined(layerDefinition.key)?($log.error("[AngularJS - Leaflet] The type of layer "+layerDefinition.type+" must have key defined"),!1):!0:($log.error("[AngularJS - Leaflet] A layer must have a valid type defined."),!1)}function createLayer(layerDefinition){if(isValidLayerType(layerDefinition)){if(!isString(layerDefinition.name))return void $log.error("[AngularJS - Leaflet] A base layer must have a name");isObject(layerDefinition.layerParams)||(layerDefinition.layerParams={}),isObject(layerDefinition.layerOptions)||(layerDefinition.layerOptions={});for(var attrname in layerDefinition.layerParams)layerDefinition.layerOptions[attrname]=layerDefinition.layerParams[attrname];var params={url:layerDefinition.url,data:layerDefinition.data,options:layerDefinition.layerOptions,layer:layerDefinition.layer,icon:layerDefinition.icon,type:layerDefinition.layerType,bounds:layerDefinition.bounds,anchors:layerDefinition.anchors,key:layerDefinition.key,apiKey:layerDefinition.apiKey,pluginOptions:layerDefinition.pluginOptions,user:layerDefinition.user};return layerTypes[layerDefinition.type].createLayer(params)}}function safeAddLayer(map,layer){layer&&"function"==typeof layer.addTo?layer.addTo(map):map.addLayer(layer)}function safeRemoveLayer(map,layer,layerOptions){if(isDefined(layerOptions)&&isDefined(layerOptions.loadedDefer))if(angular.isFunction(layerOptions.loadedDefer)){var defers=layerOptions.loadedDefer();$log.debug("Loaded Deferred",defers);for(var count=defers.length,resolve=function(){count--,0===count&&map.removeLayer(layer)},i=0;i<defers.length;i++)defers[i].promise.then(resolve)}else layerOptions.loadedDefer.promise.then(function(){map.removeLayer(layer)});else map.removeLayer(layer)}var Helpers=leafletHelpers,isString=leafletHelpers.isString,isObject=leafletHelpers.isObject,isArray=leafletHelpers.isArray,isDefined=leafletHelpers.isDefined,errorHeader=leafletHelpers.errorHeader,$it=leafletIterators,$log=leafletLogger,utfGridCreateLayer=function(params){if(!Helpers.UTFGridPlugin.isLoaded())return void $log.error("[AngularJS - Leaflet] The UTFGrid plugin is not loaded.");var utfgrid=new L.UtfGrid(params.url,params.pluginOptions);return utfgrid.on("mouseover",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridMouseover",e)}),utfgrid.on("mouseout",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridMouseout",e)}),utfgrid.on("click",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridClick",e)}),utfgrid.on("mousemove",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridMousemove",e)}),utfgrid},layerTypes={xyz:{mustHaveUrl:!0,createLayer:function(params){return L.tileLayer(params.url,params.options)}},mapbox:{mustHaveKey:!0,createLayer:function(params){var version=3;isDefined(params.options.version)&&4===params.options.version&&(version=params.options.version);var url=3===version?"//{s}.tiles.mapbox.com/v3/"+params.key+"/{z}/{x}/{y}.png":"//api.tiles.mapbox.com/v4/"+params.key+"/{z}/{x}/{y}.png?access_token="+params.apiKey;return L.tileLayer(url,params.options)}},geoJSON:{mustHaveUrl:!0,createLayer:function(params){return Helpers.GeoJSONPlugin.isLoaded()?new L.TileLayer.GeoJSON(params.url,params.pluginOptions,params.options):void 0}},geoJSONShape:{mustHaveUrl:!1,createLayer:function(params){return new L.GeoJSON(params.data,params.options)}},geoJSONAwesomeMarker:{mustHaveUrl:!1,createLayer:function(params){return new L.geoJson(params.data,{pointToLayer:function(feature,latlng){return L.marker(latlng,{icon:L.AwesomeMarkers.icon(params.icon)})}})}},utfGrid:{mustHaveUrl:!0,createLayer:utfGridCreateLayer},cartodbTiles:{mustHaveKey:!0,createLayer:function(params){var url="//"+params.user+".cartodb.com/api/v1/map/"+params.key+"/{z}/{x}/{y}.png";return L.tileLayer(url,params.options)}},cartodbUTFGrid:{mustHaveKey:!0,mustHaveLayer:!0,createLayer:function(params){return params.url="//"+params.user+".cartodb.com/api/v1/map/"+params.key+"/"+params.layer+"/{z}/{x}/{y}.grid.json",utfGridCreateLayer(params)}},cartodbInteractive:{mustHaveKey:!0,mustHaveLayer:!0,createLayer:function(params){var tilesURL="//"+params.user+".cartodb.com/api/v1/map/"+params.key+"/{z}/{x}/{y}.png",tileLayer=L.tileLayer(tilesURL,params.options);params.url="//"+params.user+".cartodb.com/api/v1/map/"+params.key+"/"+params.layer+"/{z}/{x}/{y}.grid.json";var utfLayer=utfGridCreateLayer(params);return L.layerGroup([tileLayer,utfLayer])}},wms:{mustHaveUrl:!0,createLayer:function(params){return L.tileLayer.wms(params.url,params.options)}},wmts:{mustHaveUrl:!0,createLayer:function(params){return L.tileLayer.wmts(params.url,params.options)}},wfs:{mustHaveUrl:!0,mustHaveLayer:!0,createLayer:function(params){if(Helpers.WFSLayerPlugin.isLoaded()){var options=angular.copy(params.options);return options.crs&&"string"==typeof options.crs&&(options.crs=eval(options.crs)),new L.GeoJSON.WFS(params.url,params.layer,options)}}},group:{mustHaveUrl:!1,createLayer:function(params){var lyrs=[];return $it.each(params.options.layers,function(l){lyrs.push(createLayer(l))}),params.options.loadedDefer=function(){for(var defers=[],i=0;i<params.options.layers.length;i++){var d=params.options.layers[i].layerOptions.loadedDefer;isDefined(d)&&defers.push(d)}return defers},L.layerGroup(lyrs)}},featureGroup:{mustHaveUrl:!1,createLayer:function(){return L.featureGroup()}},google:{mustHaveUrl:!1,createLayer:function(params){var type=params.type||"SATELLITE";if(Helpers.GoogleLayerPlugin.isLoaded())return new L.Google(type,params.options)}},china:{mustHaveUrl:!1,createLayer:function(params){var type=params.type||"";if(Helpers.ChinaLayerPlugin.isLoaded())return L.tileLayer.chinaProvider(type,params.options)}},agsBase:{mustHaveLayer:!0,createLayer:function(params){return Helpers.AGSBaseLayerPlugin.isLoaded()?L.esri.basemapLayer(params.layer,params.options):void 0}},ags:{mustHaveUrl:!0,createLayer:function(params){if(Helpers.AGSLayerPlugin.isLoaded()){var options=angular.copy(params.options);angular.extend(options,{url:params.url});var layer=new lvector.AGS(options);return layer.onAdd=function(map){this.setMap(map)},layer.onRemove=function(){this.setMap(null)},layer}}},agsFeature:{mustHaveUrl:!0,createLayer:function(params){if(!Helpers.AGSFeatureLayerPlugin.isLoaded())return void $log.warn(errorHeader+" The esri plugin is not loaded.");params.options.url=params.url;var layer=L.esri.featureLayer(params.options),load=function(){isDefined(params.options.loadedDefer)&&params.options.loadedDefer.resolve()};return layer.on("loading",function(){params.options.loadedDefer=$q.defer(),layer.off("load",load),layer.on("load",load)}),layer}},agsTiled:{mustHaveUrl:!0,createLayer:function(params){return Helpers.AGSTiledMapLayerPlugin.isLoaded()?(params.options.url=params.url,L.esri.tiledMapLayer(params.options)):void $log.warn(errorHeader+" The esri plugin is not loaded.")}},agsDynamic:{mustHaveUrl:!0,createLayer:function(params){return Helpers.AGSDynamicMapLayerPlugin.isLoaded()?(params.options.url=params.url,L.esri.dynamicMapLayer(params.options)):void $log.warn(errorHeader+" The esri plugin is not loaded.")}},agsImage:{mustHaveUrl:!0,createLayer:function(params){return Helpers.AGSImageMapLayerPlugin.isLoaded()?(params.options.url=params.url,L.esri.imageMapLayer(params.options)):void $log.warn(errorHeader+" The esri plugin is not loaded.")}},agsClustered:{mustHaveUrl:!0,createLayer:function(params){return Helpers.AGSClusteredLayerPlugin.isLoaded()?Helpers.MarkerClusterPlugin.isLoaded()?L.esri.clusteredFeatureLayer(params.url,params.options):void $log.warn(errorHeader+" The markercluster plugin is not loaded."):void $log.warn(errorHeader+" The esri clustered layer plugin is not loaded.")}},agsHeatmap:{mustHaveUrl:!0,createLayer:function(params){return Helpers.AGSHeatmapLayerPlugin.isLoaded()?Helpers.HeatLayerPlugin.isLoaded()?L.esri.heatmapFeatureLayer(params.url,params.options):void $log.warn(errorHeader+" The heatlayer plugin is not loaded."):void $log.warn(errorHeader+" The esri heatmap layer plugin is not loaded.")}},markercluster:{mustHaveUrl:!1,createLayer:function(params){return Helpers.MarkerClusterPlugin.isLoaded()?new L.MarkerClusterGroup(params.options):void $log.warn(errorHeader+" The markercluster plugin is not loaded.")}},bing:{mustHaveUrl:!1,createLayer:function(params){return Helpers.BingLayerPlugin.isLoaded()?new L.BingLayer(params.key,params.options):void 0}},webGLHeatmap:{mustHaveUrl:!1,mustHaveData:!0,createLayer:function(params){if(Helpers.WebGLHeatMapLayerPlugin.isLoaded()){var layer=new L.TileLayer.WebGLHeatMap(params.options);return isDefined(params.data)&&layer.setData(params.data),layer}}},heat:{mustHaveUrl:!1,mustHaveData:!0,createLayer:function(params){if(Helpers.HeatLayerPlugin.isLoaded()){var layer=new L.heatLayer;return isArray(params.data)&&layer.setLatLngs(params.data),isObject(params.options)&&layer.setOptions(params.options),layer}}},yandex:{mustHaveUrl:!1,createLayer:function(params){var type=params.type||"map";if(Helpers.YandexLayerPlugin.isLoaded())return new L.Yandex(type,params.options)}},imageOverlay:{mustHaveUrl:!0,mustHaveBounds:!0,createLayer:function(params){return L.imageOverlay(params.url,params.bounds,params.options)}},imageTransform:{mustHaveUrl:!0,createLayer:function(params){return console.log(params),L.imageTransform(params.url,params.anchors,params.options)}},imageDistort:{mustHaveUrl:!0,createLayer:function(params){return new L.DistortableImageOverlay(params.url,{corners:params.anchors})}},iip:{mustHaveUrl:!0,createLayer:function(params){return L.tileLayer.iip(params.url,params.options)}},custom:{createLayer:function(params){return params.layer instanceof L.Class?angular.copy(params.layer):void $log.error("[AngularJS - Leaflet] A custom layer must be a leaflet Class")}},cartodb:{mustHaveUrl:!0,createLayer:function(params){return cartodb.createLayer(params.map,params.url)}},tangram:{createLayer:function(params){return Tangram.leafletLayer(params.options)}}};return{createLayer:createLayer,safeAddLayer:safeAddLayer,safeRemoveLayer:safeRemoveLayer}}]),angular.module("leaflet-directive").factory("leafletLegendHelpers",function(){var _updateLegend=function(div,legendData,type,url){if(div.innerHTML="",legendData.error)div.innerHTML+='<div class="info-title alert alert-danger">'+legendData.error.message+"</div>";else if("arcgis"===type)for(var i=0;i<legendData.layers.length;i++){var layer=legendData.layers[i];div.innerHTML+='<div class="info-title" data-layerid="'+layer.layerId+'">'+layer.layerName+"</div>";for(var j=0;j<layer.legend.length;j++){var leg=layer.legend[j];div.innerHTML+='<div class="inline" data-layerid="'+layer.layerId+'"><img src="data:'+leg.contentType+";base64,"+leg.imageData+'" /></div><div class="info-label" data-layerid="'+layer.layerId+'">'+leg.label+"</div>"}}else"image"===type&&(div.innerHTML='<img src="'+url+'"/>')},_getOnAddLegend=function(legendData,legendClass,type,url){return function(){var div=L.DomUtil.create("div",legendClass);return L.Browser.touch?L.DomEvent.on(div,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(div),L.DomEvent.on(div,"mousewheel",L.DomEvent.stopPropagation)),_updateLegend(div,legendData,type,url),div}},_getOnAddArrayLegend=function(legend,legendClass){return function(){for(var div=L.DomUtil.create("div",legendClass),i=0;i<legend.colors.length;i++)div.innerHTML+='<div class="outline"><i style="background:'+legend.colors[i]+'"></i></div><div class="info-label">'+legend.labels[i]+"</div>";return L.Browser.touch?L.DomEvent.on(div,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(div),L.DomEvent.on(div,"mousewheel",L.DomEvent.stopPropagation)),div}};return{getOnAddLegend:_getOnAddLegend,getOnAddArrayLegend:_getOnAddArrayLegend,updateLegend:_updateLegend}}),angular.module("leaflet-directive").factory("leafletMapDefaults",["$q","leafletHelpers",function($q,leafletHelpers){function _getDefaults(){return{keyboard:!0,dragging:!0,worldCopyJump:!1,doubleClickZoom:!0,scrollWheelZoom:!0,tap:!0,touchZoom:!0,zoomControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",attributionControl:!0,controls:{layers:{visible:!0,position:"topright",collapsed:!0}},nominatim:{server:" http://nominatim.openstreetmap.org/search"},crs:L.CRS.EPSG3857,tileLayer:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var isDefined=leafletHelpers.isDefined,isObject=leafletHelpers.isObject,obtainEffectiveMapId=leafletHelpers.obtainEffectiveMapId,defaults={};return{reset:function(){defaults={}},getDefaults:function(scopeId){var mapId=obtainEffectiveMapId(defaults,scopeId);return defaults[mapId]},getMapCreationDefaults:function(scopeId){var mapId=obtainEffectiveMapId(defaults,scopeId),d=defaults[mapId],mapDefaults={maxZoom:d.maxZoom,keyboard:d.keyboard,dragging:d.dragging,zoomControl:d.zoomControl,doubleClickZoom:d.doubleClickZoom,scrollWheelZoom:d.scrollWheelZoom,tap:d.tap,touchZoom:d.touchZoom,attributionControl:d.attributionControl,worldCopyJump:d.worldCopyJump,crs:d.crs};if(isDefined(d.minZoom)&&(mapDefaults.minZoom=d.minZoom),isDefined(d.zoomAnimation)&&(mapDefaults.zoomAnimation=d.zoomAnimation),isDefined(d.fadeAnimation)&&(mapDefaults.fadeAnimation=d.fadeAnimation),isDefined(d.markerZoomAnimation)&&(mapDefaults.markerZoomAnimation=d.markerZoomAnimation),d.map)for(var option in d.map)mapDefaults[option]=d.map[option];return mapDefaults},setDefaults:function(userDefaults,scopeId){var newDefaults=_getDefaults();isDefined(userDefaults)&&(newDefaults.doubleClickZoom=isDefined(userDefaults.doubleClickZoom)?userDefaults.doubleClickZoom:newDefaults.doubleClickZoom,newDefaults.scrollWheelZoom=isDefined(userDefaults.scrollWheelZoom)?userDefaults.scrollWheelZoom:newDefaults.doubleClickZoom,newDefaults.tap=isDefined(userDefaults.tap)?userDefaults.tap:newDefaults.tap,newDefaults.touchZoom=isDefined(userDefaults.touchZoom)?userDefaults.touchZoom:newDefaults.doubleClickZoom,newDefaults.zoomControl=isDefined(userDefaults.zoomControl)?userDefaults.zoomControl:newDefaults.zoomControl,newDefaults.zoomsliderControl=isDefined(userDefaults.zoomsliderControl)?userDefaults.zoomsliderControl:newDefaults.zoomsliderControl,newDefaults.attributionControl=isDefined(userDefaults.attributionControl)?userDefaults.attributionControl:newDefaults.attributionControl,newDefaults.tileLayer=isDefined(userDefaults.tileLayer)?userDefaults.tileLayer:newDefaults.tileLayer,newDefaults.zoomControlPosition=isDefined(userDefaults.zoomControlPosition)?userDefaults.zoomControlPosition:newDefaults.zoomControlPosition,newDefaults.keyboard=isDefined(userDefaults.keyboard)?userDefaults.keyboard:newDefaults.keyboard,newDefaults.dragging=isDefined(userDefaults.dragging)?userDefaults.dragging:newDefaults.dragging,isDefined(userDefaults.controls)&&angular.extend(newDefaults.controls,userDefaults.controls),isObject(userDefaults.crs)?newDefaults.crs=userDefaults.crs:isDefined(L.CRS[userDefaults.crs])&&(newDefaults.crs=L.CRS[userDefaults.crs]),isDefined(userDefaults.center)&&angular.copy(userDefaults.center,newDefaults.center),isDefined(userDefaults.tileLayerOptions)&&angular.copy(userDefaults.tileLayerOptions,newDefaults.tileLayerOptions),isDefined(userDefaults.maxZoom)&&(newDefaults.maxZoom=userDefaults.maxZoom),isDefined(userDefaults.minZoom)&&(newDefaults.minZoom=userDefaults.minZoom),isDefined(userDefaults.zoomAnimation)&&(newDefaults.zoomAnimation=userDefaults.zoomAnimation),isDefined(userDefaults.fadeAnimation)&&(newDefaults.fadeAnimation=userDefaults.fadeAnimation),isDefined(userDefaults.markerZoomAnimation)&&(newDefaults.markerZoomAnimation=userDefaults.markerZoomAnimation),isDefined(userDefaults.worldCopyJump)&&(newDefaults.worldCopyJump=userDefaults.worldCopyJump),isDefined(userDefaults.map)&&(newDefaults.map=userDefaults.map),isDefined(userDefaults.path)&&(newDefaults.path=userDefaults.path));var mapId=obtainEffectiveMapId(defaults,scopeId);return defaults[mapId]=newDefaults,newDefaults}}}]),angular.module("leaflet-directive").service("leafletMarkersHelpers",["$rootScope","$timeout","leafletHelpers","leafletLogger","$compile","leafletGeoJsonHelpers",function($rootScope,$timeout,leafletHelpers,leafletLogger,$compile,leafletGeoJsonHelpers){var isDefined=leafletHelpers.isDefined,defaultTo=leafletHelpers.defaultTo,MarkerClusterPlugin=leafletHelpers.MarkerClusterPlugin,AwesomeMarkersPlugin=leafletHelpers.AwesomeMarkersPlugin,MakiMarkersPlugin=leafletHelpers.MakiMarkersPlugin,ExtraMarkersPlugin=leafletHelpers.ExtraMarkersPlugin,DomMarkersPlugin=leafletHelpers.DomMarkersPlugin,safeApply=leafletHelpers.safeApply,Helpers=leafletHelpers,isString=leafletHelpers.isString,isNumber=leafletHelpers.isNumber,isObject=leafletHelpers.isObject,groups={},geoHlp=leafletGeoJsonHelpers,errorHeader=leafletHelpers.errorHeader,$log=leafletLogger,_string=function(marker){var retStr="";return["_icon","_latlng","_leaflet_id","_map","_shadow"].forEach(function(prop){retStr+=prop+": "+defaultTo(marker[prop],"undefined")+" \n"}),"[leafletMarker] : \n"+retStr},_log=function(marker,useConsole){var logger=useConsole?console:$log;logger.debug(_string(marker))},createLeafletIcon=function(iconData){if(isDefined(iconData)&&isDefined(iconData.type)&&"awesomeMarker"===iconData.type)return AwesomeMarkersPlugin.isLoaded()||$log.error(errorHeader+" The AwesomeMarkers Plugin is not loaded."),new L.AwesomeMarkers.icon(iconData);if(isDefined(iconData)&&isDefined(iconData.type)&&"makiMarker"===iconData.type)return MakiMarkersPlugin.isLoaded()||$log.error(errorHeader+"The MakiMarkers Plugin is not loaded."),
new L.MakiMarkers.icon(iconData);if(isDefined(iconData)&&isDefined(iconData.type)&&"extraMarker"===iconData.type)return ExtraMarkersPlugin.isLoaded()||$log.error(errorHeader+"The ExtraMarkers Plugin is not loaded."),new L.ExtraMarkers.icon(iconData);if(isDefined(iconData)&&isDefined(iconData.type)&&"div"===iconData.type)return new L.divIcon(iconData);if(isDefined(iconData)&&isDefined(iconData.type)&&"dom"===iconData.type){DomMarkersPlugin.isLoaded()||$log.error(errorHeader+"The DomMarkers Plugin is not loaded.");var markerScope=angular.isFunction(iconData.getMarkerScope)?iconData.getMarkerScope():$rootScope,template=$compile(iconData.template)(markerScope),iconDataCopy=angular.copy(iconData);return iconDataCopy.element=template[0],new L.DomMarkers.icon(iconDataCopy)}if(isDefined(iconData)&&isDefined(iconData.type)&&"icon"===iconData.type)return iconData.icon;var base64icon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==",base64shadow="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAC5ElEQVRYw+2YW4/TMBCF45S0S1luXZCABy5CgLQgwf//S4BYBLTdJLax0fFqmB07nnQfEGqkIydpVH85M+NLjPe++dcPc4Q8Qh4hj5D/AaQJx6H/4TMwB0PeBNwU7EGQAmAtsNfAzoZkgIa0ZgLMa4Aj6CxIAsjhjOCoL5z7Glg1JAOkaicgvQBXuncwJAWjksLtBTWZe04CnYRktUGdilALppZBOgHGZcBzL6OClABvMSVIzyBjazOgrvACf1ydC5mguqAVg6RhdkSWQFj2uxfaq/BrIZOLEWgZdALIDvcMcZLD8ZbLC9de4yR1sYMi4G20S4Q/PWeJYxTOZn5zJXANZHIxAd4JWhPIloTJZhzMQduM89WQ3MUVAE/RnhAXpTycqys3NZALOBbB7kFrgLesQl2h45Fcj8L1tTSohUwuxhy8H/Qg6K7gIs+3kkaigQCOcyEXCHN07wyQazhrmIulvKMQAwMcmLNqyCVyMAI+BuxSMeTk3OPikLY2J1uE+VHQk6ANrhds+tNARqBeaGc72cK550FP4WhXmFmcMGhTwAR1ifOe3EvPqIegFmF+C8gVy0OfAaWQPMR7gF1OQKqGoBjq90HPMP01BUjPOqGFksC4emE48tWQAH0YmvOgF3DST6xieJgHAWxPAHMuNhrImIdvoNOKNWIOcE+UXE0pYAnkX6uhWsgVXDxHdTfCmrEEmMB2zMFimLVOtiiajxiGWrbU52EeCdyOwPEQD8LqyPH9Ti2kgYMf4OhSKB7qYILbBv3CuVTJ11Y80oaseiMWOONc/Y7kJYe0xL2f0BaiFTxknHO5HaMGMublKwxFGzYdWsBF174H/QDknhTHmHHN39iWFnkZx8lPyM8WHfYELmlLKtgWNmFNzQcC1b47gJ4hL19i7o65dhH0Negbca8vONZoP7doIeOC9zXm8RjuL0Gf4d4OYaU5ljo3GYiqzrWQHfJxA6ALhDpVKv9qYeZA8eM3EhfPSCmpuD0AAAAASUVORK5CYII=";return isDefined(iconData)&&isDefined(iconData.iconUrl)?new L.Icon(iconData):new L.Icon.Default({iconUrl:base64icon,shadowUrl:base64shadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})},_resetMarkerGroup=function(groupName){isDefined(groups[groupName])&&groups.splice(groupName,1)},_resetMarkerGroups=function(){groups={}},_deleteMarker=function(marker,map,layers){if(marker.closePopup(),isDefined(layers)&&isDefined(layers.overlays))for(var key in layers.overlays)if((layers.overlays[key]instanceof L.LayerGroup||layers.overlays[key]instanceof L.FeatureGroup)&&layers.overlays[key].hasLayer(marker))return void layers.overlays[key].removeLayer(marker);if(isDefined(groups))for(var groupKey in groups)groups[groupKey].hasLayer(marker)&&groups[groupKey].removeLayer(marker);map.hasLayer(marker)&&map.removeLayer(marker)},adjustPopupPan=function(marker,map){var containerHeight=marker._popup._container.offsetHeight,layerPos=new L.Point(marker._popup._containerLeft,-containerHeight-marker._popup._containerBottom),containerPos=map.layerPointToContainerPoint(layerPos);null!==containerPos&&marker._popup._adjustPan()},compilePopup=function(marker,markerScope){$compile(marker._popup._contentNode)(markerScope)},updatePopup=function(marker,markerScope,map){var innerText=marker._popup._contentNode.innerText||marker._popup._contentNode.textContent;innerText.length<1&&$timeout(function(){updatePopup(marker,markerScope,map)});var reflow=marker._popup._contentNode.offsetWidth;return marker._popup._updateLayout(),marker._popup._updatePosition(),marker._popup.options.autoPan&&adjustPopupPan(marker,map),reflow},_manageOpenPopup=function(marker,markerData,map){var markerScope=angular.isFunction(markerData.getMessageScope)?markerData.getMessageScope():$rootScope,compileMessage=isDefined(markerData.compileMessage)?markerData.compileMessage:!0;if(compileMessage){if(!isDefined(marker._popup)||!isDefined(marker._popup._contentNode))return $log.error(errorHeader+"Popup is invalid or does not have any content."),!1;compilePopup(marker,markerScope),updatePopup(marker,markerData,map)}},_manageOpenLabel=function(marker,markerData){var markerScope=angular.isFunction(markerData.getMessageScope)?markerData.getMessageScope():$rootScope,labelScope=angular.isFunction(markerData.getLabelScope)?markerData.getLabelScope():markerScope,compileMessage=isDefined(markerData.compileMessage)?markerData.compileMessage:!0;Helpers.LabelPlugin.isLoaded()&&isDefined(markerData.label)&&(isDefined(markerData.label.options)&&markerData.label.options.noHide===!0&&marker.showLabel(),compileMessage&&isDefined(marker.label)&&$compile(marker.label._container)(labelScope))},_updateMarker=function(markerData,oldMarkerData,marker,name,leafletScope,layers,map){if(isDefined(oldMarkerData)){if(!geoHlp.validateCoords(markerData))return $log.warn("There are problems with lat-lng data, please verify your marker model"),void _deleteMarker(marker,map,layers);var isInitializing=markerData===oldMarkerData;if(isDefined(markerData.iconAngle)&&oldMarkerData.iconAngle!==markerData.iconAngle&&marker.setIconAngle(markerData.iconAngle),isString(markerData.layer)||isString(oldMarkerData.layer)&&(isDefined(layers.overlays[oldMarkerData.layer])&&layers.overlays[oldMarkerData.layer].hasLayer(marker)&&(layers.overlays[oldMarkerData.layer].removeLayer(marker),marker.closePopup()),map.hasLayer(marker)||map.addLayer(marker)),(isNumber(markerData.opacity)||isNumber(parseFloat(markerData.opacity)))&&markerData.opacity!==oldMarkerData.opacity&&marker.setOpacity(markerData.opacity),isString(markerData.layer)&&oldMarkerData.layer!==markerData.layer){if(isString(oldMarkerData.layer)&&isDefined(layers.overlays[oldMarkerData.layer])&&layers.overlays[oldMarkerData.layer].hasLayer(marker)&&layers.overlays[oldMarkerData.layer].removeLayer(marker),marker.closePopup(),map.hasLayer(marker)&&map.removeLayer(marker),!isDefined(layers.overlays[markerData.layer]))return void $log.error(errorHeader+"You must use a name of an existing layer");var layerGroup=layers.overlays[markerData.layer];if(!(layerGroup instanceof L.LayerGroup||layerGroup instanceof L.FeatureGroup))return void $log.error(errorHeader+'A marker can only be added to a layer of type "group" or "featureGroup"');layerGroup.addLayer(marker),map.hasLayer(marker)&&markerData.focus===!0&&marker.openPopup()}if(markerData.draggable!==!0&&oldMarkerData.draggable===!0&&isDefined(marker.dragging)&&marker.dragging.disable(),markerData.draggable===!0&&oldMarkerData.draggable!==!0&&(marker.dragging?marker.dragging.enable():L.Handler.MarkerDrag&&(marker.dragging=new L.Handler.MarkerDrag(marker),marker.options.draggable=!0,marker.dragging.enable())),isObject(markerData.icon)||isObject(oldMarkerData.icon)&&(marker.setIcon(createLeafletIcon()),marker.closePopup(),marker.unbindPopup(),isString(markerData.message)&&marker.bindPopup(markerData.message,markerData.popupOptions)),isObject(markerData.icon)&&isObject(oldMarkerData.icon)&&!angular.equals(markerData.icon,oldMarkerData.icon)){var dragG=!1;marker.dragging&&(dragG=marker.dragging.enabled()),marker.setIcon(createLeafletIcon(markerData.icon)),dragG&&marker.dragging.enable(),marker.closePopup(),marker.unbindPopup(),isString(markerData.message)&&marker.bindPopup(markerData.message,markerData.popupOptions)}!isString(markerData.message)&&isString(oldMarkerData.message)&&(marker.closePopup(),marker.unbindPopup()),Helpers.LabelPlugin.isLoaded()&&(isDefined(markerData.label)&&isDefined(markerData.label.message)?"label"in oldMarkerData&&"message"in oldMarkerData.label&&!angular.equals(markerData.label.message,oldMarkerData.label.message)?marker.updateLabelContent(markerData.label.message):!angular.isFunction(marker.getLabel)||angular.isFunction(marker.getLabel)&&!isDefined(marker.getLabel())?(marker.bindLabel(markerData.label.message,markerData.label.options),_manageOpenLabel(marker,markerData)):_manageOpenLabel(marker,markerData):(!("label"in markerData)||"message"in markerData.label)&&angular.isFunction(marker.unbindLabel)&&marker.unbindLabel()),isString(markerData.message)&&!isString(oldMarkerData.message)&&marker.bindPopup(markerData.message,markerData.popupOptions),isString(markerData.message)&&isString(oldMarkerData.message)&&markerData.message!==oldMarkerData.message&&marker.setPopupContent(markerData.message);var updatedFocus=!1;markerData.focus!==!0&&oldMarkerData.focus===!0&&(marker.closePopup(),updatedFocus=!0),(markerData.focus===!0&&(!isDefined(oldMarkerData.focus)||oldMarkerData.focus===!1)||isInitializing&&markerData.focus===!0)&&(marker.openPopup(),updatedFocus=!0),oldMarkerData.zIndexOffset!==markerData.zIndexOffset&&marker.setZIndexOffset(markerData.zIndexOffset);var markerLatLng=marker.getLatLng(),isCluster=isString(markerData.layer)&&Helpers.MarkerClusterPlugin.is(layers.overlays[markerData.layer]);isCluster?updatedFocus?(markerData.lat!==oldMarkerData.lat||markerData.lng!==oldMarkerData.lng)&&(layers.overlays[markerData.layer].removeLayer(marker),marker.setLatLng([markerData.lat,markerData.lng]),layers.overlays[markerData.layer].addLayer(marker)):markerLatLng.lat!==markerData.lat||markerLatLng.lng!==markerData.lng?(layers.overlays[markerData.layer].removeLayer(marker),marker.setLatLng([markerData.lat,markerData.lng]),layers.overlays[markerData.layer].addLayer(marker)):markerData.lat!==oldMarkerData.lat||markerData.lng!==oldMarkerData.lng?(layers.overlays[markerData.layer].removeLayer(marker),marker.setLatLng([markerData.lat,markerData.lng]),layers.overlays[markerData.layer].addLayer(marker)):isObject(markerData.icon)&&isObject(oldMarkerData.icon)&&!angular.equals(markerData.icon,oldMarkerData.icon)&&(layers.overlays[markerData.layer].removeLayer(marker),layers.overlays[markerData.layer].addLayer(marker)):(markerLatLng.lat!==markerData.lat||markerLatLng.lng!==markerData.lng)&&marker.setLatLng([markerData.lat,markerData.lng])}};return{resetMarkerGroup:_resetMarkerGroup,resetMarkerGroups:_resetMarkerGroups,deleteMarker:_deleteMarker,manageOpenPopup:_manageOpenPopup,manageOpenLabel:_manageOpenLabel,createMarker:function(markerData){if(!isDefined(markerData)||!geoHlp.validateCoords(markerData))return void $log.error(errorHeader+"The marker definition is not valid.");var coords=geoHlp.getCoords(markerData);if(!isDefined(coords))return void $log.error(errorHeader+"Unable to get coordinates from markerData.");var markerOptions={icon:createLeafletIcon(markerData.icon),title:isDefined(markerData.title)?markerData.title:"",draggable:isDefined(markerData.draggable)?markerData.draggable:!1,clickable:isDefined(markerData.clickable)?markerData.clickable:!0,riseOnHover:isDefined(markerData.riseOnHover)?markerData.riseOnHover:!1,zIndexOffset:isDefined(markerData.zIndexOffset)?markerData.zIndexOffset:0,iconAngle:isDefined(markerData.iconAngle)?markerData.iconAngle:0};for(var markerDatum in markerData)markerData.hasOwnProperty(markerDatum)&&!markerOptions.hasOwnProperty(markerDatum)&&(markerOptions[markerDatum]=markerData[markerDatum]);var marker=new L.marker(coords,markerOptions);return isString(markerData.message)||marker.unbindPopup(),marker},addMarkerToGroup:function(marker,groupName,groupOptions,map){return isString(groupName)?MarkerClusterPlugin.isLoaded()?(isDefined(groups[groupName])||(groups[groupName]=new L.MarkerClusterGroup(groupOptions),map.addLayer(groups[groupName])),void groups[groupName].addLayer(marker)):void $log.error(errorHeader+"The MarkerCluster plugin is not loaded."):void $log.error(errorHeader+"The marker group you have specified is invalid.")},listenMarkerEvents:function(marker,markerData,leafletScope,doWatch,map){marker.on("popupopen",function(){safeApply(leafletScope,function(){(isDefined(marker._popup)||isDefined(marker._popup._contentNode))&&(markerData.focus=!0,_manageOpenPopup(marker,markerData,map))})}),marker.on("popupclose",function(){safeApply(leafletScope,function(){markerData.focus=!1})}),marker.on("add",function(){safeApply(leafletScope,function(){"label"in markerData&&_manageOpenLabel(marker,markerData)})})},updateMarker:_updateMarker,addMarkerWatcher:function(marker,name,leafletScope,layers,map,isDeepWatch){var markerWatchPath=Helpers.getObjectArrayPath("markers."+name);isDeepWatch=defaultTo(isDeepWatch,!0);var clearWatch=leafletScope.$watch(markerWatchPath,function(markerData,oldMarkerData){return isDefined(markerData)?void _updateMarker(markerData,oldMarkerData,marker,name,leafletScope,layers,map):(_deleteMarker(marker,map,layers),void clearWatch())},isDeepWatch)},string:_string,log:_log}}]),angular.module("leaflet-directive").factory("leafletPathsHelpers",["$rootScope","leafletLogger","leafletHelpers",function($rootScope,leafletLogger,leafletHelpers){function _convertToLeafletLatLngs(latlngs){return latlngs.filter(function(latlng){return isValidPoint(latlng)}).map(function(latlng){return _convertToLeafletLatLng(latlng)})}function _convertToLeafletLatLng(latlng){return isArray(latlng)?new L.LatLng(latlng[0],latlng[1]):new L.LatLng(latlng.lat,latlng.lng)}function _convertToLeafletMultiLatLngs(paths){return paths.map(function(latlngs){return _convertToLeafletLatLngs(latlngs)})}function _getOptions(path,defaults){for(var options={},i=0;i<availableOptions.length;i++){var optionName=availableOptions[i];isDefined(path[optionName])?options[optionName]=path[optionName]:isDefined(defaults.path[optionName])&&(options[optionName]=defaults.path[optionName])}return options}var isDefined=leafletHelpers.isDefined,isArray=leafletHelpers.isArray,isNumber=leafletHelpers.isNumber,isValidPoint=leafletHelpers.isValidPoint,$log=leafletLogger,availableOptions=["stroke","weight","color","opacity","fill","fillColor","fillOpacity","dashArray","lineCap","lineJoin","clickable","pointerEvents","className","smoothFactor","noClip"],_updatePathOptions=function(path,data){for(var updatedStyle={},i=0;i<availableOptions.length;i++){var optionName=availableOptions[i];isDefined(data[optionName])&&(updatedStyle[optionName]=data[optionName])}path.setStyle(data)},_isValidPolyline=function(latlngs){if(!isArray(latlngs))return!1;for(var i=0;i<latlngs.length;i++){var point=latlngs[i];if(!isValidPoint(point))return!1}return!0},pathTypes={polyline:{isValid:function(pathData){var latlngs=pathData.latlngs;return _isValidPolyline(latlngs)},createPath:function(options){return new L.Polyline([],options)},setPath:function(path,data){path.setLatLngs(_convertToLeafletLatLngs(data.latlngs)),_updatePathOptions(path,data)}},multiPolyline:{isValid:function(pathData){var latlngs=pathData.latlngs;if(!isArray(latlngs))return!1;for(var i in latlngs){var polyline=latlngs[i];if(!_isValidPolyline(polyline))return!1}return!0},createPath:function(options){return new L.multiPolyline([[[0,0],[1,1]]],options)},setPath:function(path,data){path.setLatLngs(_convertToLeafletMultiLatLngs(data.latlngs)),_updatePathOptions(path,data)}},polygon:{isValid:function(pathData){var latlngs=pathData.latlngs;return _isValidPolyline(latlngs)},createPath:function(options){return new L.Polygon([],options)},setPath:function(path,data){path.setLatLngs(_convertToLeafletLatLngs(data.latlngs)),_updatePathOptions(path,data)}},multiPolygon:{isValid:function(pathData){var latlngs=pathData.latlngs;if(!isArray(latlngs))return!1;for(var i in latlngs){var polyline=latlngs[i];if(!_isValidPolyline(polyline))return!1}return!0},createPath:function(options){return new L.MultiPolygon([[[0,0],[1,1],[0,1]]],options)},setPath:function(path,data){path.setLatLngs(_convertToLeafletMultiLatLngs(data.latlngs)),_updatePathOptions(path,data)}},rectangle:{isValid:function(pathData){var latlngs=pathData.latlngs;if(!isArray(latlngs)||2!==latlngs.length)return!1;for(var i in latlngs){var point=latlngs[i];if(!isValidPoint(point))return!1}return!0},createPath:function(options){return new L.Rectangle([[0,0],[1,1]],options)},setPath:function(path,data){path.setBounds(new L.LatLngBounds(_convertToLeafletLatLngs(data.latlngs))),_updatePathOptions(path,data)}},circle:{isValid:function(pathData){var point=pathData.latlngs;return isValidPoint(point)&&isNumber(pathData.radius)},createPath:function(options){return new L.Circle([0,0],1,options)},setPath:function(path,data){path.setLatLng(_convertToLeafletLatLng(data.latlngs)),isDefined(data.radius)&&path.setRadius(data.radius),_updatePathOptions(path,data)}},circleMarker:{isValid:function(pathData){var point=pathData.latlngs;return isValidPoint(point)&&isNumber(pathData.radius)},createPath:function(options){return new L.CircleMarker([0,0],options)},setPath:function(path,data){path.setLatLng(_convertToLeafletLatLng(data.latlngs)),isDefined(data.radius)&&path.setRadius(data.radius),_updatePathOptions(path,data)}}},_getPathData=function(path){var pathData={};return path.latlngs&&(pathData.latlngs=path.latlngs),path.radius&&(pathData.radius=path.radius),pathData};return{setPathOptions:function(leafletPath,pathType,data){isDefined(pathType)||(pathType="polyline"),pathTypes[pathType].setPath(leafletPath,data)},createPath:function(name,path,defaults){isDefined(path.type)||(path.type="polyline");var options=_getOptions(path,defaults),pathData=_getPathData(path);return pathTypes[path.type].isValid(pathData)?pathTypes[path.type].createPath(options):void $log.error("[AngularJS - Leaflet] Invalid data passed to the "+path.type+" path")}}}]),angular.module("leaflet-directive").service("leafletWatchHelpers",function(){var _maybe=function(scope,watchFunctionName,thingToWatchStr,watchOptions,initCb){var unWatch=scope[watchFunctionName](thingToWatchStr,function(newValue,oldValue){initCb(newValue,oldValue),watchOptions.doWatch||unWatch()},watchOptions.isDeep);return unWatch},_maybeWatch=function(scope,thingToWatchStr,watchOptions,initCb){return _maybe(scope,"$watch",thingToWatchStr,watchOptions,initCb)},_maybeWatchCollection=function(scope,thingToWatchStr,watchOptions,initCb){return _maybe(scope,"$watchCollection",thingToWatchStr,watchOptions,initCb)};return{maybeWatch:_maybeWatch,maybeWatchCollection:_maybeWatchCollection}}),angular.module("leaflet-directive").service("leafletLogger",["nemSimpleLogger",function(nemSimpleLogger){return nemSimpleLogger.spawn()}]),angular.module("leaflet-directive").factory("nominatimService",["$q","$http","leafletHelpers","leafletMapDefaults",function($q,$http,leafletHelpers,leafletMapDefaults){var isDefined=leafletHelpers.isDefined;return{query:function(address,mapId){var defaults=leafletMapDefaults.getDefaults(mapId),url=defaults.nominatim.server,df=$q.defer();return $http.get(url,{params:{format:"json",limit:1,q:address}}).success(function(data){data.length>0&&isDefined(data[0].boundingbox)?df.resolve(data[0]):df.reject("[Nominatim] Invalid address")}),df.promise}}}]),angular.module("leaflet-directive").directive("bounds",["leafletLogger","$timeout","$http","leafletHelpers","nominatimService","leafletBoundsHelpers",function(leafletLogger,$timeout,$http,leafletHelpers,nominatimService,leafletBoundsHelpers){var $log=leafletLogger;return{restrict:"A",scope:!1,replace:!1,require:["leaflet"],link:function(scope,element,attrs,controller){var isDefined=leafletHelpers.isDefined,createLeafletBounds=leafletBoundsHelpers.createLeafletBounds,leafletScope=controller[0].getLeafletScope(),mapController=controller[0],errorHeader=leafletHelpers.errorHeader+" [Bounds] ",emptyBounds=function(bounds){return 0===bounds._southWest.lat&&0===bounds._southWest.lng&&0===bounds._northEast.lat&&0===bounds._northEast.lng};mapController.getMap().then(function(map){leafletScope.$on("boundsChanged",function(event){var scope=event.currentScope,bounds=map.getBounds();if(!emptyBounds(bounds)&&!scope.settingBoundsFromScope){scope.settingBoundsFromLeaflet=!0;var newScopeBounds={northEast:{lat:bounds._northEast.lat,lng:bounds._northEast.lng},southWest:{lat:bounds._southWest.lat,lng:bounds._southWest.lng},options:bounds.options};angular.equals(scope.bounds,newScopeBounds)||(scope.bounds=newScopeBounds),$timeout(function(){scope.settingBoundsFromLeaflet=!1})}});var lastNominatimQuery;leafletScope.$watch("bounds",function(bounds){if(!scope.settingBoundsFromLeaflet){if(isDefined(bounds.address)&&bounds.address!==lastNominatimQuery)return scope.settingBoundsFromScope=!0,nominatimService.query(bounds.address,attrs.id).then(function(data){var b=data.boundingbox,newBounds=[[b[0],b[2]],[b[1],b[3]]];map.fitBounds(newBounds)},function(errMsg){$log.error(errorHeader+" "+errMsg+".")}),lastNominatimQuery=bounds.address,void $timeout(function(){scope.settingBoundsFromScope=!1});var leafletBounds=createLeafletBounds(bounds);leafletBounds&&!map.getBounds().equals(leafletBounds)&&(scope.settingBoundsFromScope=!0,map.fitBounds(leafletBounds,bounds.options),$timeout(function(){scope.settingBoundsFromScope=!1}))}},!0)})}}}]);var centerDirectiveTypes=["center","lfCenter"],centerDirectives={};centerDirectiveTypes.forEach(function(directiveName){centerDirectives[directiveName]=["leafletLogger","$q","$location","$timeout","leafletMapDefaults","leafletHelpers","leafletBoundsHelpers","leafletEvents",function(leafletLogger,$q,$location,$timeout,leafletMapDefaults,leafletHelpers,leafletBoundsHelpers,leafletEvents){var _leafletCenter,isDefined=leafletHelpers.isDefined,isNumber=leafletHelpers.isNumber,isSameCenterOnMap=leafletHelpers.isSameCenterOnMap,safeApply=leafletHelpers.safeApply,isValidCenter=leafletHelpers.isValidCenter,isValidBounds=leafletBoundsHelpers.isValidBounds,isUndefinedOrEmpty=leafletHelpers.isUndefinedOrEmpty,errorHeader=leafletHelpers.errorHeader,$log=leafletLogger,shouldInitializeMapWithBounds=function(bounds,center){return isDefined(bounds)&&isValidBounds(bounds)&&isUndefinedOrEmpty(center)};return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(){_leafletCenter=$q.defer(),this.getCenter=function(){return _leafletCenter.promise}},link:function(scope,element,attrs,controller){var leafletScope=controller.getLeafletScope(),centerModel=leafletScope[directiveName];controller.getMap().then(function(map){var defaults=leafletMapDefaults.getDefaults(attrs.id);if(-1!==attrs[directiveName].search("-"))return $log.error(errorHeader+' The "center" variable can\'t use a "-" on its key name: "'+attrs[directiveName]+'".'),void map.setView([defaults.center.lat,defaults.center.lng],defaults.center.zoom);if(shouldInitializeMapWithBounds(leafletScope.bounds,centerModel))map.fitBounds(leafletBoundsHelpers.createLeafletBounds(leafletScope.bounds),leafletScope.bounds.options),centerModel=map.getCenter(),safeApply(leafletScope,function(scope){angular.extend(scope[directiveName],{lat:map.getCenter().lat,lng:map.getCenter().lng,zoom:map.getZoom(),autoDiscover:!1})}),safeApply(leafletScope,function(scope){var mapBounds=map.getBounds();scope.bounds={northEast:{lat:mapBounds._northEast.lat,lng:mapBounds._northEast.lng},southWest:{lat:mapBounds._southWest.lat,lng:mapBounds._southWest.lng}}});else{if(!isDefined(centerModel))return $log.error(errorHeader+' The "center" property is not defined in the main scope'),void map.setView([defaults.center.lat,defaults.center.lng],defaults.center.zoom);isDefined(centerModel.lat)&&isDefined(centerModel.lng)||isDefined(centerModel.autoDiscover)||angular.copy(defaults.center,centerModel)}var urlCenterHash,mapReady;if("yes"===attrs.urlHashCenter){var extractCenterFromUrl=function(){var centerParam,search=$location.search();if(isDefined(search.c)){var cParam=search.c.split(":");3===cParam.length&&(centerParam={lat:parseFloat(cParam[0]),lng:parseFloat(cParam[1]),zoom:parseInt(cParam[2],10)})}return centerParam};urlCenterHash=extractCenterFromUrl(),leafletScope.$on("$locationChangeSuccess",function(event){var scope=event.currentScope,urlCenter=extractCenterFromUrl();isDefined(urlCenter)&&!isSameCenterOnMap(urlCenter,map)&&angular.extend(scope[directiveName],{lat:urlCenter.lat,lng:urlCenter.lng,zoom:urlCenter.zoom})})}leafletScope.$watch(directiveName,function(center){return leafletScope.settingCenterFromLeaflet?void 0:(isDefined(urlCenterHash)&&(angular.copy(urlCenterHash,center),urlCenterHash=void 0),isValidCenter(center)||center.autoDiscover===!0?center.autoDiscover===!0?(isNumber(center.zoom)||map.setView([defaults.center.lat,defaults.center.lng],defaults.center.zoom),void(isNumber(center.zoom)&&center.zoom>defaults.center.zoom?map.locate({setView:!0,maxZoom:center.zoom}):isDefined(defaults.maxZoom)?map.locate({setView:!0,maxZoom:defaults.maxZoom}):map.locate({setView:!0}))):void(mapReady&&isSameCenterOnMap(center,map)||(leafletScope.settingCenterFromScope=!0,map.setView([center.lat,center.lng],center.zoom),leafletEvents.notifyCenterChangedToBounds(leafletScope,map),$timeout(function(){leafletScope.settingCenterFromScope=!1}))):void $log.warn(errorHeader+" invalid 'center'"))},!0),map.whenReady(function(){mapReady=!0}),map.on("moveend",function(){_leafletCenter.resolve(),leafletEvents.notifyCenterUrlHashChanged(leafletScope,map,attrs,$location.search()),isSameCenterOnMap(centerModel,map)||leafletScope.settingCenterFromScope||(leafletScope.settingCenterFromLeaflet=!0,safeApply(leafletScope,function(scope){leafletScope.settingCenterFromScope||angular.extend(scope[directiveName],{lat:map.getCenter().lat,lng:map.getCenter().lng,zoom:map.getZoom(),autoDiscover:!1}),leafletEvents.notifyCenterChangedToBounds(leafletScope,map),$timeout(function(){leafletScope.settingCenterFromLeaflet=!1})}))}),centerModel.autoDiscover===!0&&map.on("locationerror",function(){$log.warn(errorHeader+" The Geolocation API is unauthorized on this page."),isValidCenter(centerModel)?(map.setView([centerModel.lat,centerModel.lng],centerModel.zoom),leafletEvents.notifyCenterChangedToBounds(leafletScope,map)):(map.setView([defaults.center.lat,defaults.center.lng],defaults.center.zoom),leafletEvents.notifyCenterChangedToBounds(leafletScope,map))})})}}}]}),centerDirectiveTypes.forEach(function(dirType){angular.module("leaflet-directive").directive(dirType,centerDirectives[dirType])}),angular.module("leaflet-directive").directive("controls",["leafletLogger","leafletHelpers","leafletControlHelpers",function(leafletLogger,leafletHelpers,leafletControlHelpers){var $log=leafletLogger;return{restrict:"A",scope:!1,replace:!1,require:"?^leaflet",link:function(scope,element,attrs,controller){if(controller){var createControl=leafletControlHelpers.createControl,isValidControlType=leafletControlHelpers.isValidControlType,leafletScope=controller.getLeafletScope(),isDefined=leafletHelpers.isDefined,isArray=leafletHelpers.isArray,leafletControls={},errorHeader=leafletHelpers.errorHeader+" [Controls] ";controller.getMap().then(function(map){leafletScope.$watchCollection("controls",function(newControls){for(var name in leafletControls)isDefined(newControls[name])||(map.hasControl(leafletControls[name])&&map.removeControl(leafletControls[name]),delete leafletControls[name]);for(var newName in newControls){var control,controlType=isDefined(newControls[newName].type)?newControls[newName].type:newName;if(!isValidControlType(controlType))return void $log.error(errorHeader+" Invalid control type: "+controlType+".");if("custom"!==controlType)control=createControl(controlType,newControls[newName]),map.addControl(control),leafletControls[newName]=control;else{var customControlValue=newControls[newName];if(isArray(customControlValue))for(var i in customControlValue){var customControl=customControlValue[i];map.addControl(customControl),leafletControls[newName]=isDefined(leafletControls[newName])?leafletControls[newName].concat([customControl]):[customControl]}else map.addControl(customControlValue),leafletControls[newName]=customControlValue}}})})}}}}]),angular.module("leaflet-directive").directive("decorations",["leafletLogger","leafletHelpers",function(leafletLogger,leafletHelpers){var $log=leafletLogger;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(scope,element,attrs,controller){function createDecoration(options){return isDefined(options)&&isDefined(options.coordinates)&&(PolylineDecoratorPlugin.isLoaded()||$log.error("[AngularJS - Leaflet] The PolylineDecorator Plugin is not loaded.")),L.polylineDecorator(options.coordinates)}function setDecorationOptions(decoration,options){return isDefined(decoration)&&isDefined(options)&&isDefined(options.coordinates)&&isDefined(options.patterns)?(decoration.setPaths(options.coordinates),decoration.setPatterns(options.patterns),decoration):void 0}var leafletScope=controller.getLeafletScope(),PolylineDecoratorPlugin=leafletHelpers.PolylineDecoratorPlugin,isDefined=leafletHelpers.isDefined,leafletDecorations={};controller.getMap().then(function(map){leafletScope.$watch("decorations",function(newDecorations){for(var name in leafletDecorations)isDefined(newDecorations[name])&&angular.equals(newDecorations[name],leafletDecorations)||(map.removeLayer(leafletDecorations[name]),delete leafletDecorations[name]);for(var newName in newDecorations){var decorationData=newDecorations[newName],newDecoration=createDecoration(decorationData);isDefined(newDecoration)&&(leafletDecorations[newName]=newDecoration,map.addLayer(newDecoration),setDecorationOptions(newDecoration,decorationData))}},!0)})}}}]),angular.module("leaflet-directive").directive("eventBroadcast",["leafletLogger","$rootScope","leafletHelpers","leafletEvents","leafletIterators",function(leafletLogger,$rootScope,leafletHelpers,leafletEvents,leafletIterators){var $log=leafletLogger;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(scope,element,attrs,controller){var isObject=leafletHelpers.isObject,isDefined=leafletHelpers.isDefined,leafletScope=controller.getLeafletScope(),eventBroadcast=leafletScope.eventBroadcast,availableMapEvents=leafletEvents.getAvailableMapEvents(),addEvents=leafletEvents.addEvents;
controller.getMap().then(function(map){var mapEvents=[],logic="broadcast";isDefined(eventBroadcast.map)?isObject(eventBroadcast.map)?("emit"!==eventBroadcast.map.logic&&"broadcast"!==eventBroadcast.map.logic?$log.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):logic=eventBroadcast.map.logic,isObject(eventBroadcast.map.enable)&&eventBroadcast.map.enable.length>=0?leafletIterators.each(eventBroadcast.map.enable,function(eventName){-1===mapEvents.indexOf(eventName)&&-1!==availableMapEvents.indexOf(eventName)&&mapEvents.push(eventName)}):$log.warn("[AngularJS - Leaflet] event-broadcast.map.enable must be an object check your model.")):$log.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model."):mapEvents=availableMapEvents,addEvents(map,mapEvents,"eventName",leafletScope,logic)})}}}]),angular.module("leaflet-directive").directive("geojson",["leafletLogger","$rootScope","leafletData","leafletHelpers","leafletWatchHelpers","leafletDirectiveControlsHelpers","leafletIterators","leafletGeoJsonEvents",function(leafletLogger,$rootScope,leafletData,leafletHelpers,leafletWatchHelpers,leafletDirectiveControlsHelpers,leafletIterators,leafletGeoJsonEvents){var _maybeWatch=leafletWatchHelpers.maybeWatch,_watchOptions=leafletHelpers.watchOptions,_extendDirectiveControls=leafletDirectiveControlsHelpers.extend,hlp=leafletHelpers,$it=leafletIterators;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(scope,element,attrs,controller){var isDefined=leafletHelpers.isDefined,leafletScope=controller.getLeafletScope(),leafletGeoJSON={},_hasSetLeafletData=!1;controller.getMap().then(function(map){var watchOptions=leafletScope.geojsonWatchOptions||_watchOptions,_hookUpEvents=function(geojson,maybeName){var onEachFeature;return onEachFeature=angular.isFunction(geojson.onEachFeature)?geojson.onEachFeature:function(feature,layer){leafletHelpers.LabelPlugin.isLoaded()&&isDefined(feature.properties.description)&&layer.bindLabel(feature.properties.description),leafletGeoJsonEvents.bindEvents(layer,null,feature,leafletScope,maybeName,{resetStyleOnMouseout:geojson.resetStyleOnMouseout,mapId:attrs.id})}},isNested=hlp.isDefined(attrs.geojsonNested)&&hlp.isTruthy(attrs.geojsonNested),_clean=function(){if(leafletGeoJSON){var _remove=function(lObject){isDefined(lObject)&&map.hasLayer(lObject)&&map.removeLayer(lObject)};return isNested?void $it.each(leafletGeoJSON,function(lObject){_remove(lObject)}):void _remove(leafletGeoJSON)}},_addGeojson=function(model,maybeName){var geojson=angular.copy(model);if(isDefined(geojson)&&isDefined(geojson.data)){var onEachFeature=_hookUpEvents(geojson,maybeName);isDefined(geojson.options)||(geojson.options={style:geojson.style,filter:geojson.filter,onEachFeature:onEachFeature,pointToLayer:geojson.pointToLayer});var lObject=L.geoJson(geojson.data,geojson.options);maybeName&&hlp.isString(maybeName)?leafletGeoJSON[maybeName]=lObject:leafletGeoJSON=lObject,lObject.addTo(map),_hasSetLeafletData||(_hasSetLeafletData=!0,leafletData.setGeoJSON(leafletGeoJSON,attrs.id))}},_create=function(model){if(_clean(),isNested){if(!model||!Object.keys(model).length)return;return void $it.each(model,function(m,name){_addGeojson(m,name)})}_addGeojson(model)};_extendDirectiveControls(attrs.id,"geojson",_create,_clean),_maybeWatch(leafletScope,"geojson",watchOptions,function(geojson){_create(geojson)})})}}}]),angular.module("leaflet-directive").directive("layercontrol",["$filter","leafletLogger","leafletData","leafletHelpers",function($filter,leafletLogger,leafletData,leafletHelpers){var $log=leafletLogger;return{restrict:"E",scope:{icons:"=?",autoHideOpacity:"=?",showGroups:"=?",title:"@",baseTitle:"@",overlaysTitle:"@"},replace:!0,transclude:!1,require:"^leaflet",controller:["$scope","$element","$sce",function($scope,$element,$sce){$log.debug("[Angular Directive - Layers] layers",$scope,$element);var safeApply=leafletHelpers.safeApply,isDefined=leafletHelpers.isDefined;angular.extend($scope,{baselayer:"",oldGroup:"",layerProperties:{},groupProperties:{},rangeIsSupported:leafletHelpers.rangeIsSupported(),changeBaseLayer:function(key,e){leafletHelpers.safeApply($scope,function(scp){scp.baselayer=key,leafletData.getMap().then(function(map){leafletData.getLayers().then(function(leafletLayers){if(!map.hasLayer(leafletLayers.baselayers[key])){for(var i in scp.layers.baselayers)scp.layers.baselayers[i].icon=scp.icons.unradio,map.hasLayer(leafletLayers.baselayers[i])&&map.removeLayer(leafletLayers.baselayers[i]);map.addLayer(leafletLayers.baselayers[key]),scp.layers.baselayers[key].icon=$scope.icons.radio}})})}),e.preventDefault()},moveLayer:function(ly,newIndex,e){var delta=Object.keys($scope.layers.baselayers).length;if(newIndex>=1+delta&&newIndex<=$scope.overlaysArray.length+delta){var oldLy;for(var key in $scope.layers.overlays)if($scope.layers.overlays[key].index===newIndex){oldLy=$scope.layers.overlays[key];break}oldLy&&safeApply($scope,function(){oldLy.index=ly.index,ly.index=newIndex})}e.stopPropagation(),e.preventDefault()},initIndex:function(layer,idx){var delta=Object.keys($scope.layers.baselayers).length;layer.index=isDefined(layer.index)?layer.index:idx+delta+1},initGroup:function(groupName){$scope.groupProperties[groupName]=$scope.groupProperties[groupName]?$scope.groupProperties[groupName]:{}},toggleOpacity:function(e,layer){if(layer.visible){if($scope.autoHideOpacity&&!$scope.layerProperties[layer.name].opacityControl)for(var k in $scope.layerProperties)$scope.layerProperties[k].opacityControl=!1;$scope.layerProperties[layer.name].opacityControl=!$scope.layerProperties[layer.name].opacityControl}e.stopPropagation(),e.preventDefault()},toggleLegend:function(layer){$scope.layerProperties[layer.name].showLegend=!$scope.layerProperties[layer.name].showLegend},showLegend:function(layer){return layer.legend&&$scope.layerProperties[layer.name].showLegend},unsafeHTML:function(html){return $sce.trustAsHtml(html)},getOpacityIcon:function(layer){return layer.visible&&$scope.layerProperties[layer.name].opacityControl?$scope.icons.close:$scope.icons.open},getGroupIcon:function(group){return group.visible?$scope.icons.check:$scope.icons.uncheck},changeOpacity:function(layer){var op=$scope.layerProperties[layer.name].opacity;leafletData.getMap().then(function(map){leafletData.getLayers().then(function(leafletLayers){var ly;for(var k in $scope.layers.overlays)if($scope.layers.overlays[k]===layer){ly=leafletLayers.overlays[k];break}map.hasLayer(ly)&&(ly.setOpacity&&ly.setOpacity(op/100),ly.getLayers&&ly.eachLayer&&ly.eachLayer(function(lay){lay.setOpacity&&lay.setOpacity(op/100)}))})})},changeGroupVisibility:function(groupName){if(isDefined($scope.groupProperties[groupName])){var visible=$scope.groupProperties[groupName].visible;for(var k in $scope.layers.overlays){var layer=$scope.layers.overlays[k];layer.group===groupName&&(layer.visible=visible)}}}});var div=$element.get(0);L.Browser.touch?L.DomEvent.on(div,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(div),L.DomEvent.on(div,"mousewheel",L.DomEvent.stopPropagation))}],template:'<div class="angular-leaflet-control-layers" ng-show="overlaysArray.length"><h4 ng-if="title">{{ title }}</h4><div class="lf-baselayers"><h5 class="lf-title" ng-if="baseTitle">{{ baseTitle }}</h5><div class="lf-row" ng-repeat="(key, layer) in baselayersArray"><label class="lf-icon-bl" ng-click="changeBaseLayer(key, $event)"><input class="leaflet-control-layers-selector" type="radio" name="lf-radio" ng-show="false" ng-checked="baselayer === key" ng-value="key" /> <i class="lf-icon lf-icon-radio" ng-class="layer.icon"></i><div class="lf-text">{{layer.name}}</div></label></div></div><div class="lf-overlays"><h5 class="lf-title" ng-if="overlaysTitle">{{ overlaysTitle }}</h5><div class="lf-container"><div class="lf-row" ng-repeat="layer in (o = (overlaysArray | orderBy:\'index\':order))" ng-init="initIndex(layer, $index)"><label class="lf-icon-ol-group" ng-if="showGroups &amp;&amp; layer.group &amp;&amp; layer.group != o[$index-1].group"><input class="lf-control-layers-selector" type="checkbox" ng-show="false" ng-change="changeGroupVisibility(layer.group)" ng-model="groupProperties[layer.group].visible"/> <i class="lf-icon lf-icon-check" ng-class="getGroupIcon(groupProperties[layer.group])"></i><div class="lf-text">{{ layer.group }}</div></label><label class="lf-icon-ol"><input class="lf-control-layers-selector" type="checkbox" ng-show="false" ng-model="layer.visible"/> <i class="lf-icon lf-icon-check" ng-class="layer.icon"></i><div class="lf-text">{{layer.name}}</div></label><div class="lf-icons"><i class="lf-icon lf-up" ng-class="icons.up" ng-click="moveLayer(layer, layer.index - orderNumber, $event)"></i> <i class="lf-icon lf-down" ng-class="icons.down" ng-click="moveLayer(layer, layer.index + orderNumber, $event)"></i> <i class="lf-icon lf-toggle-legend" ng-class="icons.toggleLegend" ng-if="layer.legend" ng-click="toggleLegend(layer)"></i> <i class="lf-icon lf-open" ng-class="getOpacityIcon(layer)" ng-click="toggleOpacity($event, layer)"></i></div><div class="lf-legend" ng-if="showLegend(layer)" ng-bind-html="unsafeHTML(layer.legend)"></div><div class="lf-opacity clearfix" ng-if="layer.visible &amp;&amp; layerProperties[layer.name].opacityControl"><label ng-if="rangeIsSupported" class="pull-left" style="width: 50%">0</label><label ng-if="rangeIsSupported" class="pull-left text-right" style="width: 50%">100</label><input ng-if="rangeIsSupported" class="clearfix" type="range" min="0" max="100" class="lf-opacity-control" ng-model="layerProperties[layer.name].opacity" ng-change="changeOpacity(layer)"/><h6 ng-if="!rangeIsSupported">Range is not supported in this browser</h6></div></div></div></div></div>',link:function(scope,element,attrs,controller){var isDefined=leafletHelpers.isDefined,leafletScope=controller.getLeafletScope(),layers=leafletScope.layers;scope.$watch("icons",function(){var defaultIcons={uncheck:"fa fa-square-o",check:"fa fa-check-square-o",radio:"fa fa-dot-circle-o",unradio:"fa fa-circle-o",up:"fa fa-angle-up",down:"fa fa-angle-down",open:"fa fa-angle-double-down",close:"fa fa-angle-double-up",toggleLegend:"fa fa-pencil-square-o"};isDefined(scope.icons)?(angular.extend(defaultIcons,scope.icons),angular.extend(scope.icons,defaultIcons)):scope.icons=defaultIcons}),attrs.order=!isDefined(attrs.order)||"normal"!==attrs.order&&"reverse"!==attrs.order?"normal":attrs.order,scope.order="normal"===attrs.order,scope.orderNumber="normal"===attrs.order?-1:1,scope.layers=layers,controller.getMap().then(function(map){leafletScope.$watch("layers.baselayers",function(newBaseLayers){var baselayersArray={};leafletData.getLayers().then(function(leafletLayers){var key;for(key in newBaseLayers){var layer=newBaseLayers[key];layer.icon=scope.icons[map.hasLayer(leafletLayers.baselayers[key])?"radio":"unradio"],baselayersArray[key]=layer}scope.baselayersArray=baselayersArray})}),leafletScope.$watch("layers.overlays",function(newOverlayLayers){var overlaysArray=[],groupVisibleCount={};leafletData.getLayers().then(function(leafletLayers){var key;for(key in newOverlayLayers){var layer=newOverlayLayers[key];layer.icon=scope.icons[layer.visible?"check":"uncheck"],overlaysArray.push(layer),isDefined(scope.layerProperties[layer.name])||(scope.layerProperties[layer.name]={opacity:isDefined(layer.layerOptions.opacity)?100*layer.layerOptions.opacity:100,opacityControl:!1,showLegend:!0}),isDefined(layer.group)&&(isDefined(scope.groupProperties[layer.group])||(scope.groupProperties[layer.group]={visible:!1}),groupVisibleCount[layer.group]=isDefined(groupVisibleCount[layer.group])?groupVisibleCount[layer.group]:{count:0,visibles:0},groupVisibleCount[layer.group].count++,layer.visible&&groupVisibleCount[layer.group].visibles++),isDefined(layer.index)&&leafletLayers.overlays[key].setZIndex&&leafletLayers.overlays[key].setZIndex(newOverlayLayers[key].index)}for(key in groupVisibleCount)scope.groupProperties[key].visible=groupVisibleCount[key].visibles===groupVisibleCount[key].count;scope.overlaysArray=overlaysArray})},!0)})}}}]),angular.module("leaflet-directive").directive("layers",["leafletLogger","$q","leafletData","leafletHelpers","leafletLayerHelpers","leafletControlHelpers",function(leafletLogger,$q,leafletData,leafletHelpers,leafletLayerHelpers,leafletControlHelpers){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:["$scope",function($scope){$scope._leafletLayers=$q.defer(),this.getLayers=function(){return $scope._leafletLayers.promise}}],link:function(scope,element,attrs,controller){var isDefined=leafletHelpers.isDefined,leafletLayers={},leafletScope=controller.getLeafletScope(),layers=leafletScope.layers,createLayer=leafletLayerHelpers.createLayer,safeAddLayer=leafletLayerHelpers.safeAddLayer,safeRemoveLayer=leafletLayerHelpers.safeRemoveLayer,updateLayersControl=leafletControlHelpers.updateLayersControl,isLayersControlVisible=!1;controller.getMap().then(function(map){scope._leafletLayers.resolve(leafletLayers),leafletData.setLayers(leafletLayers,attrs.id),leafletLayers.baselayers={},leafletLayers.overlays={};var mapId=attrs.id,oneVisibleLayer=!1;for(var layerName in layers.baselayers){var newBaseLayer=createLayer(layers.baselayers[layerName]);isDefined(newBaseLayer)?(leafletLayers.baselayers[layerName]=newBaseLayer,layers.baselayers[layerName].top===!0&&(safeAddLayer(map,leafletLayers.baselayers[layerName]),oneVisibleLayer=!0)):delete layers.baselayers[layerName]}!oneVisibleLayer&&Object.keys(leafletLayers.baselayers).length>0&&safeAddLayer(map,leafletLayers.baselayers[Object.keys(layers.baselayers)[0]]);for(layerName in layers.overlays){"cartodb"===layers.overlays[layerName].type;var newOverlayLayer=createLayer(layers.overlays[layerName]);isDefined(newOverlayLayer)?(leafletLayers.overlays[layerName]=newOverlayLayer,layers.overlays[layerName].visible===!0&&safeAddLayer(map,leafletLayers.overlays[layerName])):delete layers.overlays[layerName]}leafletScope.$watch("layers.baselayers",function(newBaseLayers,oldBaseLayers){if(angular.equals(newBaseLayers,oldBaseLayers))return isLayersControlVisible=updateLayersControl(map,mapId,isLayersControlVisible,newBaseLayers,layers.overlays,leafletLayers),!0;for(var name in leafletLayers.baselayers)(!isDefined(newBaseLayers[name])||newBaseLayers[name].doRefresh)&&(map.hasLayer(leafletLayers.baselayers[name])&&map.removeLayer(leafletLayers.baselayers[name]),delete leafletLayers.baselayers[name],newBaseLayers[name]&&newBaseLayers[name].doRefresh&&(newBaseLayers[name].doRefresh=!1));for(var newName in newBaseLayers)if(isDefined(leafletLayers.baselayers[newName]))newBaseLayers[newName].top!==!0||map.hasLayer(leafletLayers.baselayers[newName])?newBaseLayers[newName].top===!1&&map.hasLayer(leafletLayers.baselayers[newName])&&map.removeLayer(leafletLayers.baselayers[newName]):safeAddLayer(map,leafletLayers.baselayers[newName]);else{var testBaseLayer=createLayer(newBaseLayers[newName]);isDefined(testBaseLayer)&&(leafletLayers.baselayers[newName]=testBaseLayer,newBaseLayers[newName].top===!0&&safeAddLayer(map,leafletLayers.baselayers[newName]))}var found=!1;for(var key in leafletLayers.baselayers)if(map.hasLayer(leafletLayers.baselayers[key])){found=!0;break}!found&&Object.keys(leafletLayers.baselayers).length>0&&safeAddLayer(map,leafletLayers.baselayers[Object.keys(leafletLayers.baselayers)[0]]),isLayersControlVisible=updateLayersControl(map,mapId,isLayersControlVisible,newBaseLayers,layers.overlays,leafletLayers)},!0),leafletScope.$watch("layers.overlays",function(newOverlayLayers,oldOverlayLayers){if(angular.equals(newOverlayLayers,oldOverlayLayers))return isLayersControlVisible=updateLayersControl(map,mapId,isLayersControlVisible,layers.baselayers,newOverlayLayers,leafletLayers),!0;for(var name in leafletLayers.overlays)(!isDefined(newOverlayLayers[name])||newOverlayLayers[name].doRefresh)&&(map.hasLayer(leafletLayers.overlays[name])&&safeRemoveLayer(map,leafletLayers.overlays[name],newOverlayLayers[name].layerOptions),delete leafletLayers.overlays[name],newOverlayLayers[name]&&newOverlayLayers[name].doRefresh&&(newOverlayLayers[name].doRefresh=!1));for(var newName in newOverlayLayers){if(isDefined(leafletLayers.overlays[newName]))newOverlayLayers[newName].visible&&!map.hasLayer(leafletLayers.overlays[newName])?safeAddLayer(map,leafletLayers.overlays[newName]):newOverlayLayers[newName].visible===!1&&map.hasLayer(leafletLayers.overlays[newName])&&safeRemoveLayer(map,leafletLayers.overlays[newName],newOverlayLayers[newName].layerOptions);else{var testOverlayLayer=createLayer(newOverlayLayers[newName]);if(!isDefined(testOverlayLayer))continue;leafletLayers.overlays[newName]=testOverlayLayer,newOverlayLayers[newName].visible===!0&&safeAddLayer(map,leafletLayers.overlays[newName])}newOverlayLayers[newName].visible&&map._loaded&&newOverlayLayers[newName].data&&"heatmap"===newOverlayLayers[newName].type&&(leafletLayers.overlays[newName].setData(newOverlayLayers[newName].data),leafletLayers.overlays[newName].update())}isLayersControlVisible=updateLayersControl(map,mapId,isLayersControlVisible,layers.baselayers,newOverlayLayers,leafletLayers)},!0)})}}}]),angular.module("leaflet-directive").directive("legend",["leafletLogger","$http","leafletHelpers","leafletLegendHelpers",function(leafletLogger,$http,leafletHelpers,leafletLegendHelpers){var $log=leafletLogger;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(scope,element,attrs,controller){var legendClass,position,leafletLegend,type,isArray=leafletHelpers.isArray,isDefined=leafletHelpers.isDefined,isFunction=leafletHelpers.isFunction,leafletScope=controller.getLeafletScope(),legend=leafletScope.legend;leafletScope.$watch("legend",function(newLegend){isDefined(newLegend)&&(legendClass=newLegend.legendClass?newLegend.legendClass:"legend",position=newLegend.position||"bottomright",type=newLegend.type||"arcgis")},!0),controller.getMap().then(function(map){leafletScope.$watch("legend",function(newLegend){return isDefined(newLegend)?isDefined(newLegend.url)||"arcgis"!==type||isArray(newLegend.colors)&&isArray(newLegend.labels)&&newLegend.colors.length===newLegend.labels.length?isDefined(newLegend.url)?void $log.info("[AngularJS - Leaflet] loading legend service."):(isDefined(leafletLegend)&&(leafletLegend.removeFrom(map),leafletLegend=null),leafletLegend=L.control({position:position}),"arcgis"===type&&(leafletLegend.onAdd=leafletLegendHelpers.getOnAddArrayLegend(newLegend,legendClass)),void leafletLegend.addTo(map)):void $log.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set."):void(isDefined(leafletLegend)&&(leafletLegend.removeFrom(map),leafletLegend=null))}),leafletScope.$watch("legend.url",function(newURL){isDefined(newURL)&&$http.get(newURL).success(function(legendData){isDefined(leafletLegend)?leafletLegendHelpers.updateLegend(leafletLegend.getContainer(),legendData,type,newURL):(leafletLegend=L.control({position:position}),leafletLegend.onAdd=leafletLegendHelpers.getOnAddLegend(legendData,legendClass,type,newURL),leafletLegend.addTo(map)),isDefined(legend.loadedData)&&isFunction(legend.loadedData)&&legend.loadedData()}).error(function(){$log.warn("[AngularJS - Leaflet] legend.url not loaded.")})})})}}}]),angular.module("leaflet-directive").directive("markers",["leafletLogger","$rootScope","$q","leafletData","leafletHelpers","leafletMapDefaults","leafletMarkersHelpers","leafletMarkerEvents","leafletIterators","leafletWatchHelpers","leafletDirectiveControlsHelpers",function(leafletLogger,$rootScope,$q,leafletData,leafletHelpers,leafletMapDefaults,leafletMarkersHelpers,leafletMarkerEvents,leafletIterators,leafletWatchHelpers,leafletDirectiveControlsHelpers){var isDefined=leafletHelpers.isDefined,errorHeader=leafletHelpers.errorHeader,Helpers=leafletHelpers,isString=leafletHelpers.isString,addMarkerWatcher=leafletMarkersHelpers.addMarkerWatcher,updateMarker=leafletMarkersHelpers.updateMarker,listenMarkerEvents=leafletMarkersHelpers.listenMarkerEvents,addMarkerToGroup=leafletMarkersHelpers.addMarkerToGroup,createMarker=leafletMarkersHelpers.createMarker,deleteMarker=leafletMarkersHelpers.deleteMarker,$it=leafletIterators,_markersWatchOptions=leafletHelpers.watchOptions,maybeWatch=leafletWatchHelpers.maybeWatch,extendDirectiveControls=leafletDirectiveControlsHelpers.extend,$log=leafletLogger,_getLMarker=function(leafletMarkers,name,maybeLayerName){if(Object.keys(leafletMarkers).length){if(maybeLayerName&&isString(maybeLayerName)){if(!leafletMarkers[maybeLayerName]||!Object.keys(leafletMarkers[maybeLayerName]).length)return;return leafletMarkers[maybeLayerName][name]}return leafletMarkers[name]}},_setLMarker=function(lObject,leafletMarkers,name,maybeLayerName){return maybeLayerName&&isString(maybeLayerName)?(isDefined(leafletMarkers[maybeLayerName])||(leafletMarkers[maybeLayerName]={}),leafletMarkers[maybeLayerName][name]=lObject):leafletMarkers[name]=lObject,lObject},_maybeAddMarkerToLayer=function(layerName,layers,model,marker,doIndividualWatch,map){if(!isString(layerName))return $log.error(errorHeader+" A layername must be a string"),!1;if(!isDefined(layers))return $log.error(errorHeader+" You must add layers to the directive if the markers are going to use this functionality."),!1;if(!isDefined(layers.overlays)||!isDefined(layers.overlays[layerName]))return $log.error(errorHeader+' A marker can only be added to a layer of type "group"'),!1;var layerGroup=layers.overlays[layerName];return layerGroup instanceof L.LayerGroup||layerGroup instanceof L.FeatureGroup?(layerGroup.addLayer(marker),!doIndividualWatch&&map.hasLayer(marker)&&model.focus===!0&&marker.openPopup(),!0):($log.error(errorHeader+' Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"'),!1)},_addMarkers=function(markersToRender,oldModels,map,layers,leafletMarkers,leafletScope,watchOptions,maybeLayerName,skips){for(var newName in markersToRender)if(!skips[newName])if(-1===newName.search("-")){var model=Helpers.copy(markersToRender[newName]),pathToMarker=Helpers.getObjectDotPath(maybeLayerName?[maybeLayerName,newName]:[newName]),maybeLMarker=_getLMarker(leafletMarkers,newName,maybeLayerName);if(isDefined(maybeLMarker)){var oldModel=isDefined(oldModel)?oldModels[newName]:void 0;updateMarker(model,oldModel,maybeLMarker,pathToMarker,leafletScope,layers,map)}else{var marker=createMarker(model),layerName=(model?model.layer:void 0)||maybeLayerName;if(!isDefined(marker)){$log.error(errorHeader+" Received invalid data on the marker "+newName+".");continue}if(_setLMarker(marker,leafletMarkers,newName,maybeLayerName),isDefined(model.message)&&marker.bindPopup(model.message,model.popupOptions),isDefined(model.group)){var groupOptions=isDefined(model.groupOption)?model.groupOption:null;addMarkerToGroup(marker,model.group,groupOptions,map)}if(Helpers.LabelPlugin.isLoaded()&&isDefined(model.label)&&isDefined(model.label.message)&&marker.bindLabel(model.label.message,model.label.options),isDefined(model)&&(isDefined(model.layer)||isDefined(maybeLayerName))){var pass=_maybeAddMarkerToLayer(layerName,layers,model,marker,watchOptions.individual.doWatch,map);if(!pass)continue}else isDefined(model.group)||(map.addLayer(marker),watchOptions.individual.doWatch||model.focus!==!0||marker.openPopup());watchOptions.individual.doWatch&&addMarkerWatcher(marker,pathToMarker,leafletScope,layers,map,watchOptions.individual.isDeep),listenMarkerEvents(marker,model,leafletScope,watchOptions.individual.doWatch,map),leafletMarkerEvents.bindEvents(marker,pathToMarker,model,leafletScope,layerName)}}else $log.error('The marker can\'t use a "-" on his key name: "'+newName+'".')},_seeWhatWeAlreadyHave=function(markerModels,oldMarkerModels,lMarkers,isEqual,cb){var oldMarker,newMarker,hasLogged=!1,equals=!1,doCheckOldModel=isDefined(oldMarkerModels);for(var name in lMarkers)hasLogged||($log.debug(errorHeader+"[markers] destroy: "),hasLogged=!0),doCheckOldModel&&(newMarker=markerModels[name],oldMarker=oldMarkerModels[name],equals=angular.equals(newMarker,oldMarker)&&isEqual),isDefined(markerModels)&&Object.keys(markerModels).length&&isDefined(markerModels[name])&&Object.keys(markerModels[name]).length&&!equals||cb&&Helpers.isFunction(cb)&&cb(newMarker,oldMarker,name)},_destroy=function(markerModels,oldMarkerModels,lMarkers,map,layers){_seeWhatWeAlreadyHave(markerModels,oldMarkerModels,lMarkers,!1,function(newMarker,oldMarker,lMarkerName){$log.debug(errorHeader+"[marker] is deleting marker: "+lMarkerName),deleteMarker(lMarkers[lMarkerName],map,layers),delete lMarkers[lMarkerName]})},_getNewModelsToSkipp=function(newModels,oldModels,lMarkers){var skips={};return _seeWhatWeAlreadyHave(newModels,oldModels,lMarkers,!0,function(newMarker,oldMarker,lMarkerName){$log.debug(errorHeader+"[marker] is already rendered, marker: "+lMarkerName),skips[lMarkerName]=newMarker}),skips};return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(scope,element,attrs,controller){var mapController=controller[0],leafletScope=mapController.getLeafletScope();mapController.getMap().then(function(map){var getLayers,leafletMarkers={};getLayers=isDefined(controller[1])?controller[1].getLayers:function(){var deferred=$q.defer();return deferred.resolve(),deferred.promise};var watchOptions=leafletScope.markersWatchOptions||_markersWatchOptions;isDefined(attrs.watchMarkers)&&(watchOptions.doWatch=watchOptions.individual.doWatch=!isDefined(attrs.watchMarkers)||Helpers.isTruthy(attrs.watchMarkers));var isNested=isDefined(attrs.markersNested)&&Helpers.isTruthy(attrs.markersNested);getLayers().then(function(layers){var _clean=function(models,oldModels){return isNested?void $it.each(models,function(markerToMaybeDel,layerName){var oldModel=isDefined(oldModel)?oldModels[layerName]:void 0;_destroy(markerToMaybeDel,oldModel,leafletMarkers[layerName],map,layers)}):void _destroy(models,oldModels,leafletMarkers,map,layers)},_create=function(models,oldModels){_clean(models,oldModels);var skips=null;return isNested?void $it.each(models,function(markersToAdd,layerName){var oldModel=isDefined(oldModel)?oldModels[layerName]:void 0;skips=_getNewModelsToSkipp(models[layerName],oldModel,leafletMarkers[layerName]),_addMarkers(markersToAdd,oldModels,map,layers,leafletMarkers,leafletScope,watchOptions,layerName,skips)}):(skips=_getNewModelsToSkipp(models,oldModels,leafletMarkers),void _addMarkers(models,oldModels,map,layers,leafletMarkers,leafletScope,watchOptions,void 0,skips))};extendDirectiveControls(attrs.id,"markers",_create,_clean),leafletData.setMarkers(leafletMarkers,attrs.id),maybeWatch(leafletScope,"markers",watchOptions,function(newMarkers,oldMarkers){_create(newMarkers,oldMarkers)})})})}}}]),angular.module("leaflet-directive").directive("maxbounds",["leafletLogger","leafletMapDefaults","leafletBoundsHelpers","leafletHelpers",function(leafletLogger,leafletMapDefaults,leafletBoundsHelpers,leafletHelpers){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(scope,element,attrs,controller){var leafletScope=controller.getLeafletScope(),isValidBounds=leafletBoundsHelpers.isValidBounds,isNumber=leafletHelpers.isNumber;controller.getMap().then(function(map){leafletScope.$watch("maxbounds",function(maxbounds){if(!isValidBounds(maxbounds))return void map.setMaxBounds();var leafletBounds=leafletBoundsHelpers.createLeafletBounds(maxbounds);isNumber(maxbounds.pad)&&(leafletBounds=leafletBounds.pad(maxbounds.pad)),map.setMaxBounds(leafletBounds),attrs.center||attrs.lfCenter||map.fitBounds(leafletBounds)})})}}}]),angular.module("leaflet-directive").directive("paths",["leafletLogger","$q","leafletData","leafletMapDefaults","leafletHelpers","leafletPathsHelpers","leafletEvents",function(leafletLogger,$q,leafletData,leafletMapDefaults,leafletHelpers,leafletPathsHelpers,leafletEvents){var $log=leafletLogger;return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(scope,element,attrs,controller){var mapController=controller[0],isDefined=leafletHelpers.isDefined,isString=leafletHelpers.isString,leafletScope=mapController.getLeafletScope(),paths=leafletScope.paths,createPath=leafletPathsHelpers.createPath,bindPathEvents=leafletEvents.bindPathEvents,setPathOptions=leafletPathsHelpers.setPathOptions;mapController.getMap().then(function(map){var getLayers,defaults=leafletMapDefaults.getDefaults(attrs.id);getLayers=isDefined(controller[1])?controller[1].getLayers:function(){var deferred=$q.defer();return deferred.resolve(),deferred.promise},isDefined(paths)&&getLayers().then(function(layers){var leafletPaths={};leafletData.setPaths(leafletPaths,attrs.id);var shouldWatch=!isDefined(attrs.watchPaths)||"true"===attrs.watchPaths,watchPathFn=function(leafletPath,name){var clearWatch=leafletScope.$watch('paths["'+name+'"]',function(pathData,old){if(!isDefined(pathData)){if(isDefined(old.layer))for(var i in layers.overlays){var overlay=layers.overlays[i];overlay.removeLayer(leafletPath)}return map.removeLayer(leafletPath),void clearWatch()}setPathOptions(leafletPath,pathData.type,pathData)},!0)};leafletScope.$watchCollection("paths",function(newPaths){for(var name in leafletPaths)isDefined(newPaths[name])||(map.removeLayer(leafletPaths[name]),delete leafletPaths[name]);for(var newName in newPaths)if(0!==newName.search("\\$"))if(-1===newName.search("-")){if(!isDefined(leafletPaths[newName])){var pathData=newPaths[newName],newPath=createPath(newName,newPaths[newName],defaults);if(isDefined(newPath)&&isDefined(pathData.message)&&newPath.bindPopup(pathData.message,pathData.popupOptions),leafletHelpers.LabelPlugin.isLoaded()&&isDefined(pathData.label)&&isDefined(pathData.label.message)&&newPath.bindLabel(pathData.label.message,pathData.label.options),isDefined(pathData)&&isDefined(pathData.layer)){if(!isString(pathData.layer)){$log.error("[AngularJS - Leaflet] A layername must be a string");continue}if(!isDefined(layers)){$log.error("[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.");continue}if(!isDefined(layers.overlays)||!isDefined(layers.overlays[pathData.layer])){$log.error('[AngularJS - Leaflet] A path can only be added to a layer of type "group"');continue}var layerGroup=layers.overlays[pathData.layer];if(!(layerGroup instanceof L.LayerGroup||layerGroup instanceof L.FeatureGroup)){$log.error('[AngularJS - Leaflet] Adding a path to an overlay needs a overlay of the type "group" or "featureGroup"');continue}leafletPaths[newName]=newPath,layerGroup.addLayer(newPath),shouldWatch?watchPathFn(newPath,newName):setPathOptions(newPath,pathData.type,pathData)}else isDefined(newPath)&&(leafletPaths[newName]=newPath,map.addLayer(newPath),shouldWatch?watchPathFn(newPath,newName):setPathOptions(newPath,pathData.type,pathData));bindPathEvents(newPath,newName,pathData,leafletScope)}}else $log.error('[AngularJS - Leaflet] The path name "'+newName+'" is not valid. It must not include "-" and a number.')})})})}}}]),angular.module("leaflet-directive").directive("tiles",["leafletLogger","leafletData","leafletMapDefaults","leafletHelpers",function(leafletLogger,leafletData,leafletMapDefaults,leafletHelpers){var $log=leafletLogger;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(scope,element,attrs,controller){var isDefined=leafletHelpers.isDefined,leafletScope=controller.getLeafletScope(),tiles=leafletScope.tiles;return isDefined(tiles)&&isDefined(tiles.url)?void controller.getMap().then(function(map){var tileLayerObj,defaults=leafletMapDefaults.getDefaults(attrs.id);leafletScope.$watch("tiles",function(tiles){var tileLayerOptions=defaults.tileLayerOptions,tileLayerUrl=defaults.tileLayer;return!isDefined(tiles.url)&&isDefined(tileLayerObj)?void map.removeLayer(tileLayerObj):isDefined(tileLayerObj)?isDefined(tiles.url)&&isDefined(tiles.options)&&!angular.equals(tiles.options,tileLayerOptions)?(map.removeLayer(tileLayerObj),tileLayerOptions=defaults.tileLayerOptions,
angular.copy(tiles.options,tileLayerOptions),tileLayerUrl=tiles.url,tileLayerObj=L.tileLayer(tileLayerUrl,tileLayerOptions),tileLayerObj.addTo(map),void leafletData.setTiles(tileLayerObj,attrs.id)):void(isDefined(tiles.url)&&tileLayerObj.setUrl(tiles.url)):(isDefined(tiles.options)&&angular.copy(tiles.options,tileLayerOptions),isDefined(tiles.url)&&(tileLayerUrl=tiles.url),tileLayerObj=L.tileLayer(tileLayerUrl,tileLayerOptions),tileLayerObj.addTo(map),void leafletData.setTiles(tileLayerObj,attrs.id))},!0)}):void $log.warn("[AngularJS - Leaflet] The 'tiles' definition doesn't have the 'url' property.")}}}]),["markers","geojson"].forEach(function(name){angular.module("leaflet-directive").directive(name+"WatchOptions",["$log","$rootScope","$q","leafletData","leafletHelpers",function(leafletLogger,$rootScope,$q,leafletData,leafletHelpers){var isDefined=leafletHelpers.isDefined,errorHeader=leafletHelpers.errorHeader,isObject=leafletHelpers.isObject,_watchOptions=leafletHelpers.watchOptions,$log=leafletLogger;return{restrict:"A",scope:!1,replace:!1,require:["leaflet"],link:function(scope,element,attrs,controller){var mapController=controller[0],leafletScope=mapController.getLeafletScope();mapController.getMap().then(function(){isDefined(scope[name+"WatchOptions"])&&(isObject(scope[name+"WatchOptions"])?angular.extend(_watchOptions,scope[name+"WatchOptions"]):$log.error(errorHeader+"["+name+"WatchOptions] is not an object"),leafletScope[name+"WatchOptions"]=_watchOptions)})}}}])}),angular.module("leaflet-directive").factory("leafletEventsHelpersFactory",["$rootScope","$q","leafletLogger","leafletHelpers",function($rootScope,$q,leafletLogger,leafletHelpers){var safeApply=leafletHelpers.safeApply,isDefined=leafletHelpers.isDefined,isObject=leafletHelpers.isObject,isArray=leafletHelpers.isArray,errorHeader=leafletHelpers.errorHeader,$log=leafletLogger,EventsHelper=function(rootBroadcastName,lObjectType){this.rootBroadcastName=rootBroadcastName,this.lObjectType=lObjectType};return EventsHelper.prototype.getAvailableEvents=function(){return[]},EventsHelper.prototype.genDispatchEvent=function(eventName,logic,leafletScope,lObject,name,model,layerName,extra){var _this=this;return function(e){var broadcastName=_this.rootBroadcastName+"."+eventName;_this.fire(leafletScope,broadcastName,logic,e,e.target||lObject,model,name,layerName,extra)}},EventsHelper.prototype.fire=function(scope,broadcastName,logic,event,lObject,model,modelName,layerName,extra){safeApply(scope,function(){var toSend={leafletEvent:event,leafletObject:lObject,modelName:modelName,model:model};isDefined(layerName)&&angular.extend(toSend,{layerName:layerName}),"emit"===logic?scope.$emit(broadcastName,toSend):$rootScope.$broadcast(broadcastName,toSend)})},EventsHelper.prototype.bindEvents=function(lObject,name,model,leafletScope,layerName,extra){var events=[],logic="emit",_this=this;if(isDefined(leafletScope.eventBroadcast))if(isObject(leafletScope.eventBroadcast))if(isDefined(leafletScope.eventBroadcast[_this.lObjectType]))if(isObject(leafletScope.eventBroadcast[_this.lObjectType])){isDefined(leafletScope.eventBroadcast[this.lObjectType].logic)&&"emit"!==leafletScope.eventBroadcast[_this.lObjectType].logic&&"broadcast"!==leafletScope.eventBroadcast[_this.lObjectType].logic&&$log.warn(errorHeader+"Available event propagation logic are: 'emit' or 'broadcast'.");var eventsEnable=!1,eventsDisable=!1;isDefined(leafletScope.eventBroadcast[_this.lObjectType].enable)&&isArray(leafletScope.eventBroadcast[_this.lObjectType].enable)&&(eventsEnable=!0),isDefined(leafletScope.eventBroadcast[_this.lObjectType].disable)&&isArray(leafletScope.eventBroadcast[_this.lObjectType].disable)&&(eventsDisable=!0),eventsEnable&&eventsDisable?$log.warn(errorHeader+"can not enable and disable events at the same time"):eventsEnable||eventsDisable?eventsEnable?leafletScope.eventBroadcast[this.lObjectType].enable.forEach(function(eventName){-1!==events.indexOf(eventName)?$log.warn(errorHeader+"This event "+eventName+" is already enabled"):-1===_this.getAvailableEvents().indexOf(eventName)?$log.warn(errorHeader+"This event "+eventName+" does not exist"):events.push(eventName)}):(events=this.getAvailableEvents(),leafletScope.eventBroadcast[_this.lObjectType].disable.forEach(function(eventName){var index=events.indexOf(eventName);-1===index?$log.warn(errorHeader+"This event "+eventName+" does not exist or has been already disabled"):events.splice(index,1)})):$log.warn(errorHeader+"must enable or disable events")}else $log.warn(errorHeader+"event-broadcast."+[_this.lObjectType]+" must be an object check your model.");else events=this.getAvailableEvents();else $log.error(errorHeader+"event-broadcast must be an object check your model.");else events=this.getAvailableEvents();return events.forEach(function(eventName){lObject.on(eventName,_this.genDispatchEvent(eventName,logic,leafletScope,lObject,name,model,layerName,extra))}),logic},EventsHelper}]).service("leafletEventsHelpers",["leafletEventsHelpersFactory",function(leafletEventsHelpersFactory){return new leafletEventsHelpersFactory}]),angular.module("leaflet-directive").factory("leafletGeoJsonEvents",["$rootScope","$q","leafletLogger","leafletHelpers","leafletEventsHelpersFactory","leafletLabelEvents","leafletData",function($rootScope,$q,leafletLogger,leafletHelpers,leafletEventsHelpersFactory,leafletLabelEvents,leafletData){var safeApply=leafletHelpers.safeApply,EventsHelper=leafletEventsHelpersFactory,GeoJsonEvents=function(){EventsHelper.call(this,"leafletDirectiveGeoJson","geojson")};return GeoJsonEvents.prototype=new EventsHelper,GeoJsonEvents.prototype.genDispatchEvent=function(eventName,logic,leafletScope,lObject,name,model,layerName,extra){var base=EventsHelper.prototype.genDispatchEvent.call(this,eventName,logic,leafletScope,lObject,name,model,layerName),_this=this;return function(e){"mouseout"===eventName&&(extra.resetStyleOnMouseout&&leafletData.getGeoJSON(extra.mapId).then(function(leafletGeoJSON){var lobj=layerName?leafletGeoJSON[layerName]:leafletGeoJSON;lobj.resetStyle(e.target)}),safeApply(leafletScope,function(){$rootScope.$broadcast(_this.rootBroadcastName+".mouseout",e)})),base(e)}},GeoJsonEvents.prototype.getAvailableEvents=function(){return["click","dblclick","mouseover","mouseout"]},new GeoJsonEvents}]),angular.module("leaflet-directive").factory("leafletLabelEvents",["$rootScope","$q","leafletLogger","leafletHelpers","leafletEventsHelpersFactory",function($rootScope,$q,leafletLogger,leafletHelpers,leafletEventsHelpersFactory){var Helpers=leafletHelpers,EventsHelper=leafletEventsHelpersFactory,LabelEvents=function(){EventsHelper.call(this,"leafletDirectiveLabel","markers")};return LabelEvents.prototype=new EventsHelper,LabelEvents.prototype.genDispatchEvent=function(eventName,logic,leafletScope,lObject,name,model,layerName){var markerName=name.replace("markers.","");return EventsHelper.prototype.genDispatchEvent.call(this,eventName,logic,leafletScope,lObject,markerName,model,layerName)},LabelEvents.prototype.getAvailableEvents=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu"]},LabelEvents.prototype.genEvents=function(eventName,logic,leafletScope,lObject,name,model,layerName){var _this=this,labelEvents=this.getAvailableEvents(),scopeWatchName=Helpers.getObjectArrayPath("markers."+name);labelEvents.forEach(function(eventName){lObject.label.on(eventName,_this.genDispatchEvent(eventName,logic,leafletScope,lObject.label,scopeWatchName,model,layerName))})},LabelEvents.prototype.bindEvents=function(lObject,name,model,leafletScope,layerName){},new LabelEvents}]),angular.module("leaflet-directive").factory("leafletMapEvents",["$rootScope","$q","leafletLogger","leafletHelpers","leafletEventsHelpers",function($rootScope,$q,leafletLogger,leafletHelpers,leafletEventsHelpers){var isDefined=leafletHelpers.isDefined,fire=leafletEventsHelpers.fire,_getAvailableMapEvents=function(){return["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose","draw:created","draw:edited","draw:deleted","draw:drawstart","draw:drawstop","draw:editstart","draw:editstop","draw:deletestart","draw:deletestop"]},_genDispatchMapEvent=function(scope,eventName,logic){return function(e){var broadcastName="leafletDirectiveMap."+eventName;fire(scope,broadcastName,logic,e,e.target,scope)}},_notifyCenterChangedToBounds=function(scope){scope.$broadcast("boundsChanged")},_notifyCenterUrlHashChanged=function(scope,map,attrs,search){if(isDefined(attrs.urlHashCenter)){var center=map.getCenter(),centerUrlHash=center.lat.toFixed(4)+":"+center.lng.toFixed(4)+":"+map.getZoom();isDefined(search.c)&&search.c===centerUrlHash||scope.$emit("centerUrlHash",centerUrlHash)}};return{getAvailableMapEvents:_getAvailableMapEvents,genDispatchMapEvent:_genDispatchMapEvent,notifyCenterChangedToBounds:_notifyCenterChangedToBounds,notifyCenterUrlHashChanged:_notifyCenterUrlHashChanged}}]),angular.module("leaflet-directive").factory("leafletMarkerEvents",["$rootScope","$q","leafletLogger","leafletHelpers","leafletEventsHelpersFactory","leafletLabelEvents",function($rootScope,$q,leafletLogger,leafletHelpers,leafletEventsHelpersFactory,leafletLabelEvents){var safeApply=leafletHelpers.safeApply,isDefined=leafletHelpers.isDefined,Helpers=leafletHelpers,lblHelp=leafletLabelEvents,EventsHelper=leafletEventsHelpersFactory,MarkerEvents=function(){EventsHelper.call(this,"leafletDirectiveMarker","markers")};return MarkerEvents.prototype=new EventsHelper,MarkerEvents.prototype.genDispatchEvent=function(eventName,logic,leafletScope,lObject,name,model,layerName){var handle=EventsHelper.prototype.genDispatchEvent.call(this,eventName,logic,leafletScope,lObject,name,model,layerName);return function(e){"click"===eventName?safeApply(leafletScope,function(){$rootScope.$broadcast("leafletDirectiveMarkersClick",name)}):"dragend"===eventName&&(safeApply(leafletScope,function(){model.lat=lObject.getLatLng().lat,model.lng=lObject.getLatLng().lng}),model.message&&model.focus===!0&&lObject.openPopup()),handle(e)}},MarkerEvents.prototype.getAvailableEvents=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose","touchend","touchstart","touchmove","touchcancel","touchleave"]},MarkerEvents.prototype.bindEvents=function(lObject,name,model,leafletScope,layerName){var logic=EventsHelper.prototype.bindEvents.call(this,lObject,name,model,leafletScope,layerName);Helpers.LabelPlugin.isLoaded()&&isDefined(lObject.label)&&lblHelp.genEvents(name,logic,leafletScope,lObject,model,layerName)},new MarkerEvents}]),angular.module("leaflet-directive").factory("leafletPathEvents",["$rootScope","$q","leafletLogger","leafletHelpers","leafletLabelEvents","leafletEventsHelpers",function($rootScope,$q,leafletLogger,leafletHelpers,leafletLabelEvents,leafletEventsHelpers){var isDefined=leafletHelpers.isDefined,isObject=leafletHelpers.isObject,Helpers=leafletHelpers,errorHeader=leafletHelpers.errorHeader,lblHelp=leafletLabelEvents,fire=leafletEventsHelpers.fire,$log=leafletLogger,_genDispatchPathEvent=function(eventName,logic,leafletScope,lObject,name,model,layerName){return function(e){var broadcastName="leafletDirectivePath."+eventName;fire(leafletScope,broadcastName,logic,e,e.target||lObject,model,name,layerName)}},_bindPathEvents=function(lObject,name,model,leafletScope){var i,eventName,pathEvents=[],logic="broadcast";if(isDefined(leafletScope.eventBroadcast))if(isObject(leafletScope.eventBroadcast))if(isDefined(leafletScope.eventBroadcast.path))if(isObject(leafletScope.eventBroadcast.paths))$log.warn(errorHeader+"event-broadcast.path must be an object check your model.");else{void 0!==leafletScope.eventBroadcast.path.logic&&null!==leafletScope.eventBroadcast.path.logic&&("emit"!==leafletScope.eventBroadcast.path.logic&&"broadcast"!==leafletScope.eventBroadcast.path.logic?$log.warn(errorHeader+"Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===leafletScope.eventBroadcast.path.logic&&(logic="emit"));var pathEventsEnable=!1,pathEventsDisable=!1;if(void 0!==leafletScope.eventBroadcast.path.enable&&null!==leafletScope.eventBroadcast.path.enable&&"object"==typeof leafletScope.eventBroadcast.path.enable&&(pathEventsEnable=!0),void 0!==leafletScope.eventBroadcast.path.disable&&null!==leafletScope.eventBroadcast.path.disable&&"object"==typeof leafletScope.eventBroadcast.path.disable&&(pathEventsDisable=!0),pathEventsEnable&&pathEventsDisable)$log.warn(errorHeader+"can not enable and disable events at the same time");else if(pathEventsEnable||pathEventsDisable)if(pathEventsEnable)for(i=0;i<leafletScope.eventBroadcast.path.enable.length;i++)eventName=leafletScope.eventBroadcast.path.enable[i],-1!==pathEvents.indexOf(eventName)?$log.warn(errorHeader+"This event "+eventName+" is already enabled"):-1===_getAvailablePathEvents().indexOf(eventName)?$log.warn(errorHeader+"This event "+eventName+" does not exist"):pathEvents.push(eventName);else for(pathEvents=_getAvailablePathEvents(),i=0;i<leafletScope.eventBroadcast.path.disable.length;i++){eventName=leafletScope.eventBroadcast.path.disable[i];var index=pathEvents.indexOf(eventName);-1===index?$log.warn(errorHeader+"This event "+eventName+" does not exist or has been already disabled"):pathEvents.splice(index,1)}else $log.warn(errorHeader+"must enable or disable events")}else pathEvents=_getAvailablePathEvents();else $log.error(errorHeader+"event-broadcast must be an object check your model.");else pathEvents=_getAvailablePathEvents();for(i=0;i<pathEvents.length;i++)eventName=pathEvents[i],lObject.on(eventName,_genDispatchPathEvent(eventName,logic,leafletScope,pathEvents,name));Helpers.LabelPlugin.isLoaded()&&isDefined(lObject.label)&&lblHelp.genEvents(name,logic,leafletScope,lObject,model)},_getAvailablePathEvents=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","add","remove","popupopen","popupclose"]};return{getAvailablePathEvents:_getAvailablePathEvents,bindPathEvents:_bindPathEvents}}])}(angular),angular.module("decipher.tags.templates",["templates/tags.html","templates/tag.html"]),angular.module("templates/tags.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("templates/tags.html",'<div class="decipher-tags form-control" data-ng-mousedown="selectArea()">\n\n  <div class="decipher-tags-taglist">\n    <span data-ng-repeat="tag in tags|orderBy:orderBy"\n          data-ng-mousedown="$event.stopPropagation()">\n      <ng-include src="options.tagTemplateUrl"></ng-include>\n    </span>\n  </div>\n\n  <span data-ng-show="toggles.inputActive">\n    <input ng-if="!srcTags.length"\n           type="text"\n           data-ng-model="inputTag"\n           class="decipher-tags-input"/>\n    <!-- may want to fiddle with limitTo here, but it was inhibiting my results\n    so perhaps there is another way -->\n    <input ng-if="srcTags.length"\n           type="text"\n           data-ng-model="inputTag"\n           class="decipher-tags-input"\n           data-typeahead="stag as stag.name for stag in srcTags|filter:$viewValue|orderBy:orderBy"\n           data-typeahead-input-formatter="{{typeaheadOptions.inputFormatter}}"\n           data-typeahead-loading="{{typeaheadOptions.loading}}"\n           data-typeahead-min-length="{{typeaheadOptions.minLength}}"\n           data-typeahead-template-url="{{typeaheadOptions.templateUrl}}"\n           data-typeahead-wait-ms="{{typeaheadOptions.waitMs}}"\n\n           data-typeahead-editable="{{typeaheadOptions.allowsEditable}}"\n           data-typeahead-on-select="add($item) && selectArea() && typeaheadOptions.onSelect()"\n        />\n\n  </span>\n</div>\n')}]),angular.module("templates/tag.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("templates/tag.html",'<span class="decipher-tags-tag"\n      data-ng-class="getClasses(tag)">{{tag.name}}\n      <i class="fa fa-remove"\n         data-ng-click="remove(tag)">\n      </i>\n</span>\n')}]),L.Icon.Default.imagePath="styles/images",angular.module("ez.datetime").run(["$templateCache",function($templateCache){$templateCache.put("ez_datetime_range_modal.html",'<div class="ez-datetime-modal"><div class="modal-header"><button type="button" class="close" ng-click="dismiss()"><span>×</span></button><h4 class="modal-title"><i class="{{ options.headingIcon }}"></i> {{ options.rangeHeadingText }}</h4></div><div class="modal-body"><div class="row"><div class="range-from col-lg-6 col-md-6 col-sm-6"><div ez-date-picker ng-model="form.from" max-date="form.maxDate" to="form.to" options="options"></div></div><div class="range-to col-lg-6 col-md-6 col-sm-6"><div ez-date-picker ng-model="form.to" min-date="form.minDate" from="form.from" options="options"></div></div></div></div><div class="modal-footer"><div class="left-btn-group"><span class="quick-select dropdown dropup" ng-if="options.shortcutsEnabled && shortcuts.length > 0"><button class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="{{ options.shortcutBtnIcon }}"></i> {{ options.shortcutBtnText }} <span class="caret"></span></button><ul class="dropdown-menu"><li ng-repeat="shortcut in shortcuts"><a ng-click="select($index)">{{ shortcut.name }}</a></li></ul></span> <a class="btn btn-default clear-btn" title="Clear Date" ng-click="clear()" ng-if="!!form.from || !!form.to"><span class="{{ options.clearBtnIcon }}"></span></a></div><a class="btn btn-default" ng-click="dismiss()"><i class="{{ options.cancelBtnIcon }}"></i> {{ options.cancelBtnText }}</a> <a class="btn btn-primary" ng-click="ok()"><i class="{{ options.okBtnIcon }}"></i> {{ options.okBtnText }}</a></div></div>')}]),app.run(["$templateCache",function($templateCache){$templateCache.put("popover-html-unsafe-popup.html",'<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }"><div class="arrow"></div> <div class="popover-inner"><h3 class="popover-title" ng-bind="title" ng-show="title"></h3><div class="popover-content" bind-html-unsafe="content"></div></div></div>')}]);